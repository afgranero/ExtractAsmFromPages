<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="TRS-80 Revived Site by Ira Goldklang's is an archive of everything related to the Tandy Radio Shack TRS-80 microcomputer lines. Site contains emulators, programs, manuals, books, patches, games, hints, discussions, and tons more.">
	<meta name="author" content="Ira Goldklang">
	<meta name="robots" content="index, follow">
	<link rel="icon" href="https://www.trs-80.com/icon.ico" type="image/x-icon">
	<link rel="canonical" href="https://www.trs-80.com/sub-disassem-rom-m3-part-4.htm">
	<meta property="og:title" content="TRS-80 Revived Site - Ira Goldklang's TRS-80 Archive">
	<meta property="og:description" content="Complete archive of TRS-80 emulators, programs, manuals, books, and games for Tandy Radio Shack TRS-80 computers.">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://www.trs-80.com/sub-disassem-rom-m3-part-4.htm">
	<meta name="twitter:card" content="summary">
	<meta name="twitter:title" content="TRS-80 Revived Site">
	<meta name="twitter:description" content="Complete archive of TRS-80 emulators, programs, and resources.">
	<title>Model III ROM Explained - Part 4</title>
	<!-- Load your existing CSS file -->
	<link rel="stylesheet" href="Model%20III%20ROM%20Explained%20-%20Part%204_files/trs80-css.css">
	<link rel="stylesheet" href="Model%20III%20ROM%20Explained%20-%20Part%204_files/trs80-hamburger.css">
	<!-- Fancybox CSS -->
	<link rel="stylesheet" href="Model%20III%20ROM%20Explained%20-%20Part%204_files/fancybox.css">
	<!-- Load the component loader -->
	<script src="Model%20III%20ROM%20Explained%20-%20Part%204_files/trs80-loader.js"></script>
	<script src="Model%20III%20ROM%20Explained%20-%20Part%204_files/trs80-hamburger.js"></script>
	<style>
		.m3v1 { color: red;}
		.m3v2 { color: blue;}
		.m4v1 { color: green;}
	</style>
</head>
<body class="trs80-loaded"><button id="hamburger-btn" class="hamburger-menu" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
	<div class="site-container">
		<!-- Header will be loaded here -->
		<div id="header"><style>
    .trs80-header-grid {
        display: grid;
        /* 'auto' lets the images take only needed space, '1fr' gives the rest to the text */
        grid-template-columns: auto 1fr auto;
        grid-template-rows: 1fr;
        grid-column-gap: 20px;
        grid-row-gap: 0;
        background-color: #003399;
        margin-top: 10px;
        padding: 10px;
        /* This ensures all items in the grid (images and text) are aligned to the top */
        align-items: start;
    }

    .trs80-header-left { grid-area: 1 / 1 / 2 / 2; display: flex; align-items: start; }
    .trs80-header-center { grid-area: 1 / 2 / 2 / 3; text-align: center; }
    .trs80-header-right { grid-area: 1 / 3 / 2 / 4; display: flex; align-items: start; justify-content: flex-end; }

    .trs80-title { color: white !important; font-size: 170%; text-align: center; margin: 0 0 10px 0; font-weight: bold; }

    .trs80-description {
        color: white !important;
        font-size: 120%;
        text-align: center;
        margin: 0 auto 15px auto;
        padding: 0 10px;
        line-height: 1.4;
    }

    .trs80-header-grid img { border: 0 !important; margin: 0 2px; }
    .trs80-img-60 { width: 60px; }
    .trs80-img-80 { width: 80px; }
    .trs80-img-90 { width: 90px; }
    .trs80-img-100 { width: 100px; }

    /* Search Button Styling */
    .header-search-container {
        margin-bottom: 10px;
    }

    .header-search-link {
        display: inline-block;
        background: #ffcc00; /* Retro TRS-80 Amber */
        color: #003399 !important;
        padding: 6px 15px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9em;
        text-decoration: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        transition: transform 0.2s, background 0.2s;
    }

    .header-search-link:hover {
        background: #ffe066;
        transform: scale(1.05);
        text-decoration: none;
    }

    @media screen and (max-width: 768px) {
        .trs80-header-grid {
            grid-template-columns: 1fr;
            grid-template-rows: auto auto auto;
            text-align: center;
            justify-items: center;
        }
        .trs80-header-left { grid-area: 1 / 1 / 2 / 2; justify-content: center; }
        .trs80-header-center { grid-area: 2 / 1 / 3 / 2; }
        .trs80-header-right { grid-area: 3 / 1 / 4 / 2; justify-content: center; }
        .trs80-title { font-size: 130%; }
        .trs80-description { font-size: 100%; text-align: center; }
        .trs80-img-60 { width: 50px; }
        .trs80-img-80 { width: 65px; }
        .trs80-img-90 { width: 75px; }
        .trs80-img-100 { width: 80px; }
    }
</style>

<div class="trs80-header-grid">
    <div class="trs80-header-left">
        <img src="Model%20III%20ROM%20Explained%20-%20Part%204_files/computer-model1-keyboardandscreen-100.png" alt="[Model I]" class="trs80-img-60">
        <img src="Model%20III%20ROM%20Explained%20-%20Part%204_files/computer-model3-rsc05-blur-x100.png" alt="[Model III]" class="trs80-img-60">
        <img src="Model%20III%20ROM%20Explained%20-%20Part%204_files/computer-model4-rsc10-x100.png" alt="[Model 4]" class="trs80-img-90">
    </div>

    <div class="trs80-header-center">
        <p class="trs80-title">Welcome To Ira Goldklang's TRS-80 Revived Site</p>

        <p class="trs80-description">
            TRS-80 Revived Site is an archive of everything related to 
the Tandy Radio Shack TRS-80 home microcomputer lines. Site contains 
emulators, programs, manuals, books, patches, games, hints, discussions,
 and tons more.
        </p>

        <div class="header-search-container">
            <a href="https://www.trs-80.com/main-search-site.htm" class="header-search-link">
                <span class="search-icon">üîç</span> SEARCH THIS SITE
            </a>
        </div>
    </div>

    <div class="trs80-header-right">
        <img src="Model%20III%20ROM%20Explained%20-%20Part%204_files/computer-model-4p-sideways-view-x100.png" alt="[Model 4P]" class="trs80-img-90">
        <img src="Model%20III%20ROM%20Explained%20-%20Part%204_files/computer-model100-ccf836-x100.png" alt="[Model 100]" class="trs80-img-80">
        <img src="Model%20III%20ROM%20Explained%20-%20Part%204_files/computer-pc2-rsc07-x100.png" alt="[Pocket Computer]" class="trs80-img-100">
    </div>
</div>
</div>
		<!-- Content wrapper with sidebar and main content -->
		<div class="content-wrapper">
			<!-- Left Navigation will be loaded here -->
			<aside class="sidebar" id="navbar"><div class="navigationpanelv2">
	<div class="nav-entry-block">
		<h2>FIRST TIME VISITORS</h2>
		<p style="font-size:150%; margin-top:0; text-align:center; color:red;"><a href="https://www.trs-80.com/main-welcome.htm">Visit the WELCOME page</a></p>
	</div>

	<div class="nav-entry-block">
		<h2>Services</h2>
		<ul>
			<li><a href="https://www.trs-80.com/main-faq-reading-disks.htm" style="color:red !important;">Do you have TRS-80 Disks?  Send them in for Preservation and Conversion for use in an Emulator</a></li>
			<li><a href="https://www.trs-80.com/main-disketterequest.htm">Request Real DOS Disks</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>General</h2>
		<ul>
			<li><a href="https://www.trs-80.com/index.html">Site News</a></li>
			<li><a href="https://www.trs-80.com/main-introduction-to-emulators.htm">Intro to Emulation</a></li>
			<li>
				<span class="submenu-toggle"><a href="https://www.trs-80.com/main-interviews.htm">Interviews</a></span>
				<ul>
					<li><a href="https://americanhistory.si.edu/comphist/gates.htm">Bill Gates</a></li>
					<li><a href="http://www.trs-80.org/interview-bill-hogue/">Bill Hogue</a></li>
					<li><a href="http://www.trs-80.org/interview-dan-gookin/">Dan Gookin</a></li>
					<li><a href="https://www.trs-80.com/sub-interview-don-french.htm">Don French</a></li>
					<li><a href="https://bluebilby.com/dubois-mcnamara/">Dubouis &amp; McNamara</a></li>
					<li><a href="http://www.trs-80.org/interview-j-weaver/">J. Weaver Jr.</a></li>
					<li><a href="http://www.trs-80.org/interview-jack-crenshaw/">Jack Crenshaw</a></li>
					<li><a href="http://www.trs-80.org/interview-jim-stutsman/">Jim Stutsman</a></li>
					<li><a href="http://www.48k.ca/JoshLavinsky.html">Josh Lavinsky</a></li>
					<li><a href="http://www.trs-80.org/interview-kevin-tschudi/">Kevin Tschudi</a></li>
					<li><a href="http://www.trs-80.org/interview-paul-andreasen/">Paul Andreasen</a></li>
					<li><a href="https://www.trs-80.com/sub-interview-steve-leininger.htm">Steven W. Leininger</a></li>
					<li><a href="https://www.trs-80.com/sub-interview-bill-demas.htm">William Demas</a></li>
				</ul>
			</li>
			<li><a href="https://www.trs-80.com/main-shipping.htm">Shipping a TRS-80</a></li>
			<li><a href="https://www.trs-80.com/main-lore.htm">Radio Shack Lore</a></li>
			<li><a href="https://www.trs-80.com/main-fun-stuff.htm">Fun Stuff</a></li>
		</ul>
		<p class="donatev2"><a href="https://www.trs-80.com/main-donate.htm">Support the Site</a></p>
	</div>

	<div class="nav-entry-block">
		<h2>Help The Site!</h2>
		<ul>
			<li><a href="https://www.trs-80.com/main-missing-software.htm">Missing Software</a></li>
			<li><a href="https://www.trs-80.com/main-missing-magazines.htm">Missing Magazines</a></li>
			<li><a href="https://www.trs-80.com/main-faq-reading-disks.htm">Send in Your Disks for Archiving</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Searches</h2>
		<ul>
			<li><a href="https://www.trs-80.com/main-search-site.htm">Site-Wide Search</a></li>
			<li><a href="https://www.trs-80.com/main-search-software.htm">Software Search</a></li>
			<li><a href="https://www.trs-80.com/main-search-magazines.htm">Magazine Search</a></li>
			<li><a href="https://www.trs-80.com/main-search-rs-catalogs.htm">Catalog Search</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Emulation and Virtual Media</h2>
		<span>Info and Downloads:</span>
		<ul>
			<li><a href="https://www.trs-80.com/main-emulators.htm">Emulators</a></li>
			<li><a href="https://www.trs-80.com/main-emulation-tape-utilities.htm">Virtual Tape Utilities</a></li>
			<li><a href="https://www.trs-80.com/main-emulation-disk-utilities.htm">Virtual Disk Utilities</a></li>
			<li><a href="https://www.trs-80.com/main-emulation-misc-utilities.htm">Misc TRS-80 Utilities</a></li>
		</ul>
		<span>How To Convert:</span>
		<ul>
			<li><a href="https://www.trs-80.com/main-emulation-conversion-tapes.htm">Tapes to Virtual</a></li>
			<li><a href="https://www.trs-80.com/main-emulation-conversion-disks.htm">Disks to Virtual</a></li>
			<li><a href="https://www.classic-computers.org.nz/system-80/software_esf_archive-imaging.htm">Stringy Floppy to Virtual</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Advanced</h2>
		<span>Internal Operations</span>
		<ul>
			<li>
				<span class="submenu-toggle">ROM/Z-80 Info</span>
				<ul>
					<li><a href="https://www.trs-80.com/main-internal-rom-related.htm#compared">ROMs Compared</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-level-1.htm">Model I Level 1 ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m1-part-1.htm">Model I Level II ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm">Model III Level II ROM</a></li>
					<li><a href="https://github.com/kiwisincebirth/TRS-80">Model III Level II Compilable Source</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m4.htm">Model 4 ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m4-xdrom-main.htm">Model 4 XDROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m4p.htm">Model 4P Boot ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-network-4.htm">Network 4 ROM</a></li>
					<li><a href="https://www.gatesnotes.com/microsoft-original-source-code">Orig Source Code</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-bugs.htm">Bugs</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-rom-addresses.htm">Memory map and address reference</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-entry-points.htm">Entry Points to routines</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-io-and-misc-routines.htm">I/O and Misc ROM routines</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-math-calls.htm">Math Routines</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-rst-vectors.htm">RST vectors and Disk BASIC entry points</a></li>
					<li><a href="https://www.trs-80.com/sub-rom-z80-info.htm">Reference for Z-80 opcodes and undocumented command</a></li>
				</ul>
			</li>
			<li><a href="https://www.trs-80.com/main-internal-ram-addresses-and-routines.htm">RAM Addresses/Routines</a></li>
			<li><a href="https://www.trs-80.com/main-internal-ports-and-i-o.htm">Ports and I/O Devices</a></li>
			<li><a href="https://www.trs-80.com/sub-rom-dcbs.htm">Device Control Blocks (DCB's)</a></li>
			<li><a href="https://www.trs-80.com/main-internal-keyboard-map.htm">Keyboard Map</a></li>
		</ul>

		<span>Disassemblies</span>
		<ul>
			<li>
				<span class="submenu-toggle"><a href="https://www.trs-80.com/main-disassemblies.htm">Disassemblies</a></span>
				<ul>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-level-1.htm">Level I ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m1-part-1.htm">Level II ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm">Model III ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-4-durda.htm">Frank Durda Modified C-ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m4.htm">Model 4 ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m4p.htm">Model 4P Bootstrap ROM</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-m4-xdrom-main.htm">XDROM - Frank Durda's Model 4 ROM C replacement</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-dos-nd80-m1-main.htm">NEWDOS/80 v2.0</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-dos-td13-main.htm">TRSDOS v1.3</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-dos-td23-main.htm">TRSDOS v2.3</a></li>
					<li><a href="https://www.trs-80.com/sub-disassem-rom-network-4.htm">Network 4 Transporter ROM code analysis</a></li>
				</ul>
			</li>
		</ul>

		<span>Zaps/Patches/Fixes</span>
		<ul>
			<li>
				<span class="submenu-toggle"><a href="https://www.trs-80.com/main-zaps-and-patches.htm">Zaps and Patches</a></span>
				<ul>
					<li><a href="https://www.trs-80.com/main-zaps-and-patches.htm#dos">DOS</a></li>
					<li><a href="https://www.trs-80.com/sub-zaps-sw-electric-pencil.htm">Electric Pencil</a></li>
					<li><a href="https://www.trs-80.com/sub-zaps-sw-general.htm">Other Software</a></li>
					<li><a href="https://www.trs-80.com/main-zaps-and-patches.htm#software-zaps-and">ZIPs of Patches</a></li>
				</ul>
			</li>
			<li>
				<span class="submenu-toggle"><a href="https://www.trs-80.com/main-tips-and-tricks.htm">Tips and Tricks</a></span>
				<ul>
					<li><a href="https://www.trs-80.com/sub-tips-hard-drive.htm">Hard Drive Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-packing.htm">String Packing and USR Routines</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-level2.htm">Level II Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-reference-dos-newdos80-main.htm#tips">NEWDOS/80 Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-dos.htm">Other DOS Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-graphics.htm">TRS-80 Graphics</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-file-formats.htm">Tape and File Formats/Structures</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-easter-eggs.htm">Bugs and Easter Eggs</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-misc.htm">Misc Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-model-3.htm">Model III Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-model-4.htm">Model 4 Tips and Tricks</a></li>
					<li><a href="https://www.trs-80.com/sub-tips-model-4p.htm">Model 4P Tips and Tricks</a></li>
				</ul>
			</li>
		</ul>
		<p class="donatev2"><a href="https://www.trs-80.com/main-donate.htm">Support the Site</a></p>
	</div>

	<div class="nav-entry-block">
		<h2>TRS-80 Models</h2>
		<ul>
			<li><a href="https://www.trs-80.com/main-models.htm">Timeline</a></li>
			<li><a href="https://www.trs-80.com/sub-models-model1.htm">Model I</a></li>
			<li><a href="https://www.trs-80.com/sub-models-model2.htm">Model II</a></li>
			<li><a href="https://www.trs-80.com/sub-models-model3.htm">Model III</a></li>
			<li><a href="https://www.trs-80.com/sub-models-model4.htm">Model 4/4P/4D</a></li>
			<li><a href="https://www.trs-80.com/sub-models-coco.htm">Color (Coco 1-3, MC-10)</a></li>
			<li><a href="https://www.trs-80.com/sub-models-laptops.htm">Laptops (100/200/600)</a></li>
			<li><a href="https://www.trs-80.com/sub-models-pocket.htm">Pocket (PC-1 to PC-8)</a></li>
			<li><a href="https://www.trs-80.com/sub-models-clones.htm">Clones</a></li>
			<li><a href="https://www.trs-80.com/sub-models-printers.htm">Printers</a></li>
		</ul>
		<p class="donatev2"><a href="https://www.trs-80.com/main-donate.htm">Support the Site</a></p>
	</div>

	<div class="nav-entry-block">
		<h2>Reference</h2>
		<ul>
			<li><a href="https://www.trs-80.com/sub-reference-dos-trsdos-main.htm">TRSDOS</a></li>
			<li><a href="https://www.trs-80.com/sub-reference-dos-dosplus.htm">DOSPlus</a></li>
			<li><a href="https://www.trs-80.com/sub-reference-dos-newdos80-main.htm">NEWDOS/80</a></li>
			<li><a href="https://www.trs-80.com/sub-reference-multidos.htm">MULTIDOS</a></li>
			<li><a href="https://www.trs-80.com/sub-reference-dos-cpm.htm">CP/M</a></li>
			<li><a href="https://www.trs-80.com/sub-reference-level-2-basic.htm">Level II BASIC Ref</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Detailed Products</h2>
		<ul>
			<li><a href="https://www.trs-80.com/sub-details-orchestra.htm">ORCH-80/85/90</a></li>
			<li><a href="https://www.trs-80.com/sub-details-speed-up-boards.htm">Speed-Up Boards</a></li>
			<li><a href="https://www.trs-80.com/sub-details-scott-adams.htm">Scott Adams Adventures</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Tandy Publications</h2>
		<ul>
			<li><a href="https://www.trs-80.com/sub-publications-rs-csbs.htm">Customer Service Bulletins</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-rs-memos.htm">Memos / Bulletins / Releases</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-rs-cc-answers.htm">Comp Center Answers</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-rs-catalogs.htm">Catalogs</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-rs-comics.htm">Comic Books</a></li>
		</ul>
		<span>Microcomputer News</span>
		<ul>
			<li><a href="https://www.trs-80.com/sub-publications-rs-micronewsletter-usa.htm">USA Edition</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-rs-micronewsletter-aus.htm">Australian Edition</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-rs-micronewsletter-other.htm">Other Editions</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Publications</h2>
		<ul>
			<li><a href="https://www.trs-80.com/sub-publications-books.htm">Books</a></li>
			<li>
				<span class="submenu-toggle"><a href="https://www.trs-80.com/main-magazine-main-menu.htm">Magazines (Non-Tandy)</a></span>
				<ul>
					<li><a href="https://www.trs-80.com/sub-mag-80micro-main.htm">80 Microcomputing</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-80-notebook.htm">80 Notebook</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-80us-detail.htm">80 U.S. Journal</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-alternatesource-detail.htm">The Alternate Source</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-baron.htm">Baron's Microcomputing</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-cie.htm">C.I.E.</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-cload.htm">CLOAD</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-codeworks.htm">CodeWorks</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-computernews80.htm">Computer News 80</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-computer-user.htm">Computer User</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-creative.htm">Creative Computing</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-hecomputronics-detail.htm">H&amp;E Computronics</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-lsi-journal.htm">LDOS / LSI</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-micro80.htm">Micro-80</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-misosys-notes.htm">Misosys Notes</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-misosys-quarterly.htm">Misosys Quarterly</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-softside-detail.htm">Softside</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-the8ighty.htm">The 8ighty</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-trace.htm">Trace</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-trs8bit.htm">TRS8Bit</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-trstimes.htm">TRSTimes</a></li>
					<li><a href="https://www.trs-80.com/sub-mag-other.htm">Other Magazines</a></li>
				</ul>
			</li>
			<li><a href="https://www.trs-80.com/sub-publications-manuals-software-1.htm">Software Manuals</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-user-groups-1.htm">User's Group Newsletters</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-catalogs.htm">Catalogs (Non-Tandy)</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-flyers.htm">Product Flyers</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-company-news.htm">Company Newsletters</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>This Section for TRS-80 Hardware Owners</h2>
		<span>TRS-80 Upgrades/Parts:</span>
		<ul>
			<li><a href="https://www.trs-80.com/main-upgrades.htm">Upgrades and Parts</a></li>
			<li><a href="https://www.trs-80.com/sub-repairs-parts-thingverse.htm">Schematics/3-D Printable Parts</a></li>
		</ul>
		<span>TRS-80 Repairs:</span>
		<ul>
			<li class="navbumpv2"><a href="https://www.trs-80.com/main-repairs.htm">Main Repair Page</a></li>
			<li><a href="https://www.trs-80.com/sub-repairs-repair-people.htm">Repair People</a></li>
			<li><a href="https://www.trs-80.com/sub-repairs-how-to-open.htm">Opening a TRS-80</a></li>
			<li><a href="https://www.trs-80.com/sub-repairs-eprom.htm">Using an EPROM</a></li>
		</ul>
		<span>Hardware Mods and Hacks:</span>
		<ul>
			<li><a href="https://www.trs-80.com/sub-tips-modifications-model-1.htm">Model I</a></li>
			<li><a href="https://www.trs-80.com/sub-tips-modifications-model-3.htm">Model III</a></li>
			<li><a href="https://www.trs-80.com/sub-tips-modifications-model-4.htm">Model 4</a></li>
		</ul>
		<span>Other Items ...</span>
		<ul>
			<li><a href="https://www.trs-80.com/sub-publications-manuals-hardware-1.htm">Hardware Manuals</a></li>
			<li><a href="https://www.trs-80.com/sub-publications-manuals-service.htm">Service Manuals</a></li>
			<li><a href="https://voidstar.blog/tandy-radio-shack-computer-cassette-recorder-trs-ccr-usage/">Using a Computer / Tablet / Smartphone for Cassette I/O</a></li>
		</ul>
	</div>

	<div class="nav-entry-block">
		<h2>Misc</h2>
		<ul>
			<li><a href="https://www.trs-80.com/main-emailme.htm">Send Me Email</a></li>
			<li><a href="https://www.trs-80.com/main-old-news.htm">Archived News and Guestbook</a></li>
			<li><a href="https://www.trs-80.com/main-personalstories.htm">Personal Stories Submitted</a></li>
			<li><a href="https://www.trs-80.com/main-emaillinks.htm">Email and other TRS-80 Sites</a></li>
			<li><a href="https://www.trs-80.com/main-copyrights.htm">Copyrights</a></li>
		</ul>
		<p class="donatev2"><a href="https://www.trs-80.com/main-donate.htm">Support the Site</a></p>
	</div>
</div></aside>
			<!-- Main Content -->
			<main class="main-content">

				<div class="main-page-container">
					<h1>Model III ROM Explained - Part 4</h1>

					<div class="section-wrapper">
						<h2 id="this-page-covers">This page covers the 3000H and higher portion of the ROM which does not exist on the Model I.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
						<div class="section-content">
							<p class="debug-note">Text in <span class="m3v1">RED</span> is for v1 of the Model III ROM.<br>Text in <span class="m3v2">BLUE</span> is for v2 of the Model III ROM.<br>Text in <span class="m4v1">GREEN</span> is for the Model 4 ROM.
							<br></p><h2 id="3000" class="skip-banner">3000 - Jump Table.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3000</div><div><a href="#325E" class="memory-link">JP 325EH</a></div><div>Jump to 325EH for a SLOW tape header write.</div></div>
									<div class="assembly-row-combined both"><div>3003</div><div><a href="#329B" class="memory-link">JP 329BH</a></div><div>Jump to 329BH for a FAST tape header write.</div></div>
									<div class="assembly-row-combined both"><div>3006</div><div><a href="#3274" class="memory-link">JP 3274H</a></div><div>Jump to 3274H for a SLOW tape header read.</div></div>
									<div class="assembly-row-combined both"><div>3009</div><div><a href="#32DA" class="memory-link">JP 32DAH</a></div><div>Jump to 32DAH for a FAST tape header read.</div></div>
									<div class="assembly-row-combined both"><div>300C</div><div><a href="#31C0" class="memory-link">JP 31C0H</a></div><div>Jump to 31C0H for Cassette OFF.</div></div>
									<div class="assembly-row-combined both"><div>300F</div><div><a href="#31D1" class="memory-link">JP 31D1H</a></div><div>Jump to 31D1H for Cassette ON.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3012</div><div><a href="#34B6" class="memory-link">JP 34B6H</a></div><div>Jump to 34B6H for Warm Boot.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3012</div><div><a href="#34AB" class="memory-link">JP 34ABH</a></div><div>Jump to 34ABH for Warm Boot.</div></div>
									<div class="assembly-row-combined m4v1"><div>*3012</div><div><a href="#34AB" class="memory-link">JP 3461H</a></div><div>Jump to 3461H for Warm Boot.</div></div>
									<div class="assembly-row-combined both"><div>*3015</div><div><a href="#3455" class="memory-link">JP 3455H</a></div><div>Jump to 3455H for Bootstrap.</div></div>
									<div class="assembly-row-combined m4v1"><div>*3015</div><div><a href="#3455" class="memory-link">JP 3401H</a></div><div>Jump to 3401H for Bootstrap.</div></div>
									<div class="assembly-row-combined both"><div>3018</div><div><a href="#35C2" class="memory-link">JP 35C2H</a></div><div>Jump to 35C2H for Maskable Interrupt Handler.</div></div>
									<div class="assembly-row-combined both"><div>301B</div><div><a href="#35FB" class="memory-link">JP 35FBH</a></div><div>Jump to 35FBH for RS-232 Initialization.</div></div>
									<div class="assembly-row-combined both"><div>301E</div><div><a href="#365A" class="memory-link">JP 365AH</a></div><div>Jump to 365AH for RS-232 Input.</div></div>
									<div class="assembly-row-combined both"><div>3021</div><div><a href="#3680" class="memory-link">JP 3680H</a></div><div>Jump to 3680H for RS-232 Output.</div></div>
									<div class="assembly-row-combined both"><div>3024</div><div><a href="#338E" class="memory-link">JP 338EH</a></div><div>Jump to 338EH for Keyboard Input.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3027</div><div><a href="#3738" class="memory-link">JP 3738H</a></div><div>Jump to 3738H for I/O Re-Router.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3027</div><div><a href="#3739" class="memory-link">JP 3739H</a></div><div>Jump to 3739H for I/O Re-Router.</div></div>
									<div class="assembly-row-combined m4v1"><div>*3027</div><div>RET<br>NOP<br>NOP</div><div>I/O Re-Router was removed from the Model 4 ROM.</div></div>
									<div class="assembly-row-combined both"><div>302A</div><div><a href="#31F7" class="memory-link">JP 31F7H</a></div><div>Jump to 31F7H for part of cassette header routine.</div></div>
									<div class="assembly-row-combined m3v1"><div>*302D</div><div><a href="#377A" class="memory-link">JP 377AH</a></div><div>Jump to 377AH for a routine which parses whether the current instruction on a the current line is in quotes.</div></div>
									<div class="assembly-row-combined m3v2"><div>*302D</div><div><a href="#377B" class="memory-link">JP 377BH</a></div><div>Jump to 377BH for a routine which parses whether the current instruction on a the current line is in quotes.</div></div>
									<div class="assembly-row-combined m4v1"><div>*302D</div><div><a href="#377B" class="memory-link">JP 37A4H</a></div><div>Jump to 37A4H for a routine which parses whether the current instruction on a the current line is in quotes.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3030</div><div><a href="#3798" class="memory-link">JP 3798H</a></div><div>Jump to 3798H for STRING=DATE$+""+TIME$.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3030</div><div><a href="#3799" class="memory-link">JP 3799H</a></div><div>Jump to 3799H for STRING=DATE$+""+TIME$.</div></div>
									<div class="assembly-row-combined m4v1"><div>*3030</div><div><a href="#3799" class="memory-link">JP 37C2H</a></div><div>Jump to 37C2H for STRING=DATE$+""+TIME$.</div></div>
									<div class="assembly-row-combined both"><div>3033<span class="origrom2">$DATE<span></span></span></div><div><a href="#35BB" class="memory-link">JP 35BBH</a></div><div>Jump to 35BBH to put the DATE onto the upper right hand corner of the screen.</div></div>
								</div>
							</div>

							<br><h2 id="3036">3036 - "$TIME" - Get the time.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<p>On entry, (HL) should be the eight byte output buffer.  On exit, (HL) should contain HH:MM:SS.  All registered altered.</p>
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3036</div><div><a href="#35A0" class="memory-link">JP 35A0H</a></div><div>Jump to 35A0H to put the TIME 10 characters from the upper right hand corner of the screen.</div></div>
								</div>
							</div>

							<br><h2 id="3039">3039 - This set of code plays with the NMI.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3039</div><div>IN A,(E4H)</div><div>Poll Port E4H into A.<br><b>NOTE:</b> Port E4H is the Non-Maskable Interrupt Latch.</div></div>
									<div class="assembly-row-combined m3v1"><div>*303B</div><div>INC A</div><div>Bump A.</div></div>
									<div class="assembly-row-combined m3v1"><div>*303C-303E</div><div><a href="#4049" class="memory-link">JP NZ,4049H</a></div><div>If
 Port E4H plus 1 is NOT zero, then JUMP to the NMI Vector at 4049H 
(which in TRSDOS is just a JUMP to 42BDH which is just a RETurn).  This 
is what happens when a NMI is called while NOT doing disk I/O.  If disk 
I/O was active, then the DOS itself would have an alternate NMI routine 
in the read/write routine which would involve loading the NMI vector to a
 different routine.  In TRSDOS, that would a call to 459CH to load 
(404AH) and (404BH) with 45ADH and loading (4049H) with a status.</div></div>
									<div class="assembly-row-combined m3v1"><div>*303F</div><div>DI</div><div>Disable Interrupts.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3040-3041</div><div><a href="#3015" class="memory-link">JR 3015H</a></div><div>JUMP back 3015H to JUMP to 3455H for Bootstrap.</div></div>

									<div class="assembly-row-combined m3v1"><div>*3042-3044</div><div><a href="#37B4" class="memory-link">JP 37B4H</a></div><div>JUMP to 37B4H of v1.</div></div>
									<div class="assembly-row-combined m3v2"><div>*303B</div><div>BIT 5,A</div><div>Check the 5th Bit of the Non-Maskable Interrupt Latch.</div></div>
									<div class="assembly-row-combined m3v2"><div>*303D</div><div><a href="#351C" class="memory-link">JP 351CH</a></div><div>Jump to 351CH to go to the NMI handler.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3040</div><div><a href="#3015" class="memory-link">JR 3015H</a></div><div>Jump to 3015H for Bootstrap.</div></div>

									<div class="assembly-row-combined m4v1"><div>*303DH-3041H</div><div><a href="#34CE" class="memory-link">JP 34CEH<br>XOR D<br>XOR D</a></div><div>Instead of Jumping to to 3015H to bootstrap, Jump to 34CEH.</div></div>
								</div>
							</div>

							<br><h2 id="3042">3042 - "$SETCAS" - Prompt the User to set the cassette baud rate.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<p>This cal repeats the CASS? dialog on the next line of the 
display, and waits for a H or a L.  Upon return, the baud rate is 
already set accordingly.</p>
								<div class="assembly-table">
									<div class="assembly-row-combined m3v2"><div>*3042</div><div><a href="#37B5" class="memory-link">JP 37B5H</a></div><div>Jump to 37B5H to display the CASS? prompt.</div></div>
									<div class="assembly-row-combined m4v1"><div>*3042</div><div><a href="#310B" class="memory-link">JP 310BH</a></div><div>Jump to 310BH</div></div>
								</div>
							</div>

							<br><h2 id="3045">3045 - Keyboard Rows 0-3, Unshifted, No Caps Lock.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3045</div><div>40 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A</div><div>@abcdefghijklmnopqrstuvwxyz</div></div>
								</div>
							</div>

							<br><h2 id="3060">3060 - Load A with the Computer version number, which is always 1 for a Model III and 0 for a Model 4.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*3060</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3061</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3062</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3063</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3064</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3060</div><div>LD A,(37EAH)</div><div>Load the memory contents of 37EAH into A.<br><b>NOTE:</b> 37EAH is a hard coded 01H.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3063</div><div>OR A</div><div>Set up flags for those memory contents.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3064</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined m4v1"><div>*3060-3064</div><div>NOPs</div><div>Formerly part of the keyboard scan routine, this is now just NOPs</div></div>
								</div>
							</div>

							<br><h2 id="3065">3065 - Keyboard Rows 4-6, Unshifted, No Caps Lock.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3065-3074</div><div>30 31 32 33 34 35 36 37 38 39 3A 3B 2C 2D 2E 2F</div><div>0123456789:;,-./</div></div>
									<div class="assembly-row-combined both"><div>3075-3077</div><div>0D 1F 01</div><div><kbd>ENTER</kbd> <kbd>CLEAR</kbd> <kbd>BREAK</kbd></div></div>
									<div class="assembly-row-combined both"><div>3078-307C</div><div>5B 0A 08 09 20</div><div>05BH <kbd>LINEFEED</kbd> <kbd>BACKSPACE</kbd> <kbd>TAB</kbd> <kbd>SPACE</kbd></div></div>
								</div>
							</div>

							<br><h2 id="307D">307D - Set the Keyboard Repeat Delay Count to 1500.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>307D</div><div>LD HL,05DCH</div><div>Load HL with 05DCH.<br><b>NOTE:</b> 05DCH is 1500.</div></div>
									<div class="assembly-row-combined both"><div>307E</div><div>LD (41FFH),HL</div><div>Load the memory location at 41FFH with 05DCH.<br><b>NOTE:</b> 41FFH holds the keyboard scan repeat delay count.</div></div>
									<div class="assembly-row-combined both"><div>3083</div><div>XOR A</div><div>Clear A and all flags.</div></div>
									<div class="assembly-row-combined both"><div>3084</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined m4v1"><div>*307D-3084</div><div>NOPs</div><div>Formerly part of the keyboard scan routine, ths is now just NOPs</div></div>
								</div>
							</div>

							<br><h2 id="3085">3085 - Keyboard Rows 0-3, shifted, No Caps Lock.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3085-308C</div><div>60 41 42 43 44 45 46 47</div><div><kbd>"</kbd> <kbd>A</kbd> <kbd>B</kbd> <kbd>C</kbd> <kbd>D</kbd> <kbd>E</kbd> <kbd>F</kbd> <kbd>G</kbd></div></div>
									<div class="assembly-row-combined both"><div>308D-3094</div><div>48 49 4A 4B 4C 4D 4E 4F</div><div><kbd>H</kbd> <kbd>I</kbd> <kbd>J</kbd> <kbd>K</kbd> <kbd>L</kbd> <kbd>M</kbd> <kbd>N</kbd> <kbd>O</kbd></div></div>
									<div class="assembly-row-combined both"><div>3095-309F</div><div>50 51 52 53 54 55 56 57 58 59 5A</div><div><kbd>P</kbd> <kbd>Q</kbd> <kbd>R</kbd> <kbd>S</kbd> <kbd>T</kbd> <kbd>U</kbd> <kbd>V</kbd> <kbd>W</kbd> <kbd>X</kbd> <kbd>Y</kbd> <kbd>Z</kbd></div></div>
								</div>
							</div>

							<br><h2 id="30A0">30A0 - Toggle Caps Lock.  This is a mess.  The 
v1 code is a mess and so the v2 code is weird.  v2 has it putting A into
 (HL), clearing A and FLAGS and RETURN.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*30A0</div><div>LD H,L</div><div>Load H with the contents of L.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30A1-30A2</div><div><a href="#3070" class="memory-link">JR Z,3070H</a></div><div>If the ZERO flag is set, JUMP back 3070H, which makes no sense since that's a jump into the alphabet.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30A3-30A5</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0029" class="memory-link">JP C,0029H</a></div><div>If
 the CARRRY FLAG is set, JUMP to 0029H, which makes no sense since 
that's a jump into the middle of an instruction jumping to DOS.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30A0</div><div>LD (HL),A</div><div>Load the memory address pointed to by HL with A.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30A1</div><div>XOR A</div><div>Clear A and all flags.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30A2</div><div>RET</div><div>RETURN.</div></div>

									<div class="assembly-row-combined m3v2"><div>*30A3</div><div>AAAA</div><div>UNUSED GARBAGE.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30A5</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m4v1"><div>*30A0-30A5</div><div>NOPs</div><div>Formerly part of the keyboard scan routine, ths is now just NOPs</div></div>
								</div>
							</div>

							<br><h2 id="30A6">30A6 - Keyboard Rows 4-6, shifted, No Caps Lock.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>30A6-30AB</div><div>21 22 23 24 25 26</div><div><kbd>!</kbd> <kbd>"</kbd> <kbd>#</kbd> <kbd>$</kbd> <kbd>%</kbd> <kbd>&amp;</kbd></div></div>
									<div class="assembly-row-combined both"><div>30AC-30B1</div><div>27 28 29 2A 2B 3C</div><div><kbd>'</kbd> <kbd>(</kbd> <kbd>)</kbd> <kbd>*</kbd> <kbd>+</kbd> <kbd>&lt;</kbd></div></div>
									<div class="assembly-row-combined both"><div>30B2-30B7</div><div>3D 3E 3F 0D 1F 01</div><div><kbd>=</kbd> <kbd>&gt;</kbd> <kbd>?</kbd> <kbd>ENTER</kbd> <kbd>CLEAR</kbd> <kbd>BREAK</kbd></div></div>
									<div class="assembly-row-combined both"><div>30B8-30BC</div><div>1B 1A 18 19 20</div><div><kbd>UP ARROW</kbd> <kbd>DOWN ARROW</kbd> <kbd>LEFT ARROW</kbd> <kbd>RIGHT ARROW</kbd> <kbd>SPACE</kbd></div></div>
								</div>
							</div>

							<br><h2 id="30BD">30BD - Toggle Caps Lock.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*30BD-30BE</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-3.htm#28BF" class="memory-link">CALL 28BFH</a></div><div>GOSUB to 28BFH.<br><b>NOTE:</b> 28BFH computes the amount of space remaining in the string area.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30BF-30C1</div><div>LD HL,40D3H</div><div>Load HL with 40D3H.<br><b>NOTE:</b> 40D3H is generally used as the pointer workspace.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30C2</div><div>PUSH HL</div><div>Push HL onto the STACK.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30BD</div><div>LD A,01H</div><div>Load A with 01H.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30BE</div><div>LD HL,4019H</div><div>Load HL with 4019H.<br><b>NOTE:</b> 4019H holds the caps lock toggle in the keyboard DCB.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30C2</div><div>XOR (HL)</div><div>Invert the contents of the (4019H).</div></div>
									<div class="assembly-row-combined m3v2"><div>*30C3</div><div>JR 30A0H</div><div>JUMP back to 30A0H.</div></div>
									<div class="assembly-row-combined m4v1"><div>*30BD-30C4</div><div>NOPs</div><div>Formerly part of the keyboard scan routine, ths is now just NOPs</div></div>
								</div>
							</div>

							<br><h2 id="30C5">30C5 - Keyboard Rows 0-3, UNshifted, Caps Lock.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>30C5-30CA</div><div>40 41 42 43 44 45</div><div><kbd>@</kbd> <kbd>A</kbd> <kbd>B</kbd> <kbd>C</kbd> <kbd>D</kbd> <kbd>E</kbd></div></div>
									<div class="assembly-row-combined both"><div>30CB-30D0</div><div>46 47 48 49 4A 4B</div><div><kbd>F</kbd> <kbd>G</kbd> <kbd>H</kbd> <kbd>I</kbd> <kbd>J</kbd> <kbd>K</kbd></div></div>
									<div class="assembly-row-combined both"><div>30D1-30D6</div><div>4C 4D 4E 4F 50 51</div><div><kbd>L</kbd> <kbd>M</kbd> <kbd>N</kbd> <kbd>O</kbd> <kbd>P</kbd> <kbd>Q</kbd></div></div>
									<div class="assembly-row-combined both"><div>30D7-30DC</div><div>52 53 54 55 56 57</div><div><kbd>R</kbd> <kbd>S</kbd> <kbd>T</kbd> <kbd>U</kbd> <kbd>V</kbd> <kbd>W</kbd></div></div>
									<div class="assembly-row-combined both"><div>30DD-30DF</div><div>58 59 5A</div><div><kbd>X</kbd> <kbd>Y</kbd> <kbd>Z</kbd></div></div>
								</div>
							</div>

							<br><h2 id="30E0">30E0 - GOSUB to the PRINT SCREEN Routine, Clear A, and RETURN<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*30E0</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30E1</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30E2</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30E3</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v1"><div>*30E4</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30E0</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#01D9" class="memory-link">CALL 01D9H</a></div><div>GOSUB to 01D9H.<br><b>NOTE:</b> 01D9H is the Print Screen Routine.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30E3</div><div>XOR A</div><div>Erase A and Reset flags.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30E4</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined m4v1"><div>*30E0-30E4</div><div>NOPs</div><div>Formerly part of the keyboard scan routine, ths is now just NOPs</div></div>
								</div>
							</div>

							<br><h2 id="30E5">30E5 - Keyboard Rows 4-6, UNshifted, Caps Lock<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>30E5-30EC</div><div>30 31 32 33 34 35 36 37</div><div><kbd>0</kbd> <kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd> <kbd>4</kbd> <kbd>5</kbd> <kbd>6</kbd> <kbd>7</kbd></div></div>
									<div class="assembly-row-combined both"><div>30ED-30F4</div><div>38 39 3A 3B 2C 2D 2E 2F</div><div><kbd>8</kbd> <kbd>9</kbd> <kbd>:</kbd> <kbd>;</kbd> <kbd>,</kbd> <kbd>-</kbd> <kbd>.</kbd> <kbd>/</kbd></div></div>
									<div class="assembly-row-combined both"><div>30F5-30FC</div><div>0D 1F 01 5B 0A 08 09 20</div><div><kbd>ENTER</kbd> <kbd>CLEAR</kbd> <kbd>BREAK</kbd> <kbd>UP ARROW</kbd> <kbd>LINE FEED</kbd> <kbd>BACKSPACE</kbd> <kbd>TAB</kbd> <kbd>SPACE</kbd></div></div>
								</div>
							</div>

							<br><h2 id="30FD">30FD - Checking for a <kbd>BREAK</kbd> key during a cassette operation<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*30FD-30FF</div><div>LD DE,40D6H</div><div>Load DE with 40D6H.<br><b>NOTE:</b> 40D6H holds the next available string location.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3100</div><div>RST 18H</div><div>Call
 the COMPARE DE:HL routine, which numerically compares DE and HL. Will 
not work for signed integers (except positive ones). Uses the A-register
 only. The result of the comparison is returned in the status register 
as:  <table style="border-collapse: collapse; border: 1px solid black;"><tbody><tr style="background-color: #f0f0f0;"><td style="border: 1px solid black; padding: 8px;">Condition</td><td style="border: 1px solid black; padding: 8px;">Flag</td></tr><tr><td style="border: 1px solid black; padding: 8px;">If HL &lt; DE</td><td style="border: 1px solid black; padding: 8px;">CARRY SET</td></tr><tr><td style="border: 1px solid black; padding: 8px;">If HL &gt; DE</td><td style="border: 1px solid black; padding: 8px;">NO CARRY</td></tr><tr><td style="border: 1px solid black; padding: 8px;">If HL ‚â† DE</td><td style="border: 1px solid black; padding: 8px;">NZ</td></tr><tr><td style="border: 1px solid black; padding: 8px;">If HL = DE</td><td style="border: 1px solid black; padding: 8px;">Z</td></tr></tbody></table></div></div>
									<div class="assembly-row-combined m3v1"><div>*3101-3103</div><div>LD (40B3H),HL</div><div>Load HL with the memory contents of 40B3H.<br><b>NOTE:</b> 40B3H is the current position in the workspace table.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3104</div><div>POP HL</div><div>Restore HL from the STACK.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30FD</div><div><a href="#30E0" class="memory-link">JR Z,30E0H</a></div><div>If the ZERO FLAG is set, jump back to 30E0H which will then call the print screen routine.</div></div>
									<div class="assembly-row-combined m3v2"><div>*30FF</div><div>AND (HL)</div><div>Prepare to check for a <kbd>BREAK</kbd> by masking A against the memory contents of HL ...</div></div>
									<div class="assembly-row-combined m3v2"><div>*3100</div><div>CP 01H</div><div>... and COMPARING it to 01H.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3102</div><div>RET NZ</div><div>If the result of the compare is NOT zero, then RETURN.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3103</div><div>RST 28H</div><div>If we are here, then a <kbd>BREAK</kbd> was hit, so call RST 28H to handle the <kbd>BREAK</kbd>.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3104</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined m4v1"><div>*30FD-3144H</div><div>NOPs</div><div>Formerly
 part of the keyboard scan routine (included three subroutines and two 
lookup tables), now replaced by eight NOP instructions (30FDH - 3104H}, a
 portion of the non-disk bootstrap routine that prompts the user to set 
the cassette baud rate (3105H - 310AH), the $SETCAS routine which 
prompts the user to set the cassette baud rate (310BH - 313AH), and a 
portion of the keyboard sca.n routine which CALLS the screen print 
routine at 34FDH, then executes XOR A and RET instructions to return a 
null character (313BH - 313FH). The final five bytes (3140H through 
3144H) are now NOP instructions.</div></div>
								</div>
							</div>

							<br><h2 id="3105">3105 - Keyboard Rows 0-3, shifted, Caps Lock<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3105-310C</div><div>60 41 42 43 44 45 46 47</div><div><kbd>"</kbd> <kbd>A</kbd> <kbd>B</kbd> <kbd>C</kbd> <kbd>D</kbd> <kbd>E</kbd> <kbd>F</kbd> <kbd>G</kbd></div></div>
									<div class="assembly-row-combined both"><div>310D-3114</div><div>48 49 4A 4B 4C 4D 4E 4F</div><div><kbd>H</kbd> <kbd>I</kbd> <kbd>J</kbd> <kbd>K</kbd> <kbd>L</kbd> <kbd>M</kbd> <kbd>N</kbd> <kbd>O</kbd></div></div>
									<div class="assembly-row-combined both"><div>3115-311F</div><div>50 51 52 53 54 55 56 57 58 59 5A</div><div><kbd>P</kbd> <kbd>Q</kbd> <kbd>R</kbd> <kbd>S</kbd> <kbd>T</kbd> <kbd>U</kbd> <kbd>V</kbd> <kbd>W</kbd> <kbd>X</kbd> <kbd>Y</kbd> <kbd>Z</kbd></div></div>
								</div>
							</div>

							<br><h2 id="3125">3120 - Go to the next Keyboard row<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*3120</div><div>INC BC</div><div>Bump BC.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3121-3123</div><div>LD HL,1803H</div><div>Load HL with 1803H.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3124-3126</div><div>JP P,2100H</div><div>If the PARITY BIT is set, Jump to 2100H which sends a <span class="code">CARRIAGE RETURN</span> to the current output device, calls a DOS link, Clears A and FLAGS, and RETURNS.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3120</div><div>INC D</div><div>Bump D so that D holds the NEXT row number.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3121</div><div>INC HL</div><div>Bump HL so that HL holds the NEXT buffer location.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3122</div><div>RLC C</div><div>We
 need C to point to the next row of keys, so we rotate C left one bit, 
copying BIT 7 to the CARRY FLAG and the CARRY FLAG to BIT 0.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3124</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3125</div><div>NOP</div><div>No Operation.</div></div>
								</div>
							</div>

							<br><h2 id="3125">3125 - Keyboard Rows 4-6, Shifted, Caps Lock<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*3125</div><div class="span2and3">!"#$%&amp;'()*+&lt;=&gt;? 0D 1F 01 1B 1A 18 19 20</div></div>
									<div class="assembly-row-combined m3v2"><div>*3126</div><div class="span2and3">!"#$%&amp;'()*+&lt;=&gt;? 0D 1F 01 1B 1A 18 19 20</div></div>
								</div>
							</div>

							<br><h2 id="313D">313D - Restore Scanning Variables.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<p>This routine is called from <a href="#33CC" class="memory-link">33CC</a> which is in the middle of the keyboard input routine.</p>
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*313D</div><div>EX DE,HL</div><div>Exchange DE and HL.</div></div>
									<div class="assembly-row-combined m3v1"><div>*313E</div><div>POP AF</div><div>Restore AF from the STACK.</div></div>
									<div class="assembly-row-combined m3v1"><div>*313F</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3140</div><div>POP AF</div><div>Restore AF from the STACK.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3141-3142</div><div>LD E,1AH</div><div>Load E with 1AH.</div></div>
									<div class="assembly-row-combined m3v1"><div>*3143-3145</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-3.htm#20A2" class="memory-link">JP Z,20A2H</a></div><div>If the ZERO FLAG is set, JUMP to 20A2H.<br><b>NOTE:</b> 20A2H is in the middle of the PRINT routine, and is at the point where we know we have a At this point we have a PRINT@nnnn.</div></div>
									<div class="assembly-row-combined m3v2"><div>*313D</div><div>LD A,(41FDH)</div><div>If the ZERO FLAG is not set, then load A with the memory contents of 41FDH.<br><b>NOTE:</b> 41FDH is the saved position in the keyboard scan.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3140</div><div>LD L,A</div><div>Load L with the A.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3141</div><div>LD A,(41FEH)</div><div>Load A with the memory contents of 41FEH.<br><b>NOTE:</b> 41FEH is the saved IMAGE at the saved position in the keyboard scan data.</div></div>
									<div class="assembly-row-combined m3v2"><div>*3144</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3145">3145 - Printer Character Table Codes 32-127.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined m3v1"><div>*3146</div><div class="span2and3">20
 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 33 34 35 36 37 38
 39 3A 3B 3C 3D 3E 3F 40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50
 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F 40 61 62 63 64 65 66 67 68
 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 7B 7C 7D 7E 7F 3E</div></div>
									<div class="assembly-row-combined m3v2"><div>*3145</div><div class="span2and3">20
 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 33 34 35 36 37 38
 39 3A 3B 3C 3D 3E 3F 40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50
 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F 40 61 62 63 64 65 66 67 68
 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 7B 7C 7D 7E 7F 3E</div></div>
									<div class="assembly-row-combined m4v1"><div>*3145</div><div class="span2and3">20
 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F 30 31 32 33 34 35 36 37 38
 39 3A 3B 3C 3D 3E 3F 40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50
 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F 60 61 62 63 64 65 66 67 68
 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 7B 7C 7D 7E 7F 3E</div></div>
								</div>
							</div>

							<br><h2 id="31A5">31A5 - Output the TIMING MARK to the cassette<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>31A5</div><div>LD A,01H</div><div>Load A with 01H.  This is to prepare to send 0.46V to tape.</div></div>
									<div class="assembly-row-combined both"><div>31A7</div><div>OUT (0FFH),A</div><div>Load Port FFH with A.<br><b>NOTE:</b> Port FFH is the cassette port.  When outputting to FFH, Bits Zero and 1 set to: 00 is .85V, 01 is .46V, and 10 is 0.0V.</div></div>
									<div class="assembly-row-combined both"><div>31A9</div><div>LD B,0DH</div><div>Load B with 0DH in as a loop counter.</div></div>
									<div class="assembly-row-combined both"><div>31AB</div><div><a href="#31AB" class="memory-link">DJNZ 31ABH</a></div><div>Loop this instruction until B hits ZERO.</div></div>
									<div class="assembly-row-combined both"><div>31AD</div><div>LD A,02H</div><div>Load A with 01H.  This is to prepare to send 0.0V to tape.</div></div>
									<div class="assembly-row-combined both"><div>31AF</div><div>OUT (0FFH),A</div><div>Load Port FFH with A.<br><b>NOTE:</b> Port FFH is the cassette port.  When outputting to FFH, Bits Zero and 1 set to: 00 is .85V, 01 is .46V, and 10 is 0.0V.</div></div>
									<div class="assembly-row-combined both"><div>31B1</div><div>LD B,0DH</div><div>Load B with 0DH in as a delay.</div></div>
									<div class="assembly-row-combined both"><div>31B3</div><div><a href="#31B3" class="memory-link">DJNZ 31B3H</a></div><div>Loop this instruction until B hits ZERO.</div></div>
									<div class="assembly-row-combined both"><div>31B5</div><div><a href="#31F3" class="memory-link">CALL 31F3H</a></div><div>GOSUB to 31F3 to send 0.46V to tape.<br><b>NOTE:</b> 31F3H resets the cassette port, and then output a 0 to the Cassette Port FFH.</div></div>
									<div class="assembly-row-combined both"><div>31B8</div><div>LD B,78H</div><div>Load B with 78H in as a delay.</div></div>
									<div class="assembly-row-combined both"><div>31BA</div><div><a href="#31BA" class="memory-link">DJNZ 31BAH</a></div><div>Loop this instruction until B hits ZERO.</div></div>
									<div class="assembly-row-combined both"><div>31BC</div><div>RET</div><div>RETURN.</div></div>
									<div class="assembly-row-combined both" id="31BD"><div>31BD</div><div>LD HL,2CA5H</div><div>Load HL with 2CA5H.<br><b>NOTE:</b> 2CA5H is the "BAD" message string.</div></div>
								</div>
							</div>

							<br><h2 id="31C0">31C0 - Turn Off The Cassette<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>31C0</div><div>LD A,(4213H)</div><div>Load A with the memory contents of 4213H.<br><b>NOTE:</b> 4213H is the default interrupt vector setting for the cassette.</div></div>
									<div class="assembly-row-combined both"><div>31C3</div><div>OUT (0E0H),A</div><div>Output A to Port E0H.<br><b>NOTE:</b> Port E0H is the maskable interrupt latch, which directs jumps.
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Jump Address</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>3365H</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>3369H</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4046H</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>403DH</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4206H</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4209H</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4040H</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>4043H</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>31C5</div><div>IN A,(FFH)</div><div>INPut the contents of Port FFH and store the result in A.<br><b>NOTE:</b> Port FFH is the cassertte port read status.  If the 7th bit is 0 then it is low, and if 7th bith is 1 then it is high.</div></div>
									<div class="assembly-row-combined both"><div>31C7</div><div>LD A,(4210H)</div><div>Load A with the memory contents of 4210H.<br><b>NOTE:</b> 4210H is the bit mask for Port ECH.  Port ECH is the Miscellaneous Controls port, which covers
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>31CA</div><div>AND FDH</div><div>Mask A against FDH (1111 1101) to zero bit 1.</div></div>
									<div class="assembly-row-combined both"><div>31CC</div><div><a href="#31ED" class="memory-link">CALL 31EDH</a></div><div>GOSUB to 31EDH to save the mask into 4210H, output it to Port ECH, and return here.</div></div>
									<div class="assembly-row-combined both"><div>31CF</div><div>EI</div><div>Enable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>31D0</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="31D1">31D1 - Turn On The Cassette - Part 1.  This 
will remove the return address, save DE and BC, restore the return 
address, and than blank the "**"<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>31D1</div><div>EX DE,HL</div><div>Swap DE and HL to remove the return address.</div></div>
									<div class="assembly-row-combined both"><div>31D2</div><div>EX (SP),HL</div><div>Swap the memory contents pointed to by the STACK POINTER and HL (which is now what DE was).</div></div>
									<div class="assembly-row-combined both"><div>31D3</div><div>PUSH BC</div><div>Save BC to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>31D4</div><div>PUSH HL</div><div>Save HL to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>31D5</div><div>EX DE,HL</div><div>Swap DE and HL back.</div></div>
									<div class="assembly-row-combined both"><div>31D6</div><div>IN A,(ECH)</div><div>Poll Port ECH and put the results into A.<br><b>NOTE:</b> Port ECH is the Miscellaneous Controls port, which covers
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>31D8</div><div>LD DE,"  "</div><div>Load DE with <span class="code">SPACE</span><span class="code">SPACE</span>.</div></div>
									<div class="assembly-row-combined both"><div>31DB</div><div>LD (3C3EH),DE</div><div>Load the screen memory location of 3C3EH with DE.</div></div>
									<div class="assembly-row-combined both"><div>31DF</div><div><a href="#31E8" class="memory-link">CALL 31E8H</a></div><div>GOSUB to 31E8H to turn on the cassette.</div></div>
									<div class="assembly-row-combined both"><div>31E2</div><div>LD BC,7D00H</div><div>Load a delay count of 7D00 (Decimal: 32,000) into BC.</div></div>
									<div class="assembly-row-combined both"><div>31E5</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0060" class="memory-link">JP 0060H</a></div><div>Jump to 0060H, which JUMPs to the delay routine at 01FBH and RETURNS.</div></div>
								</div>
							</div>

							<br><h2 id="31E8">31E8 - Turn On The Cassette - Actually Set the Bit Mask and Output the Command<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>31E8</div><div>LD A,(4210H)</div><div>Load A with the memory contents of 4210H.<br><b>NOTE:</b> 4210H is the bit mask for Port ECH.  Port ECH is the Miscellaneous Controls port, which covers
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>31EB</div><div>OR 02H</div><div>OR A with 02H (0000 0010) to set Bit 1.</div></div>
									<div class="assembly-row-combined both"><div>31ED</div><div>LD (4210H),A</div><div>Save revised Bit Mask back to 4210H.<br><b>NOTE:</b> 4210H is the bit mask for Port ECH.  Port ECH is the Miscellaneous Controls port, which covers
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>31F0</div><div>OUT (0ECH),A</div><div>Output that Bit Mask to port 0ECH.</div></div>
									<div class="assembly-row-combined both"><div>31F2</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="31F3">31F3 - Reset the Cassette Port.  This routine OUTputs a 0 to the Cassette Port FFH<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>31F3</div><div>XOR A</div><div>We want to reset the cassette port so we zero A.</div></div>
									<div class="assembly-row-combined both"><div>31F4</div><div>OUT (0FFH),A</div><div>Load Port FFH with A.<br><b>NOTE:</b> Port FFH is the cassette port.  When outputting
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Bit Number (Port FFH)</td><td class="31c0-first"></td><td>Voltage Output</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr><td>R</td><td>R</td><td>R</td><td>R</td><td>R</td><td>R</td><td>0</td><td>0</td><td class="spacer"></td><td>0.85V</td></tr>
    <tr><td>R</td><td>R</td><td>R</td><td>R</td><td>R</td><td>R</td><td>0</td><td>1</td><td class="spacer"></td><td>0.46V</td></tr>
    <tr><td>R</td><td>R</td><td>R</td><td>R</td><td>R</td><td>R</td><td>1</td><td>0</td><td class="spacer-last"></td><td>0.0V</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>31F6</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="31F7">31F7 - Check to see if we have a <span class="code">PRINT #</span> command and, if so, get the port number, validate that the next character is a <span class="code">,</span> and return.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>31F7</div><div>LD A,(HL)</div><div>Load Register A with the memory contents pointed to by Register Pair HL.</div></div>
									<div class="assembly-row-combined both"><div>31F8</div><div>SUB 23H</div><div>Subtract 23H so that we can test to see if the caller was a <span class="code">PRINT #</span> command.</div></div>
									<div class="assembly-row-combined both"><div>31FA</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0253" class="memory-link">JP NZ,0253H</a></div><div>If that subtraction didn't result in a ZERO (a match), the JUMP to 0253H.<br><b>NOTE:</b> 0253H is in the middle of the "Write a Byte to Cassette" Routine.  It ends in a RETURN.</div></div>
									<div class="assembly-row-combined both"><div>31FD</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-3.htm#2B01" class="memory-link">CALL 2B01H</a></div><div>If it was a <span class="code">PRINT #</span> command, then GOSUB to 2B01H to get the device number.</div></div>
									<div class="assembly-row-combined both"><div>3200</div><div>RST 08H ‚áí ","</div><div>So now we have <span class="code">PRINT #n</span> and the next character needs to be a <span class="code">,</span>, so call RST 08 to check for the next character against a "," and generate a <span class="code">SYNTAX ERROR</span> if it wasn't.</div></div>
									<div class="assembly-row-combined both"><div>3202</div><div>RET</div><div>If we are here, then we have <span class="code">PRINT #n,</span> so we RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3203">3203 - Vector for a SLOW cassette read<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3203</div><div>LD B,08H</div><div>Load B with 8, representing the need to LOOP for 8 bits.</div></div>
									<div class="assembly-row-combined both"><div>3205</div><div><a href="#3220" class="memory-link">CALL 3220H</a></div><div>GOSUB to 3220H.<br><b>NOTE:</b> 3220H reads the tape until it finds a timing mark or the <kbd>BREAK</kbd> is hit.</div></div>
									<div class="assembly-row-combined both"><div>3208</div><div><a href="#3205" class="memory-link">DJNZ 3205H</a></div><div>Loop that GOSUB 8 times.</div></div>
									<div class="assembly-row-combined both" id="320A"><div>320A</div><div>LD A,(4212H)</div><div>Put the contents of 4212H into A.<br><b>NOTE:</b> 4212H holds the cassette blinker counter.</div></div>
									<div class="assembly-row-combined both"><div>320D</div><div>INC A</div><div>Bump A.</div></div>
									<div class="assembly-row-combined both"><div>320E</div><div>AND 5FH</div><div>Mask A against 5F (0101 1111) to turn Bit 7 and Bit 5 off.</div></div>
									<div class="assembly-row-combined both"><div>3210</div><div>LD (4212H),A</div><div>Put A into 4212H.<br><b>NOTE:</b> 4212H holds the cassette blinker counter.</div></div>
									<div class="assembly-row-combined both"><div>3213</div><div><a href="#321D" class="memory-link">JR NZ,321DH</a></div><div>If the masked count is NOT ZERO, then skip the next few instructions.</div></div>
									<div class="assembly-row-combined both"><div>3215</div><div>LD A,(3C3FH)</div><div>Load A with the screen contents at position 3C3FH.</div></div>
									<div class="assembly-row-combined both"><div>3218</div><div>XOR 0AH</div><div>XOR
 A against 0AH (00001010).  This turns a "*" into a " " and vice versa 
as a a "*" is 0010 1010 and when you XOR that against 0000 1010 you get 
0010 0000 which is a " " (and vice versa).
<table class="bit-table-breakdown"> <tbody><tr class="header"><td colspan="8">Bit Number (7 down to 0)</td><td class="31c0-first"></td><td>Value (Char / Hex / Dec)</td></tr> <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td class="spacer"></td><td>" " / 20H / 32</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td class="spacer"></td><td>0AH / 10</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td class="spacer-last"></td><td>XOR Result / 2AH / 42 ("*")</td></tr>
</tbody></table>

<table class="bit-table-breakdown"> <tbody><tr class="header"><td colspan="8">Bit Number (7 down to 0)</td><td class="31c0-first"></td><td>Value (Char / Hex / Dec)</td></tr> <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td class="spacer"></td><td>"*" / 2AH / 42</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td class="spacer"></td><td>0AH / 10</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td class="spacer-last"></td><td>XOR Result / 20H / 32 (" ")</td></tr>
</tbody></table></div></div>

									<div class="assembly-row-combined both"><div>321A</div><div>LD (3C3FH),A</div><div>Put the revised A onto the screen at position 3C3FH.</div></div>
									<div class="assembly-row-combined both"><div>321D</div><div>LD A,D</div><div>Put D (the byte) into A.</div></div>
									<div class="assembly-row-combined both"><div>321E</div><div><a href="#3298" class="memory-link">JR 3298H</a></div><div>JUMP to 3298H to restore the registers and RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3220">3220 - Cassette - Keep reading tape looking for a timing mark or <kbd>BREAK</kbd>.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3220</div><div>PUSH BC</div><div>Save BC to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3221</div><div>IN A,(FFH)</div><div>Poll Port FFH with the results into Register A.<br><b>NOTE:</b> FFH is the Cassette Port.</div></div>
									<div class="assembly-row-combined both"><div>3223</div><div>RLA</div><div>Put
 the level received in A into the Carry Bit by rotating A left 1 bit 
(putting bit 7 into the CARRY FLAG and the old CARRY FLAG into bit 0).</div></div>
									<div class="assembly-row-combined both"><div>3224</div><div><a href="#322E" class="memory-link">JR C,322EH</a></div><div>If the CARRY FLAG is set then the timing mark was found, so JUMP to 322EH.</div></div>
									<div class="assembly-row-combined both"><div>3226</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#028D" class="memory-link">CALL 028DH</a></div><div>GOSUB to 028DH to check for a <kbd>BREAK</kbd> key.</div></div>
									<div class="assembly-row-combined both"><div>3229</div><div><a href="#3221" class="memory-link">JR Z,3221H</a></div><div>Loop back to 3221H until we get either a timing mark or a <kbd>BREAK</kbd> key.</div></div>
									<div class="assembly-row-combined both"><div>322B</div><div><a href="#335C" class="memory-link">JP 335CH</a></div><div>If we are here, then we got a <kbd>BREAK</kbd> key, so JUMP to 335CH.</div></div>
								</div>
							</div>

							<br><h2 id="322E">322E - Cassette - Wait for the timing mark to pass and the next data to show up.  Put that data into Bit 0 of D.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<p class="debug-note">First, wait for 6EH Units (the length of the timing mark)</p>
									<div class="assembly-row-combined both"><div>322E</div><div>LD B,6EH</div><div>Load B with 6EH, which is the length of the timing mark.</div></div>
									<div class="assembly-row-combined both"><div>3230</div><div><a href="#3230" class="memory-link">DJNZ 3230H</a></div><div>Loop until B is 0.</div></div>
									<p class="debug-note">Reset the cassette port</p>
									<div class="assembly-row-combined both"><div>3232</div><div><a href="#31F3" class="memory-link">CALL 31F3H</a></div><div>GOSUB to 31F3H to RESET the cassette port.</div></div>
									<p class="debug-note">Next, wait for 98H Units (the length until a data pulse is expected)</p>
									<div class="assembly-row-combined both"><div>3235</div><div>LD B,98H</div><div>Load B with 98H, which is when the next data pulse should be available.</div></div>
									<div class="assembly-row-combined both"><div>3237</div><div><a href="#3237" class="memory-link">DJNZ 3237H</a></div><div>Loop until B is 0.</div></div>
									<p class="debug-note">... continue</p>
									<div class="assembly-row-combined both"><div>3239</div><div>IN A,(FFH)</div><div>Poll Port FFH and put the results into A.<br><b>NOTE:</b> Port FFH is the Cassette Port.</div></div>
									<div class="assembly-row-combined both"><div>323B</div><div>POP BC</div><div>Restore BC from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>323C</div><div>RLA</div><div>Rotate
 A left one bit, with the contents of BIT 7 being put into the CARRY 
FLAG and the CARRY FLAG are put into BIT 0.  This puts the read data 
into the CARRY FLAG.</div></div>
									<div class="assembly-row-combined both"><div>323D</div><div>RL D</div><div>Rotate
 D left one bit, with the contents of BIT 7 being put into the CARRY 
FLAG and the CARRY FLAG are put into BIT 0.  This puts the read data 
into BIT 0 of D.</div></div>
									<div class="assembly-row-combined both"><div>323F</div><div><a href="#31F3" class="memory-link">JR 31F3H</a></div><div>JUMP to 31F3H to reset the cassette port and RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3241">3241 - Vector for a SLOW cassette write.  On entry A is the byte to output.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3241</div><div>PUSH AF</div><div>Save AF to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3242</div><div>PUSH BC</div><div>Save BC to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3243</div><div>PUSH DE</div><div>Save DE to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3244</div><div>LD C,08H</div><div>Load C with an 8, representing 8 bits to be written.</div></div>
									<div class="assembly-row-combined both"><div>3246</div><div>LD D,A</div><div>Load D with A.<br><b>NOTE:</b> D will be the DATA BYTE.</div></div>
									<div class="assembly-row-combined both"><div>3247</div><div><a href="#31A5" class="memory-link">CALL 31A5H</a></div><div>GOSUB to 31A5H.<br><b>NOTE:</b> 31A5H outputs the timing mark.</div></div>
									<div class="assembly-row-combined both"><div>324A</div><div>RLC D</div><div>Rotate
 D left one bit, with the contents of BIT 7 being put into BOTH the 
CARRY FLAG and BIT 0.  This puts the DATA BIT into CARRY.</div></div>
									<div class="assembly-row-combined both"><div>324C</div><div><a href="#3258" class="memory-link">JR NC,3258H</a></div><div>If
 there is no DATA BIT (because CARRY is 0) then JUMP to 3258H to wait 
the appropriate amount of time for a 0 byte to be written.</div></div>
									<div class="assembly-row-combined both"><div>324E</div><div><a href="#31A5" class="memory-link">CALL 31A5H</a></div><div>If we are here, then there was a PULSE, so GOSUB to 31A5H to output the timing bit.</div></div>
									<div class="assembly-row-combined both" id="3251"><div>3251</div><div>DEC C</div><div>Reduce the counter holding the number of bits to deal with by 1.</div></div>
									<div class="assembly-row-combined both"><div>3252</div><div><a href="#3247" class="memory-link">JR NZ,3247H</a></div><div>Loop back to 3247H until the counter in C hits 0.</div></div>
									<div class="assembly-row-combined both"><div>3254</div><div>POP DE</div><div>Restore DE from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3255</div><div>POP BC</div><div>Restore BC from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3256</div><div>POP AF</div><div>Restore AF from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3257</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3258">3258 - "Write a 0 Bit" by simply waiting the appropriate amount of time and doing nothing.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3258</div><div>LD B,9AH</div><div>Set a delay of 9A.</div></div>
									<div class="assembly-row-combined both"><div>325A</div><div><a href="#325A" class="memory-link">DJNZ 325AH</a></div><div>Loop until that hits zero.</div></div>
									<div class="assembly-row-combined both"><div>325C</div><div><a href="#3251" class="memory-link">JR 3251H</a></div><div>JUMP to 3251H.</div></div>
								</div>
							</div>

							<br><h2 id="325E">325E - SLOW tape header write<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>325E</div><div>PUSH HL</div><div>Save HL to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>325F</div><div>LD HL,3241H</div><div>Load HL with 3241H.<br><b>NOTE:</b> 3241H is the Vector for a SLOW cassette write.</div></div>
									<div class="assembly-row-combined both"><div>3262</div><div>LD (420CH),HL</div><div>Load the memory contents of 420CH with HL.<br><b>NOTE:</b> 420CH is the TAPE WRITE VECTOR.</div></div>
									<div class="assembly-row-combined both"><div>3265</div><div>LD B,53H</div><div>Load B with 53H (Decimal: 83) in prepartion to output 83 ZEROes.</div></div>
									<div class="assembly-row-combined both"><div>3267</div><div>XOR A</div><div>Clear A and all flags.</div></div>
									<div class="assembly-row-combined both"><div>3268</div><div><a href="#3241" class="memory-link">CALL 3241H</a></div><div>GOSUB to 3241H.<br><b>NOTE:</b> 3241H is the Vector for a SLOW cassette write.</div></div>
									<div class="assembly-row-combined both"><div>326B</div><div><a href="#3268" class="memory-link">DJNZ 3268H</a></div><div>Loop back to 3268H until 63 ZEROes have been written.</div></div>
									<div class="assembly-row-combined both"><div>326D</div><div>LD A,0A5H</div><div>Load A with A5H.<br><b>NOTE:</b> A5H is the OUTPUT SYNC BYTE.</div></div>
									<div class="assembly-row-combined both"><div>326F</div><div><a href="#3241" class="memory-link">CALL 3241H</a></div><div>GOSUB to 3241H.<br><b>NOTE:</b> 3241H is the Vector for a SLOW cassette write.</div></div>
									<div class="assembly-row-combined both"><div>3272</div><div><a href="#3297" class="memory-link">JR 3297H</a></div><div>JUMP to 3297H to restore all the registers and RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3274">3274 - SLOW tape header read<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3274</div><div>PUSH HL</div><div>Save HL to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3275</div><div>LD HL,3203H</div><div>Load HL with 3203H.<br><b>NOTE:</b> 3203H is the vector for a SLOW cassette read.</div></div>
									<div class="assembly-row-combined both"><div>3278</div><div>LD (420EH),HL</div><div>Put the vector for a slow cassette read into the memory location at 420EH.<br><b>NOTE:</b> 420EH is the TAPE READ VECTOR.</div></div>
									<div class="assembly-row-combined both"><div>327B</div><div>LD B,40H</div><div>Load B with 40H to set up a loop of 64 to try to find 64 zeroes.</div></div>
									<div class="assembly-row-combined both"><div>327D</div><div>LD D,00H</div><div>Load D with 0.</div></div>
									<div class="assembly-row-combined both"><div>327F</div><div><a href="#3220" class="memory-link">CALL 3220H</a></div><div>GOSUB to 3220H.<br><b>NOTE:</b> 3220H will keep reading tape looking for a timing mark or <kbd>BREAK</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>3282</div><div>LD A,D</div><div>Load A with the D (the data byte) to begin to check the current data byte.</div></div>
									<div class="assembly-row-combined both"><div>3283</div><div>OR A</div><div>Set up the flags.</div></div>
									<div class="assembly-row-combined both"><div>3284</div><div><a href="#327B" class="memory-link">JR NZ,327BH</a></div><div>LOOP back to 327BH until A is ZERO.</div></div>
									<div class="assembly-row-combined both"><div>3286</div><div><a href="#327F" class="memory-link">DJNZ 327FH</a></div><div>Loop back to 327FH 64 times.</div></div>
									<div class="assembly-row-combined both"><div>3288</div><div><a href="#3220" class="memory-link">CALL 3220H</a></div><div>GOSUB to 3220H.<br><b>NOTE:</b> 3220H reads the tape until it finds a timing mark or the <kbd>BREAK</kbd> is hit.</div></div>
									<div class="assembly-row-combined both"><div>328B</div><div>LD A,D</div><div>Load A with the D (the data byte) to begin to check the current data byte.</div></div>
									<div class="assembly-row-combined both"><div>328C</div><div>CP 0A5H</div><div>Compare A to A5H looking for a SYNC BYTE.</div></div>
									<div class="assembly-row-combined both"><div>328E</div><div><a href="#3288" class="memory-link">JR NZ,3288H</a></div><div>JUMP back to to 3288H if a SYNC BYTE wasn't found.</div></div>
									<div class="assembly-row-combined both" id="3290"><div>3290</div><div>LD HL,"**"</div><div>In preparation to display a "**", load HL with <span class="code">**</span>.</div></div>
									<div class="assembly-row-combined both"><div>3293</div><div>LD (3C3EH),HL</div><div>Put HL onto the screen at location 3C3EH.</div></div>
									<div class="assembly-row-combined both"><div>3296</div><div>LD A,H</div><div>Load A with H (which is a <span class="code">*</span>.</div></div>
									<div class="assembly-row-combined both"><div>3297</div><div>POP HL</div><div>Restore HL from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3298</div><div>POP BC</div><div>Restore BC from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3299</div><div>POP DE</div><div>Restore DE from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>329A</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="329B">329B - FAST tape header write.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>329B</div><div>PUSH HL</div><div>Save HL to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>329C</div><div>LD HL,32BAH</div><div>Load HL with 32BAH.<br><b>NOTE:</b> 32BAH is the VECTOR TO FAST WRITE.</div></div>
									<div class="assembly-row-combined both"><div>329F</div><div>LD (420CH),HL</div><div>Load the memory contents of 420CH with HL.<br><b>NOTE:</b> 420CH is the TAPE WRITE VECTOR.</div></div>
									<div class="assembly-row-combined both"><div>32A2</div><div>LD B,00H</div><div>Load B with 00H to set up a loop of 256 to output 256 "55H" bytes.</div></div>
									<div class="assembly-row-combined both"><div>32A4</div><div>LD A,55H</div><div>Load A with "55H".</div></div>
									<div class="assembly-row-combined both"><div>32A6</div><div><a href="#32B4" class="memory-link">CALL 32B4H</a></div><div>GOSUB to 32B4H.<br><b>NOTE:</b> 32B4 restore all registers from the STACK, and Fill C with A, and JUMP to cassette write</div></div>
									<div class="assembly-row-combined both"><div>32A9</div><div><a href="#32A4" class="memory-link">DJNZ 32A4H</a></div><div>LOOP back to 32A4H 256 times.</div></div>
									<div class="assembly-row-combined both"><div>32AB</div><div>LD A,7FH</div><div>Load A with 7FH.<br><b>NOTE:</b> 7FH is the OUTPUT SYNC BYTE.</div></div>
									<div class="assembly-row-combined both"><div>32AD</div><div><a href="#32B4" class="memory-link">CALL 32B4H</a></div><div>GOSUB to 32B4H.<br><b>NOTE:</b> 32B4 restore all registers from the STACK, and Fill C with A, and JUMP to cassette write</div></div>
									<div class="assembly-row-combined both"><div>32B0</div><div>LD A,A5H</div><div>Load A with A5H.<br><b>NOTE:</b> A5H is the SLOW SYNC BYTE.</div></div>
									<div class="assembly-row-combined both"><div>32B2</div><div><a href="#3297" class="memory-link">JR 3297H</a></div><div>JUMP to 3297H to restore all the registers and RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="32B4">32B4 - Restore all registers from the STACK, and Fill C with A, and JUMP to cassette write.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>32B4</div><div>PUSH AF</div><div>Save AF to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32B5</div><div>PUSH BC</div><div>Save BC to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32B6</div><div>PUSH DE</div><div>Save DE to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32B7</div><div>LD C,A</div><div>Load C with A.</div></div>
									<div class="assembly-row-combined both"><div>32B8</div><div><a href="#32C1" class="memory-link">JR 32C1H</a></div><div>JUMP to 32C1H.<br><b>NOTE:</b> 32C1H will write to cassette without a start bit.</div></div>
								</div>
							</div>

							<br><h2 id="32BA">32BA - Save all registers to the STACK, and Fill C with A, GOSBUB to write out the START BIT ...<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>32BA</div><div>PUSH AF</div><div>Save AF to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32BB</div><div>PUSH BC</div><div>Save BC to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32BC</div><div>PUSH DE</div><div>Save DE to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32BD</div><div>LD C,A</div><div>Load C with A.</div></div>
									<div class="assembly-row-combined both"><div>32BE</div><div><a href="#333E" class="memory-link">CALL 333EH</a></div><div>GOSUB to 333EH to write the START BIT.</div></div>
								</div>
							</div>

							<br><h2 id="32C1">32C1 - Call 3335H to Output a Bit 8 Times<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>32C1</div><div>LD B,08H</div><div>Load B with an 8 to set up a loop for 8 bits.</div></div>
									<div class="assembly-row-combined both"><div>32C3</div><div><a href="#3335" class="memory-link">CALL 3335H</a></div><div>GOSUB to 3335H to output the bit.</div></div>
									<div class="assembly-row-combined both"><div>32C6</div><div><a href="#32C3" class="memory-link">DJNZ 32C3H</a></div><div>Loop back one instruction for all 8 bits.</div></div>
									<div class="assembly-row-combined both"><div>32C8</div><div><a href="#3254" class="memory-link">JR 3254H</a></div><div>JUMP to 3254H to restore all the registers and RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="32CA">32CA - Read the start bit, read 8 bits, check for error, and flash the star<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>32CA</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ START BIT.</div></div>
									<div class="assembly-row-combined both"><div>32CD</div><div>LD B,08H</div><div>Load B with an 8 to set up a loop for 8 bits.</div></div>
									<div class="assembly-row-combined both"><div>32CF</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ BIT.</div></div>
									<div class="assembly-row-combined both"><div>32D2</div><div><a href="#337C" class="memory-link">CALL 337CH</a></div><div>GOSUB to 337CH to CHECK FOR DATA ERROR.</div></div>
									<div class="assembly-row-combined both"><div>32D5</div><div><a href="#32CF" class="memory-link">DJNZ 32CDH</a></div><div>Loop back 2 instructions for all 8 bits.</div></div>
									<div class="assembly-row-combined both"><div>32D7</div><div><a href="#320A" class="memory-link">JP 320AH</a></div><div>JUMP to 320AH to flash the <span class="code">*</span>.</div></div>
								</div>
							</div>

							<br><h2 id="32DA">32DA - FAST tape header read.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>32DA</div><div>PUSH HL</div><div>Save HL to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>32DB</div><div>LD HL,32CAH</div><div>Load HL with 32CAH.<br><b>NOTE:</b> 32CAH reads an verifies a byte.</div></div>
									<div class="assembly-row-combined both"><div>32DE</div><div>LD (420EH),HL</div><div>Load the TAPE READ VECTOR (memory location of 420EH) with the 32CAH.</div></div>
									<div class="assembly-row-combined both"><div>32E1</div><div>LD A,01H</div><div>Load A with a 1 to set the interrupt.</div></div>
									<div class="assembly-row-combined both"><div>32E3</div><div>OUT (0E0H),A</div><div>OUTPUT A to Port E0H.<br><b>NOTE:</b> Port E0H is the maskable interrupt latch, which directs jumps.
<table class="bit-table-breakdown"><tbody><tr class="header"><td colspan="8" style="text-align: center;">Bit Number</td><td class="spacer-first"></td><td style="text-align: center;">Jump Address</td></tr><tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td class="spacer"></td><td>3365H</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td class="spacer"></td><td>3369H</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td class="spacer"></td><td>4046H</td></tr><tr><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td class="spacer"></td><td>403DH</td></tr><tr><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4206H</td></tr><tr><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4209H</td></tr><tr><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4040H</td></tr><tr><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>4043H</td></tr></tbody></table></div></div>
									<div class="assembly-row-combined both"><div>32E5</div><div>LD B,80H</div><div>Set up a loop of 80H (128) to try to read 128 bits.</div></div>
									<div class="assembly-row-combined both"><div>32E7</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ a BIT.</div></div>
									<div class="assembly-row-combined both"><div>32EA</div><div>LD A,C</div><div>Load A with C (which is the pulse width).</div></div>
									<div class="assembly-row-combined both"><div>32EB</div><div>CP 0FH</div><div>Compare A to 0FH to see if the pulse width was too short.</div></div>
									<div class="assembly-row-combined both"><div>32ED</div><div><a href="#32E5" class="memory-link">JR C,32E5H</a></div><div>Loop back to 32E5H if the pulse width was too short.</div></div>
									<div class="assembly-row-combined both"><div>32EF</div><div>CP 3EH</div><div>Compare A to 3EH to see if the pulse width was too long.</div></div>
									<div class="assembly-row-combined both"><div>32F1</div><div><a href="#32E5" class="memory-link">JR NC,32E5H</a></div><div>Loop back to 32E5H if the pulse width was too long.</div></div>
									<div class="assembly-row-combined both"><div>32F3</div><div><a href="#32E7" class="memory-link">DJNZ 32E7H</a></div><div>Loop back to 32E7H 128 times.</div></div>
									<div class="assembly-row-combined both"><div>32F5</div><div>LD HL,0000H</div><div>Load HL with 0000.</div></div>
									<div class="assembly-row-combined both"><div>32F8</div><div>LD B,40H</div><div>Set up a loop of 40H (Decimal: 64) to try to read 64 bits.</div></div>
									<div class="assembly-row-combined both"><div>32FA</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ BIT.</div></div>
									<div class="assembly-row-combined both"><div>32FD</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ BIT.</div></div>
									<div class="assembly-row-combined both"><div>3300</div><div>LD D,C</div><div>Load D with C (which holds the delay count).</div></div>
									<div class="assembly-row-combined both"><div>3301</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ BIT.</div></div>
									<div class="assembly-row-combined both"><div>3304</div><div>LD A,D</div><div>Load A with D to set up to find the difference in the delays.</div></div>
									<div class="assembly-row-combined both"><div>3305</div><div>SUB C</div><div>Subtract C (the delay count) from A (which holds D).</div></div>
									<div class="assembly-row-combined both"><div>3306</div><div><a href="#330A" class="memory-link">JR NC,330AH</a></div><div>JUMP to 330AH (to GET ABSOLUTE) if the carry flag is NOT set.</div></div>
									<div class="assembly-row-combined both"><div>3308</div><div>NEG</div><div>A = 0 - A.</div></div>
									<div class="assembly-row-combined both"><div>330A</div><div>CP 0DH</div><div>Compare
 the NEGated A against 0DH.  This has the effect of checking A-0DH, so 
if A &lt; 0DH then the CARRY will be set and if A &gt;= 0DH then the NO 
CARRY will be set.</div></div>
									<div class="assembly-row-combined both"><div>330C</div><div><a href="#3313" class="memory-link">JR C,3313H</a></div><div>If the CARRY FLAG is set, JUMP to 3313H which will bump L and continue the 64 bit loop.</div></div>
									<div class="assembly-row-combined both"><div>330E</div><div>INC H</div><div>Bump HL since we have one more zero bit.</div></div>
									<div class="assembly-row-combined both"><div>330F</div><div><a href="#32FA" class="memory-link">DJNZ 32FAH</a></div><div>Loop back to 32FAH until 64 bits read.</div></div>
									<div class="assembly-row-combined both"><div>3311</div><div><a href="#3316" class="memory-link">JR 3316H</a></div><div>JUMP out of the loop to 3316H.</div></div>
									<div class="assembly-row-combined both"><div>3313</div><div>INC L</div><div>Bump L since we have one more bit.</div></div>
									<div class="assembly-row-combined both"><div>3314</div><div><a href="#32FA" class="memory-link">DJNZ 32FAH</a></div><div>Loop back to 32FAH until 64 bits read.</div></div>
									<div class="assembly-row-combined both"><div>3316</div><div>LD A,40H</div><div>Load A with 40H (64).</div></div>
									<div class="assembly-row-combined both"><div>3318</div><div>CP H</div><div>Compare A with H to check for bits.</div></div>
									<div class="assembly-row-combined both"><div>3319</div><div><a href="#3325" class="memory-link">JR Z,3325H</a></div><div>If they match, then JUMP forward to 3325H.</div></div>
									<div class="assembly-row-combined both"><div>331B</div><div>CP L</div><div>Compare with A to check for one bits.</div></div>
									<div class="assembly-row-combined both"><div>331C</div><div><a href="#32F5" class="memory-link">JR NZ,32F5H</a></div><div>If not, JUMP forward to 32F5H.</div></div>
									<div class="assembly-row-combined both"><div>331E</div><div>LD A,02H</div><div>Load A with 2 to set the interrupt vector.</div></div>
									<div class="assembly-row-combined both"><div>3320</div><div>OUT (0E0H),A</div><div>Output the 2 to Port E0H.<br><b>NOTE:</b> Port E0H is the maskable interrupt latch, which directs jumps.<table class="bit-table-breakdown"><tbody><tr class="header"><td colspan="8" style="text-align: center;">Bit Number</td><td class="spacer-first"></td><td style="text-align: center;">Jump Address</td></tr><tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td class="spacer"></td><td>3365H</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td class="spacer"></td><td>3369H</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td class="spacer"></td><td>4046H</td></tr><tr><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td class="spacer"></td><td>403DH</td></tr><tr><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4206H</td></tr><tr><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4209H</td></tr><tr><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4040H</td></tr><tr><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>4043H</td></tr></tbody></table></div></div>
									<div class="assembly-row-combined both"><div>3322</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ BIT.</div></div>
									<div class="assembly-row-combined both"><div>3325</div><div>LD D,00H</div><div>Zero D.</div></div>
									<div class="assembly-row-combined both"><div>3327</div><div><a href="#3350" class="memory-link">CALL 3350H</a></div><div>GOSUB to 3350H to READ BIT.</div></div>
									<div class="assembly-row-combined both"><div>332A</div><div><a href="#337C" class="memory-link">CALL 337CH</a></div><div>GOSUB to 337CH to check for a data error.</div></div>
									<div class="assembly-row-combined both"><div>332D</div><div>LD A,D</div><div>Load A with D (the read byte).</div></div>
									<div class="assembly-row-combined both"><div>332E</div><div>CP 7FH</div><div>Compare A against 7F to check for a MARKER BYTE.</div></div>
									<div class="assembly-row-combined both"><div>3330</div><div><a href="#3327" class="memory-link">JR NZ,3327H</a></div><div>If no marker byte, then JUMP to 3327H.</div></div>
									<div class="assembly-row-combined both"><div>3332</div><div><a href="#3290" class="memory-link">JP 3290H</a></div><div>If it was a marker byte, then JP to 3290H to flash the <span class="code">*</span> and continue.</div></div>
									<div class="assembly-row-combined both"><div>3335</div><div>RLC C</div><div>We need to shift the bit into CARRY so we rotate C left one bit, copying BIT 7 to the CARRY FLAG and the CARRY FLAG to BIT 0.</div></div>
									<div class="assembly-row-combined both"><div>3337</div><div><a href="#333E" class="memory-link">JR NC,333EH</a></div><div>If the bit was 0, JUMP forward 2 instructions to 333EH.</div></div>
									<div class="assembly-row-combined both"><div>3339</div><div>LD DE,1217H</div><div>Load DE with 1217H to set up a delay for 1 BIT.</div></div>
									<div class="assembly-row-combined both"><div>333C</div><div><a href="#3341" class="memory-link">JR 3341H</a></div><div>Skip the next instruction.</div></div>
									<div class="assembly-row-combined both" id="333E"><div>333E</div><div>LD DE,2B2FH</div><div>Load DE with 2B2F to set the delay for a 0 BIT.</div></div>
									<div class="assembly-row-combined both" id="3341"><div>3341</div><div>DEC D</div><div>Decrement D as DELAY #1.</div></div>
									<div class="assembly-row-combined both"><div>3342</div><div><a href="#3341" class="memory-link">JR NZ,3341H</a></div><div>JUMP back to the prior instruction until D is 0.</div></div>
									<div class="assembly-row-combined both"><div>3344</div><div>LD A,02H</div><div>Load A with a 2 to set up for a write of 0 VOLTS to TAPE.</div></div>
									<div class="assembly-row-combined both"><div>3346</div><div>OUT (0FFH),A</div><div>Load Port FFH with A.<br><b>NOTE:</b> Port FFH is the cassette port.  When outputting to FFH, Bits Zero and 1 set to: 00 is .85V, 01 is .46V, and 10 is 0.0V.</div></div>
									<div class="assembly-row-combined both"><div>3348</div><div>DEC E</div><div>Decrement E as DELAY #2.</div></div>
									<div class="assembly-row-combined both"><div>3349</div><div><a href="#3348" class="memory-link">JR NZ,3348H</a></div><div>JUMP back to the prior instruction until E is 0.</div></div>
									<div class="assembly-row-combined both"><div>334B</div><div>LD A,01H</div><div>Load A with 01H to prepare to send 0.85 VOLTS to TAPE.</div></div>
									<div class="assembly-row-combined both"><div>334D</div><div>OUT (0FFH),A</div><div>Load Port FFH with A.<br><b>NOTE:</b> Port FFH is the cassette port.  When outputting to FFH, Bits Zero and 1 set to: 00 is .85V, 01 is .46V, and 10 is 0.0V.</div></div>
									<div class="assembly-row-combined both"><div>334F</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3350">3350H - READ a BIT<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3350</div><div>EI</div><div>Enable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>3351</div><div>LD C,00H</div><div>Load C with 0.</div></div>
									<div class="assembly-row-combined both"><div>3353</div><div>INC C</div><div>Bump C.</div></div>
									<div class="assembly-row-combined both"><div>3354</div><div>LD A,(3840H)</div><div>Load A with the contents of 3840H so as to check for a <kbd>BREAK</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>3357</div><div>AND 04H</div><div>Mask A with 4 (0000 0100).</div></div>
									<div class="assembly-row-combined both"><div>3359</div><div><a href="#3353" class="memory-link">JR Z,3353H</a></div><div>If the Masked A is 0, then LOOP back to 3353H.</div></div>
									<div class="assembly-row-combined both"><div>335B</div><div>DI</div><div>Disable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>335C</div><div>LD HL,4B42H</div><div>Load HL with "BK" to set up to display "BK" over the "**".</div></div>
									<div class="assembly-row-combined both"><div>335F</div><div>LD (3C3EH),HL</div><div>Put the "BK" in HL onto the video screen at 3C3EH.</div></div>
									<div class="assembly-row-combined both"><div>3362</div><div><a href="#4203" class="memory-link">JP 4203H</a></div><div>JUMP to 4203H, which then jumps to 022EH, which is the BREAK VECTOR for cassette and RS-232.</div></div>
								</div>
							</div>

							<br><h2 id="3365">3365H - This is a Port E0H Masked Jump.  If the
 MASKABLE INTERRUPT is xxxxxxx1, it jumps here.  This is a Cassette 
Routine with E set to HIGH<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3365</div><div>LD E,01H</div><div>Load E with 01H (Binary: 0000 0001) to make the bit go high.</div></div>
									<div class="assembly-row-combined both"><div>3367</div><div><a href="#336B" class="memory-link">JR 336BH</a></div><div>Skip the next instruction.</div></div>
									<div class="assembly-row-combined both"><div>3369</div><div>LD E,00H</div><div>Load E with 0 to make the bit go low.</div></div>
									<div class="assembly-row-combined both"><div>336B</div><div>LD A,06H</div><div>Load A with 6.</div></div>
									<div class="assembly-row-combined both"><div>336D</div><div>ADD A,C</div><div>Add A (6) to C, so COUNT = COUNT + 6.</div></div>
									<div class="assembly-row-combined both"><div>336E</div><div>LD C,A</div><div>Put the count held in A back into C.</div></div>
									<div class="assembly-row-combined both"><div>336F</div><div>IN A,(FFH)</div><div>Poll FFH (to get the level) into A.<br><b>NOTE:</b> FFH is the Cassette Port.</div></div>
									<div class="assembly-row-combined both"><div>3371</div><div>AND 01H</div><div>Mask A with 1 (0000 0001) to keep only Bit 0.</div></div>
									<div class="assembly-row-combined both"><div>3373</div><div>CP E</div><div>Compare A with E (which was the set level).</div></div>
									<div class="assembly-row-combined both"><div>3374</div><div><a href="#3379" class="memory-link">JR NZ,3379H</a></div><div>If A does NOT match E then skip the next 3 instructions.</div></div>
									<div class="assembly-row-combined both"><div>3376</div><div>POP AF</div><div>Restore AF from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3377</div><div>POP AF</div><div>Restore AF (the REMOTE CALLER'S ADDRESS) from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3378</div><div>RET</div><div>RETURN to the caller's caller.</div></div>
									<div class="assembly-row-combined both" id="3379"><div>3379</div><div>POP AF</div><div>Restore AF from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>337A</div><div>EI</div><div>Enable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>337B</div><div>RET</div><div>RETURN back top the loop.</div></div>
								</div>
							</div>

							<br><h2 id="337C">337CH - Check for a Data Error.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>337C</div><div>LD A,C</div><div>Load A with C (the count).</div></div>
									<div class="assembly-row-combined both"><div>337D</div><div>CP 22H</div><div>Compare A with 22H.  Results:<ul><li>If A=22H it sets the ZERO FLAG</li><li>If A&lt;22H then the CARRY FLAG will be set</li><li>If A&gt;=22H then the NO CARRY FLAG will be set</li></ul></div></div>
									<div class="assembly-row-combined both"><div>337F</div><div>RL D</div><div>We
 need to put the data bit into D so we rotate D left one bit, with the 
contents of BIT 7 being put into the CARRY FLAG and the CARRY FLAG are 
put into BIT 0.  This puts the read data into BIT 0 of D.</div></div>
									<div class="assembly-row-combined both"><div>3381</div><div>CP 0FH</div><div>Make
 sure it was not too quick by checking A against 0FH.  This has the 
effect of checking A-0FH, so if A &lt; 0FH then the CARRY will be set 
and if A &gt;= 0FH then the NO CARRY will be set.</div></div>
									<div class="assembly-row-combined both"><div>3383</div><div><a href="#3388" class="memory-link">JR C,3388H</a></div><div>If A &lt; 0FH then it was too quick and we have a data error so JUMP forward a few instructions 3388H.</div></div>
									<div class="assembly-row-combined both"><div>3385</div><div>CP 3EH</div><div>Compare A against 3EH to make sure it was not too slow.</div></div>
									<div class="assembly-row-combined both"><div>3387</div><div>RET C</div><div>If it wasn't too slow, RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3388</div><div>LD A,44H</div><div>It was too slow, so load A with a <span class="code">D</span>.</div></div>
									<div class="assembly-row-combined both"><div>338A</div><div>LD (3C3EH),A</div><div>Put the "D" on the screen at video location 3C3EH.</div></div>
									<div class="assembly-row-combined both"><div>338D</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="338E">338EH - Jump Point for Keyboard Input.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<p class="debug-note">Differences between the M3 and M4 ROMS:  
In the Model III this portion of memory includes most of the keyboard 
scan routine (338EH-3454H), the bootstrap routine (3455H-3517H), a short
 time-delay routine used by the bootstrap routine (3518H-351BH), the 
Non-Maskable Interrupt handler routine (351CH-3527H), and an unused FFH 
byte (3528H). In the Model 4 this area contains part of the keyboard 
scan routine (338EH-3400H), the bootstrap routine (3401H-34CDH), the 
Non-Maskable Interrupt handler routine (34CEH-34O9H), more of the 
keyboard scan routine (37DAH-34FCH), a new screen print routine used 
when the control and asterisk keys are pressed (34FDH-351EH), and ten 
NOPs (zero bytes at 351FH through 3528H).	</p>
									<div class="assembly-row-combined both"><div>338E</div><div><a href="#3060" class="memory-link">CALL 3060H</a></div><div>GOSUB to 3060H (which loads the computer version number into A) to check to see if lower case is installed.<br><b>NOTE:</b>
 The Model III v1 and v2 code diverges and remerges too often between 
here and 3529H, often differing just by memory location, so the tracking
 of those versions is stopping here.</div></div>
									<div class="assembly-row-combined both"><div>3391</div><div><a href="#33A3" class="memory-link">JR NZ,33A3H</a></div><div>If 3060H is NOT ZERO then JUMP to 33A3H.  3060H is hard coded to 1 for a Model III and 0 for a Model 4.</div></div>
									<div class="assembly-row-combined both"><div>3393</div><div>LD BC,3880H</div><div>Load BC with 3880H (which are the SHIFT KEYS).</div></div>
									<div class="assembly-row-combined both"><div>3396</div><div>LD HL,4018H</div><div>Load HL with 4018H (which is the FLAG BYTE).</div></div>
									<div class="assembly-row-combined both"><div>3399</div><div>LD A,(BC)</div><div>Load A with the memory contents of 3880H (which are the SHIFT KEYS).</div></div>
									<div class="assembly-row-combined both"><div>339A</div><div>AND 02H</div><div>Mask Bit 1 (the <kbd>RIGHT SHIFT</kbd>).</div></div>
									<div class="assembly-row-combined both"><div>339C</div><div>LD E,A</div><div>Put the masked A into E.</div></div>
									<div class="assembly-row-combined both"><div>339D</div><div>XOR (HL)</div><div>Roggle against the old image.</div></div>
									<div class="assembly-row-combined both"><div>339E</div><div>LD (HL),E</div><div>Save the new image into (HL).</div></div>
									<div class="assembly-row-combined both"><div>339F</div><div>AND E</div><div>Mask Bit 1 against A.</div></div>
									<div class="assembly-row-combined both"><div>33A0</div><div><a href="#30BD" class="memory-link">JP NZ,30BDH</a></div><div>If NOT ZERO then <kbd>RIGHT SHIFT</kbd> PRESSED and we JUMP to 30BDH.</div></div>
									<div class="assembly-row-combined both" id="33A3"><div>33A3</div><div>LD A,FFH</div><div>Load A with FF to set up for a FLAG = 0FFH = NO CONTROL.</div></div>
									<div class="assembly-row-combined both"><div>33A5</div><div>LD HL,3840H</div><div>Load HL with 3840H to start a check for a <kbd>DOWN ARROW</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>33A8</div><div>BIT 4,(HL)</div><div>Test BIT 4 of (HL) to check for a <kbd>DOWN ARROW</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>33AA</div><div><a href="#33B4" class="memory-link">JR Z,33B4H</a></div><div>JUMP to 33B4H if the a <kbd>DOWN ARROW</kbd> was NOT pressed.</div></div>
									<div class="assembly-row-combined both"><div>33AC</div><div>SLA L</div><div>Next we need to check for a a <kbd>LEFT SHIFT</kbd> so shift L left.</div></div>
									<div class="assembly-row-combined both"><div>33AE</div><div>BIT 00H,(HL)</div><div>Test BIT 0 of (HL) to check for a <kbd>LEFT SHIFT</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>33B0</div><div><a href="#33B4" class="memory-link">JR Z,33B4H</a></div><div>JUMP to 33B4H if the a <kbd>LEFT SHIFT</kbd> was NOT pressed.</div></div>
									<div class="assembly-row-combined both"><div>33B2</div><div>LD A,1FH</div><div>Load A with 1F to set up for FLAG = CONTROL KEY.</div></div>
									<div class="assembly-row-combined both"><div>33B4</div><div>LD (4224H),A</div><div>Save the CONTROL FLAG into (4224H).<br><b>NOTE:</b> 4224H Holds the CONTROL KEY flag.</div></div>
									<div class="assembly-row-combined both"><div>33B7</div><div>LD BC,3801H</div><div>Load BC with 3801H (KEYBOARD ROW 0).</div></div>
									<div class="assembly-row-combined both"><div>33BA</div><div>LD HL,4036H</div><div>Load HL with 4036H (BUFFER ROW 0).</div></div>
									<div class="assembly-row-combined both"><div>33BD</div><div>LD D,00H</div><div>Load D with 0 (so D = ROW 0).</div></div>
									<div class="assembly-row-combined both"><div>33BF</div><div>LD A,(BC)</div><div>Load A with the contents held in (BC) to check the keyboard row.</div></div>
									<div class="assembly-row-combined both"><div>33C0</div><div>LD E,A</div><div>Load E with the contents held in (BC) to check the keyboard row.</div></div>
									<div class="assembly-row-combined both"><div>33C1</div><div>XOR (HL)</div><div>XOR (HL) to set changed bits.</div></div>
									<div class="assembly-row-combined both"><div>33C2</div><div>LD (HL),E</div><div>Save the scan back into (HL).</div></div>
									<div class="assembly-row-combined both"><div>33C3</div><div>AND E</div><div>Mask A with E (to mask the released keys).</div></div>
									<div class="assembly-row-combined both"><div>33C4</div><div><a href="#33F8" class="memory-link">JR NZ,33F8H</a></div><div>JUMP to 33F8H if any keys are pressed.</div></div>
									<div class="assembly-row-combined both"><div>33C6</div><div><a href="#3120" class="memory-link">CALL 3120H</a></div><div>GOSUB to 3120H to go to the next row.</div></div>
									<div class="assembly-row-combined both"><div>33C9</div><div><a href="#33BF" class="memory-link">JP P,33BFH</a></div><div>Loop back to 33BFH if there are any rows left.</div></div>
									<div class="assembly-row-combined both"><div>33CC</div><div><a href="#313D" class="memory-link">CALL 313DH</a></div><div>GOSUB to 313DH to restore scanning variables.</div></div>
									<div class="assembly-row-combined both"><div>33CF</div><div>AND (HL)</div><div>MASK A against (HL) to see if the previous keys are still pressed.</div></div>
									<div class="assembly-row-combined both"><div>33D0</div><div><a href="#33DA" class="memory-link">JR NZ,33DAH</a></div><div>JUMP to 33DAH if the previous keys are still pressed.</div></div>
									<div class="assembly-row-combined both"><div>33D2</div><div>SBC HL,HL</div><div>Zero HL by subtracting HL from HL.</div></div>
									<div class="assembly-row-combined both"><div>33D4</div><div>LD (4201H),HL</div><div>Load the memory location at 4201H with HL to clear the repeat counter.<br><b>NOTE:</b> 4201H is the REPEAT DELAY COUNTER.</div></div>
									<div class="assembly-row-combined both"><div>33D7</div><div><a href="#307D" class="memory-link">JP 307DH</a></div><div>JUMP to 307DH to finish and return a null.</div></div>
								</div>
							</div>

							<br><h2 id="33DA">33DA - Keyboard Repeat - Jumps Here if the same keys are still pressed.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>33DA</div><div>PUSH HL</div><div>Save HL to STACK.</div></div>
									<div class="assembly-row-combined both"><div>33DB</div><div>LD HL,(4201H)</div><div>Load HL with the repeat delay counter.<br><b>NOTE:</b> 4201H is the REPEAT DELAY COUNTER.</div></div>
									<div class="assembly-row-combined both"><div>33DE</div><div>INC HL</div><div>Bump HL.</div></div>
									<div class="assembly-row-combined both"><div>33DF</div><div>LD (4201H),HL</div><div>Load the memory location at 4201H with HL to clear the repeat counter.<br><b>NOTE:</b> 4201H is the REPEAT DELAY COUNTER.</div></div>
									<div class="assembly-row-combined both"><div>33E2</div><div>LD DE,(41FFH)</div><div>Load DE with the byte stored at 41FFH.<br><b>NOTE:</b> 41FFH is the REPEAT DELAY COUNT.</div></div>
									<div class="assembly-row-combined both"><div>33E6</div><div>SBC HL,DE</div><div>Subtract with CARRY DE from HL.</div></div>
									<div class="assembly-row-combined both"><div>33E8</div><div>POP DE</div><div>Restore old HL (which is what is in the stack) into DE.</div></div>
									<div class="assembly-row-combined both"><div>33E9</div><div><a href="#30A1" class="memory-link">JP C,30A1H</a></div><div>If we haven't scanned enough then JUMP to 30A1H to clear flags and RETURN.</div></div>
									<div class="assembly-row-combined both"><div>33EC</div><div>XOR A</div><div>Clear A and all flags.</div></div>
									<div class="assembly-row-combined both"><div>33ED</div><div>LD (DE),A</div><div>Put a 0 into the memory location pointed to (DE) to let the key be re-read.</div></div>
									<div class="assembly-row-combined both"><div>33EE</div><div>LD (4201H),HL</div><div>Load the memory location at 4201H with HL to clear the repeat counter.<br><b>NOTE:</b> 4201H is the REPEAT DELAY COUNTER.</div></div>
									<div class="assembly-row-combined both"><div>33F1</div><div>LD L,96H</div><div>Load L with 96H to set a fast repeat count.</div></div>
									<div class="assembly-row-combined both"><div>33F3</div><div>LD (41FFH),HL</div><div>Save HL into the memory location at 41FFH.<br><b>NOTE:</b> 41FFH is the REPEAT DELAY COUNT.</div></div>
									<div class="assembly-row-combined both"><div>33F6</div><div><a href="#33A3" class="memory-link">JR 33A3H</a></div><div>JUMP to 33A3H to re-scan the keybaord.</div></div>
									<div class="assembly-row-combined both"><div>33F8</div><div>LD E,A</div><div>Load E with A.</div></div>
									<div class="assembly-row-combined both"><div>33F9</div><div>PUSH BC</div><div>Save BC to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>33FA</div><div>LD BC,05C4H</div><div>Load BC with 05C4H to set up a 1/50 second delay for de-bounce.</div></div>
									<div class="assembly-row-combined both"><div>33FD</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0060" class="memory-link">CALL 0060H</a></div><div>GOSUB
 to 0060H which jumps to the delay routine at 01FBH (which uses BC as a 
loop counter). It RETs when done so it doesn't come back here.</div></div>
									<div class="assembly-row-combined both"><div>3400</div><div>POP BC</div><div>Restore BC from the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3401</div><div>LD A,(BC)</div><div>Load A with the memory contents pointed to by BC to re-check the keyboard.</div></div>
									<div class="assembly-row-combined both"><div>3402</div><div>AND E</div><div>Compare A against E to check the pattern.</div></div>
									<div class="assembly-row-combined both"><div>3403</div><div>RET Z</div><div>If not the same pattern then RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3404</div><div>LD (41FEH),A</div><div>If it is the same pattern then save A into (41FEH).<br><b>NOTE:</b> 41FE is the SAVED IMAGE AT POSITION.</div></div>
									<div class="assembly-row-combined both"><div>3407</div><div>LD A,L</div><div>Load A with L (the scan position).</div></div>
									<div class="assembly-row-combined both"><div>3408</div><div>LD (41FDH),A</div><div>Save A into (41FDH).<br><b>NOTE:</b> 41FDH is the SAVED POSITION IN SCAN.</div></div>
									<div class="assembly-row-combined both"><div>340B</div><div>LD A,D</div><div>Load A with D (8 * ROW #).</div></div>
									<div class="assembly-row-combined both"><div>340C</div><div>RLA</div><div>Rotate
 A left one bit, with the contents of BIT 7 being put into the CARRY 
FLAG and the CARRY FLAG are put into BIT 0.  This puts the read data 
into the CARRY FLAG.</div></div>
									<div class="assembly-row-combined both"><div>340D</div><div>RLA</div><div>Rotate
 A left one bit, with the contents of BIT 7 being put into the CARRY 
FLAG and the CARRY FLAG are put into BIT 0.  This puts the read data 
into the CARRY FLAG.</div></div>
									<div class="assembly-row-combined both"><div>340E</div><div>RLA</div><div>Rotate
 A left one bit, with the contents of BIT 7 being put into the CARRY 
FLAG and the CARRY FLAG are put into BIT 0.  This puts the read data 
into the CARRY FLAG.</div></div>
									<div class="assembly-row-combined both"><div>340F</div><div>LD D,A</div><div>D = A</div></div>
									<div class="assembly-row-combined both"><div>3410</div><div>LD A,E</div><div>A = E</div></div>
									<div class="assembly-row-combined both"><div>3411</div><div>RRCA</div><div>Rotate A right one bit, with the contents of BIT 0 being put into BOTH the CARRY FLAG and BIT 7.  D = 8* ROW # + KEY #.</div></div>
									<div class="assembly-row-combined both"><div>3412</div><div><a href="#3417" class="memory-link">JR C,3417H</a></div><div>If the contents of BIT 0 of A was SET, skip forward a few instructions to 3417H.</div></div>
									<div class="assembly-row-combined both"><div>3414</div><div>INC D</div><div>D = D + 1</div></div>
									<div class="assembly-row-combined both"><div>3415</div><div><a href="#3411" class="memory-link">JR 3411H</a></div><div>Loop back to 3411H (to keep rotating A right one bit and bumping D).</div></div>
									<div class="assembly-row-combined both"><div>3417</div><div><a href="#3060" class="memory-link">CALL 3060H</a></div><div>To check for DUAL SHIFTS GOSUB to 3060H (which loads the computer version number into A and sets the flags).</div></div>
									<div class="assembly-row-combined both"><div>341A</div><div>LD A,(3880H)</div><div>Put the contents of memory location 3880H into A to GET SHIFT(S).</div></div>
									<div class="assembly-row-combined both"><div>341D</div><div><a href="#3421" class="memory-link">JR NZ,3421H</a></div><div>If there are DUAL SHIFTS, JUMP to 3421H.</div></div>
									<div class="assembly-row-combined both"><div>341F</div><div>AND 01H</div><div>MASK with 01H (Binary: 0000 0001) to keep only Bit 0 to check for shifts.</div></div>
									<div class="assembly-row-combined both"><div>3421</div><div>AND 03H</div><div>Further MASK with 03H (Binary: 0000 0011) to keep only Bits 0 and 1 to check for shifts.</div></div>
									<div class="assembly-row-combined both"><div>3423</div><div><a href="#3427" class="memory-link">JR Z,3427H</a></div><div>If the masked A is 0, then we have no shifts, and skip the next instruction (to 3427H).</div></div>
									<div class="assembly-row-combined both"><div>3425</div><div>SET 6,D</div><div>Set BIT 6 of D to offset D for shifts.</div></div>
									<div class="assembly-row-combined both"><div>3427</div><div>LD A,(4019H)</div><div>Load A with the contents of memory location 4019H to check for CAPS LOCK.<br><b>NOTE:</b> 4019H is the CAPS LOCK TOGGLE.</div></div>
									<div class="assembly-row-combined both"><div>342A</div><div>OR A</div><div>Set the flags.</div></div>
									<div class="assembly-row-combined both"><div>342B</div><div><a href="#342F" class="memory-link">JR Z,342FH</a></div><div>If the ZERO flag is set then there is NO CAPS LOCK so skip the next intruction.</div></div>
									<div class="assembly-row-combined both"><div>342D</div><div>SET 7,D</div><div>Set BIT 7 of D to offset D for CAPS LOCK.<br><b>NOTE:</b> BIT 7 is the difference between UPPER CASE and LOWER CASE versions of the same letter.</div></div>
									<div class="assembly-row-combined both" id="342F"><div>342F</div><div>LD HL,3045H</div><div>Load HL with 3045H (the KEYBOARD TABLES).</div></div>
									<div class="assembly-row-combined both"><div>3432</div><div>LD E,D</div><div>We need DE to be the OFFSET, so load E with D and ...</div></div>
									<div class="assembly-row-combined both"><div>3433</div><div>LD D,00H</div><div>... load D with 00.</div></div>
									<div class="assembly-row-combined both"><div>3435</div><div>ADD HL,DE</div><div>Add DE (the offset over the keyboard table) to HL (the keyboard table).</div></div>
									<div class="assembly-row-combined both"><div>3436</div><div>LD A,(HL)</div><div>Get the character pointed to by (HL) and put it into A.</div></div>
									<div class="assembly-row-combined both"><div>3437</div><div>CP 1AH</div><div>Check A against 1AH to see if we have a <kbd>SHIFT</kbd>+<kbd>DOWN ARROW</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>3439</div><div><a href="#30A1" class="memory-link">JP Z,30A1H</a></div><div>If we have a <kbd>SHIFT</kbd>+<kbd>DOWN ARROW</kbd> then JUMP to 30A1H.</div></div>
									<div class="assembly-row-combined both"><div>343C</div><div>LD B,A</div><div>We do NOT have a <kbd>SHIFT</kbd>+<kbd>DOWN ARROW</kbd> so save the character from A into B.</div></div>
									<div class="assembly-row-combined both"><div>343D</div><div><a href="#3060" class="memory-link">CALL 3060H</a></div><div>GOSUB to 3060H (which loads the computer version number into A and sets flags).</div></div>
									<div class="assembly-row-combined both"><div>3440</div><div>LD A,B</div><div>A = B</div></div>
									<div class="assembly-row-combined both"><div>3441</div><div><a href="#3447" class="memory-link">JR Z,3447H</a></div><div>If the computer version number is 0 (a Model III) then JUMP to 3447H.</div></div>
									<div class="assembly-row-combined both"><div>3443</div><div>OR A</div><div>If we are here then the computer version number is 1 (a Model 4) so set the flags and ...</div></div>
									<div class="assembly-row-combined both"><div>3444</div><div><a href="#30BD" class="memory-link">JP Z,30BDH</a></div><div>JUMP to 30BDH to TOGGLE CAPS LOCK.</div></div>
								</div>
							</div>

							<br><h2 id="3447">3447 - If this is a Model III then we do not 
have a CAPS LOCK so check A is a "*" then check to see if the CONTROL 
KEY FLAG is 1F.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3447</div><div>LD HL,4224H</div><div>Load HL with the CONTROL KEY flag.<br><b>NOTE:</b> 4224H is the CONTROL KEY flag, part of the I/O Router DCB.</div></div>
									<div class="assembly-row-combined both"><div>344A</div><div>CP 2AH</div><div>Check A against a <span class="code">*</span>.</div></div>
									<div class="assembly-row-combined both"><div>344C</div><div><a href="#3452" class="memory-link">JR NZ,3452H</a></div><div>If A is not a <span class="code">*</span> then exit the routine and jump to 3452H to jump to 30FDH to continue with a <kbd>BREAK</kbd> key check.</div></div>
									<div class="assembly-row-combined both"><div>344E</div><div>LD A,1FH</div><div>If A is a <span class="code">*</span> then Put a 1FH (Decimal 26) into A.</div></div>
									<div class="assembly-row-combined both"><div>3450</div><div>CP (HL)</div><div>Check the CONTROL KEY FLAG against 1FH and set flags.</div></div>
									<div class="assembly-row-combined both"><div>3451</div><div>LD A,B</div><div>Put the character (held in B) back into A.</div></div>
									<div class="assembly-row-combined both"><div>3452</div><div><a href="#30FD" class="memory-link">JP 30FDH</a></div><div>Jump back to 30FDH to continue with a <kbd>BREAK</kbd> key check.</div></div>
								</div>
							</div>

							<br><h2 id="3455">3455 - This is the BOOTSTRAP.  Clears ports, checks for a&nbsp;<kbd>BREAK</kbd>&nbsp;key and a Floppy Controller.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3455</div><div>IM 1</div><div>Set the INTERRUPT MODE to 1.</div></div>
									<div class="assembly-row-combined both"><div>3457</div><div>LD SP,407DH</div><div>Load the STACK POINTER with 407DH.</div></div>
									<div class="assembly-row-combined both"><div>345A</div><div>OUT (0E4H),A</div><div>Output A to Port E4H.<br><b>NOTE:</b> Port E4H is the non-maskable interrupt latch.  This is to clear the non-maskable interrupt status.</div></div>
									<div class="assembly-row-combined both"><div>345C</div><div>OR 20H</div><div>OR 20H (0010 0000) against A to turn on Bit 5.</div></div>
									<div class="assembly-row-combined both"><div>345E</div><div>OUT (0ECH),A</div><div>Output the modified A to Port ECH.<br><b>NOTE:</b>
 Port ECH is the control port.  In this case, this is turning on bit 5 
which ENABLEs the Video Waits.  This bit is mirrored into a chip called a
 latch which has a wire running to both the Z-80 and the video circuity 
that mediates access to video RAM.
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>

									<div class="assembly-row-combined both"><div>3460</div><div>LD A,81H</div><div>Load A with 81H (Decimal 129, Binary 10000001).</div></div>
									<div class="assembly-row-combined both"><div>3462</div><div>OUT (0F4H),A</div><div>Output A to Port F4H to select drive 0 and double-density.<br><b>NOTE:</b>
 Port F4H is the Disk Drive and Disk Density Select.  Bits 0-3 are the 
drive select of 0-3 and Bit 7 is 0 for single density and 1 for double 
density.</div></div>
									<div class="assembly-row-combined both"><div>3464</div><div>LD A,D0H</div><div>Load A with D0H (Decimal: 208, Binary: 1101 0000).</div></div>
									<div class="assembly-row-combined both"><div>3466</div><div>OUT (0F0H),A</div><div>Output "D0H" to Port F0H.<br><b>NOTE:</b> Port F0H is the FDC Status Register.  Output Commands:<ul><li>00H - restore</li><li>80H - read sector</li><li>A0H - write normal sector</li><li>A1H - write read protect sector</li><li>C0H - read address</li><li>D0H - reset; puts FDC in mode 1</li><li>E0H - read track</li><li>F0H - write track</li></ul></div></div>
									<div class="assembly-row-combined both"><div>3468</div><div><a href="#3518" class="memory-link">CALL 3518H</a></div><div>In
 v2 of the ROM - GOSUB to 3518H (which contained a PUSH BC, POP BC, NOP,
 and RET) to delay for (arguably) the time it will take for the FDC to 
respond to that OUT command.  This was changed in v3 of the ROM to fix 
what Technical Bulletin III:10 referred to as a ?garbage on screen? 
power up problem (which they blame on the power up requirements of the 
RAM at Ul2, U9, and U8), by replacing the CALL with a PUSH BC, POP BC, 
NOP.</div></div>
									<div class="assembly-row-combined both"><div>346B</div><div>LD A,04H</div><div>Load A with a 4 (Binary: 0000 0100).</div></div>
									<div class="assembly-row-combined both"><div>346D</div><div>OUT (0E0H),A</div><div>Output 4 to E0H to JUMP to 4046H to Set the Maskable Interrupt.<br><b>NOTE:</b> Port E0H is the maskable interrupt latch, which directs jumps.
<table class="bit-table-breakdown"><tbody><tr class="header"><td colspan="8" style="text-align: center;">Bit Number</td><td class="spacer-first"></td><td style="text-align: center;">Jump Address</td></tr>
<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td class="spacer"></td><td>3365H</td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td class="spacer"></td><td>3369H</td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td class="spacer"></td><td>4046H</td></tr>
<tr><td></td><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td class="spacer"></td><td>403DH</td></tr>
<tr><td></td><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4206H</td></tr>
<tr><td></td><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4209H</td></tr>
<tr><td></td><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>4040H</td></tr>
<tr><td>‚úì</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>4043H</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>346F</div><div>LD A,0BH</div><div>Load A with 0BH (Binary: 00001011).</div></div>
									<div class="assembly-row-combined both"><div>3471</div><div>OUT (0F0H),A</div><div>Output 0BH to Port F0H to to RESTORE TO TRACK.<br><b>NOTE:</b>
 Port F0H is the FDC Status Register.  A B0H (Decimal: 00001011) sent to
 Port F0H is the command Restore (0000), Load Head at Beginning (1), No 
Verify (0), 30ms step rate (11).</div></div>
									<div class="assembly-row-combined both"><div>3473</div><div>LD HL,36AAH</div><div>Next we need to initialize some ports via a LDIR.  The next 4 commands will move the 76 (4C) bytes from 36AAH to 4000H.</div></div>
									<div class="assembly-row-combined both"><div>3476</div><div>LD DE,4000H</div></div>
									<div class="assembly-row-combined both"><div>3479</div><div>LD BC,004CH</div></div>
									<div class="assembly-row-combined both"><div>347C</div><div>LDIR</div></div>
									<div class="assembly-row-combined both"><div>347E</div><div>LD HL,36F9H</div><div>Next we need to initialize more ports via a LDIR.  The next 4 commands will move the 64 (40) bytes from 36F9H to 41E5H.</div></div>
									<div class="assembly-row-combined both"><div>3481</div><div>LD DE,41E5H</div></div>
									<div class="assembly-row-combined both"><div>3484</div><div>LD BC,0040H</div></div>
									<div class="assembly-row-combined both"><div>3487</div><div>LDIR</div></div>
									<div class="assembly-row-combined both"><div>3489</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#01C9" class="memory-link">CALL 01C9H</a></div><div>GOSUB to 01C9H to clear the screen.</div></div>
									<div class="assembly-row-combined both"><div>348C</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#028D" class="memory-link">CALL 028DH</a></div><div>GOSUB to 028DH to check for a <kbd>BREAK</kbd> key.</div></div>
									<div class="assembly-row-combined both"><div>348F</div><div><a href="#37AF" class="memory-link">JP NZ,37AFH</a></div><div>If we have a <kbd>BREAK</kbd> key then jump to Non-Disk BASIC at 37AF.</div></div>
									<div class="assembly-row-combined both" id="3492H"><div>3492</div><div>IN A,(F0H)</div><div>If we did not get a <kbd>BREAK</kbd>, then we next need to verify the disk controller by polling Port F0H.<br><b>NOTE:</b> Port F0H is the FLOPPPY STATUS REGISTER.  Results:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Busy (1)</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Index/DRQ (2)</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Track 0/Lost Data (4)</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>CRC Error (8)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Seek Error/Record Not Found (16)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Record Type/Write Fault/Head Loaded (32)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Write Protected (64)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Not Ready (128)</td></tr>
</tbody></table>
									</div></div>
									<div class="assembly-row-combined both"><div>3494</div><div>INC A</div><div>Bump the FDC Status by 1 (which would turn a FFH (128) into a 00H), making a Z flag mean "Disk Controller Not Ready".</div></div>
									<div class="assembly-row-combined both"><div>3495</div><div><a href="#37AF" class="memory-link">JP Z,37AFH</a></div><div>If the FDC Stats + 1 is zero, then we have no disk controller, so jump to Non-Disk BASIC at 37AF.</div></div>
									<div class="assembly-row-combined both"><div>3498</div><div>LD BC,0000H</div><div>If we are here, then we have a floppy controller, so set up for a loop of 65,535 times.</div></div>
									<div class="assembly-row-combined both"><div>349B</div><div>DEC BC</div><div>Decrease BC by 1.</div></div>
									<div class="assembly-row-combined both"><div>349C</div><div>LD A,81H</div><div>Set A to 81H (Decimal: 10000001).</div></div>
									<div class="assembly-row-combined both"><div>349E</div><div>OUT (0F4H),A</div><div>Send 1000 0001 to Port F4H to set double density.<br><b>NOTE:</b>
 Port F4H is the Disk Drive and Disk Density Select.  Bits 0-3 are the 
drive select of 0-3 and Bit 7 is 0 for single density and 1 for double 
density.</div></div>
									<div class="assembly-row-combined both"><div>34A0</div><div>LD A,B<br>OR C</div><div>To test a BC against 0, LOAD A with B and then OR C.  A will be 0 only if both B and C were zero.</div></div>
									<div class="assembly-row-combined both"><div>34A2</div><div><a href="#37AF" class="memory-link">JP Z,37AFH</a></div><div>If we have finished the 65,535 loop then jump to Non-Disk BASIC at 37AF.</div></div>
									<div class="assembly-row-combined both"><div>34A5</div><div>IN A,(F0H)</div><div>We are still in the loop, so poll Port F0H into A.<br><b>NOTE:</b> Port F0H is the FLOPPPY STATUS REGISTER.  Results:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Busy (1)</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Index/DRQ (2)</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Track 0/Lost Data (4)</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>CRC Error (8)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Seek Error/Record Not Found (16)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Record Type/Write Fault/Head Loaded (32)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Write Protected (64)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Not Ready (128)</td></tr>
</tbody></table>
									</div></div>
									<div class="assembly-row-combined both"><div>34A7</div><div>BIT 2,A</div><div>Test Bit 2 of A (the Floppy Status).  If it is 0 then we haven't made it to track 0, otherwise we have.</div></div>
									<div class="assembly-row-combined both"><div>34A9</div><div><a href="#349B" class="memory-link">JR Z,349BH</a></div><div>Still haven't found track 0, so jump back to 349B to continue the drive polling loop of 65,535 times.</div></div>
								</div>
							</div>

							<br><h2 id="34AB">34ABH - Warm Boot Routine.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>34AB</div><div>LD E,05H</div><div>Set up for a loop of 5 using Register E.</div></div>
									<div class="assembly-row-combined both"><div>34AD</div><div>LD BC,0000H</div><div>Set up for a loop of 65,536 using Register Pair BC.</div></div>
									<div class="assembly-row-combined both"><div>34B0</div><div>IN A,(F0H)</div><div>Poll Port F0H into A.<br><b>NOTE:</b> Port F0H is the FLOPPPY STATUS REGISTER.  Results:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Busy (1)</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Index/DRQ (2)</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Track 0/Lost Data (4)</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>CRC Error (8)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Seek Error/Record Not Found (16)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Record Type/Write Fault/Head Loaded (32)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Write Protected (64)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Not Ready (128)</td></tr>
</tbody></table>
									</div></div>
									<div class="assembly-row-combined both"><div>34B2</div><div>BIT 01H,A</div><div>Check A to see if bit 1 (meaning "Drive Busy") is set.</div></div>
									<div class="assembly-row-combined both"><div>34B4</div><div><a href="#34C7" class="memory-link">JR NZ,34C7H</a></div><div>If bit 1 is set, jump to 34C7.</div></div>
									<div class="assembly-row-combined both"><div>34B6</div><div>DEC BC</div><div>If bit 1 is not set (meaning, the drive is NOT busy), reduce the counter (BC) by 1.</div></div>
									<div class="assembly-row-combined both"><div>34B7</div><div>LD A,81H</div><div>Load A with 81H (Decimal: 129, Binary: 1000 0001).</div></div>
									<div class="assembly-row-combined both"><div>34B9</div><div>OUT (0F4H),A</div><div>Output A to Port F4H to select drive 0, double density.<br><b>NOTE:</b>
 Port F4H is the Disk Drive and Disk Density Select.  Bits 0-3 are the 
drive select of 0-3 and Bit 7 is 0 for single density and 1 for double 
density.</div></div>
									<div class="assembly-row-combined both"><div>34BB</div><div>LD A,B<br>OR C</div><div>To test a BC against 0, LOAD A with B and then OR C.  A will be 0 only if both B and C were zero.</div></div>
									<div class="assembly-row-combined both"><div>34BD</div><div><a href="#34B0" class="memory-link">JR NZ,34B0H</a></div><div>If BC is not 0, then loop back to 43B0H.</div></div>
									<div class="assembly-row-combined both"><div>34BF</div><div>LD HL,0277H</div><div>If
 we are here, then we received no BIT 1 of FLOPPY STATUS REGISTER 
despite 65,536 tries, so we need to deal with that by printing 
"DISKETTE?" on the screen.  Point HL to the "DISKETTE?" message at 
0279H.</div></div>
									<div class="assembly-row-combined both"><div>34C2</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#021B" class="memory-link">CALL 021BH</a></div><div>GOSUB to 021BH.  Note; 021BH will display the character at (HL) until a 03H is found.</div></div>
									<div class="assembly-row-combined both"><div>34C5</div><div><a href="#34AB" class="memory-link">JR 34ABH</a></div><div>If we are here, there is no disk in drive and we displayed "DISKETTE?" so loop back to 034AB to poll for a disk all over again.</div></div>
									<div class="assembly-row-combined both"><div>34C7</div><div>DEC E</div><div>If we are here, it found a diskette so next we need to find the index mark.  First decrement E by 1.</div></div>
									<div class="assembly-row-combined both"><div>34C8</div><div><a href="#34AD" class="memory-link">JR NZ,34ADH</a></div><div>Jump back to the top of this WARM BOOT ROUTINE to check the FDC up to 5 times.</div></div>
									<div class="assembly-row-combined both" id="34CA"><div>34CA</div><div>LD A,81H</div><div>Load A with 81H (Decimal: 129, Binary: 1000 0001).</div></div>
									<div class="assembly-row-combined both"><div>34CC</div><div>OUT (0F4H),A</div><div>Output A to Port F4H to select drive 0, double density.<br><b>NOTE:</b>
 Port F4H is the Disk Drive and Disk Density Select.  Bits 0-3 are the 
drive select of 0-3 and Bit 7 is 0 for single density and 1 for double 
density.</div></div>
									<div class="assembly-row-combined both"><div>34CE</div><div>LD HL,3502H</div><div>We
 need to set the Non-Maskable Interrupt Vector to be a JUMP to 3502H so 
we do the next 4 steps.  Sets 3502H as the jump point for a NMI hit, 
which is what occurs once a sector has been completely read.</div></div>
									<div class="assembly-row-combined both"><div>34D1</div><div>LD (404AH),HL</div></div>
									<div class="assembly-row-combined both"><div>34D4</div><div>LD A,C3H</div><div>Load A with C3H (Decimal: 195, Binary 1100 0011).</div></div>
									<div class="assembly-row-combined both"><div>34D6</div><div>LD (4049H),A</div><div>Put the C3H into 4049H.<br><b>NOTE:</b> 4049H is the Non-Maskable Interrupt Vector.</div></div>
									<div class="assembly-row-combined both"><div>34D9</div><div>LD A,80H</div><div>Load A with 80H (Decimal: 128, Binary 1000 0000).</div></div>
									<div class="assembly-row-combined both"><div>34DB</div><div>OUT (0E4H),A</div><div>Output "1000 0000" to Port E4H.<br><b>NOTE:</b> Port E4H is the non-maskable interrupt latch.</div></div>
									<div class="assembly-row-combined both"><div>34DD</div><div>LD BC,00F3H</div><div>Set BC to F3H.<br><b>NOTE:</b> Port F3H is the Floppy Disk Controller Data Register.</div></div>
									<div class="assembly-row-combined both"><div>34E0</div><div>LD HL,4300H</div><div>Set HL to 4300H, which is where the data is going to go.</div></div>
									<div class="assembly-row-combined both"><div>34E3</div><div>LD A,01H</div><div>Prepare to read Sector 1 by loading A with a 1.</div></div>
									<div class="assembly-row-combined both"><div>34E5</div><div>OUT (0F2H),A</div><div>Output 1 to Port F2H.<br><b>NOTE:</b> Port F2H is the Floppy Disk Controller Track Register.</div></div>
									<div class="assembly-row-combined both"><div>34E7</div><div>LD A,80H</div><div>Prepare to read a single sector by loading A with 80H (Decimal: 128, Binary: 1000 0000).</div></div>
									<div class="assembly-row-combined both"><div>34E9</div><div>OUT (0F0H),A</div><div>Output "1000 0000" to Port F0H.<br><b>NOTE:</b>
 Port F0H is the FDC Status Register.  Outputting 1000 0000 is issuing 
the command READ SECTOR (100), SINGLE RECORD (0), SIDE 0 (0), NO 15MS 
DELAY (0), DISABLE SIDE COMPARE (0).</div></div>
									<div class="assembly-row-combined both"><div>34EB</div><div><a href="#3518" class="memory-link">CALL 3518H</a></div><div>GOSUB to 3518H to delay 3 instruction cycles, arguably the time it will take for the FDC to respond to the port command.</div></div>
									<div class="assembly-row-combined both"><div>34EE</div><div>IN A,(F0H)</div><div>Load the results of Port F0H into A.<br><b>NOTE:</b> Port F0H is the FLOPPPY STATUS REGISTER.  Results:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Busy (1)</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Index/DRQ (2)</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Track 0/Lost Data (4)</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>CRC Error (8)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Seek Error/Record Not Found (16)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Record Type/Write Fault/Head Loaded (32)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Write Protected (64)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Not Ready (128)</td></tr>
</tbody></table>
									</div></div>
									<div class="assembly-row-combined both"><div>34F0</div><div>AND 02H</div><div>Mask
 A against (0000 0010) which will leave only bit 1 active.  This will 
test for the index mark, and Z will indicate that the index mark has NOT
 been detected, and NZ will indicate the index mark has been detected.</div></div>
									<div class="assembly-row-combined both"><div>34F2</div><div><a href="#34EE" class="memory-link">JP Z,34EEH</a></div><div>Loop back 2 instructions to keep polling F0H until the index is found.</div></div>
									<div class="assembly-row-combined both"><div>34F5</div><div>INI</div><div>Input the data byte.</div></div>
									<div class="assembly-row-combined both" id="34F7"><div>34F7</div><div>LD A,81H</div><div>Load A with 81H (Decimal: 129, Binary: 1000 0001) to select disk 0.</div></div>
									<div class="assembly-row-combined both"><div>34F9</div><div>OR 40H</div><div>OR A with 40H (Binary: 0100 0000) to set A to double-density.</div></div>
									<div class="assembly-row-combined both"><div>34FB</div><div>OUT (0F4H),A</div><div>Output A to Port F4H to select drive 0, double density.<br><b>NOTE:</b> Port F4H is the Disk Drive and Disk Density Select.  On OUTPUT:
<table class="bit-table-breakdown"> <tbody><tr class="header"><td colspan="8">Bit Number (Write to External Control Port)</td><td class="31c0-first"></td><td>Function / Description</td></tr> <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Density Select: (0=Single Density, 1=Double Density)</td></tr>
<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Reserved (Often used for Motor On/Off or Drive Select 4+)</td></tr>
<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Reserved (Often used for Side Select)</td></tr>
<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Reserved (Often used for Motor On/Off)</td></tr>
<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Drive Select 3 (1=Select Drive 3)</td></tr>
<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Drive Select 2 (1=Select Drive 2)</td></tr>
<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Drive Select 1 (1=Select Drive 1)</td></tr>
<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Drive Select 0 (1=Select Drive 0)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>34FD</div><div>INI</div><div>Input the data byte.</div></div>
									<div class="assembly-row-combined both"><div>34FF</div><div><a href="#34F7" class="memory-link">JP 34F7H</a></div><div>Loop back to 34F7 to set drive and density.<br><b>NOTE:</b>
 This appears to be an infinite loop in the code, but it isn't in 
actuality.  Once the disk controller has loaded an entire sector, it 
will trigger a non-maskable interrupt and will exit to 3502H.  That was 
set up at 34CE.</div></div>
								</div>
							</div>

							<br><h2 id="3502">3502H - Non-Maskable Interrupt Jump Point to verify the disk sector read wasn't in error.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3502</div><div>XOR A</div><div>Clear A and all flags.</div></div>
									<div class="assembly-row-combined both"><div>3503</div><div>OUT (0E4H),A</div><div>Send a 0 to Port E4H.<br><b>NOTE:</b> Port E4H is the non-maskable interrupt latch.  This is to clear the non-maskable interrupt status.</div></div>
									<div class="assembly-row-combined both"><div>3505</div><div>LD HL,45EDH</div><div>Now that the NMI jumped here, we need to set a new NMI jump, this time to 45EDH.</div></div>
									<div class="assembly-row-combined both"><div>3508</div><div>LD (4049H),HL</div><div>Load "45EDH" into 4049H.<br><b>NOTE:</b> 4049H is the Non-Maskable Interrupt Vector.</div></div>
									<div class="assembly-row-combined both"><div>350B</div><div><a href="#3518" class="memory-link">CALL 3518H</a></div><div>GOSUB to 3518H to delay 3 instruction cycles, arguably the time it will take for the FDC to respond to the port command.</div></div>
									<div class="assembly-row-combined both"><div>350E</div><div>IN A,(F0H)</div><div>Poll Port F0H and put the results into A.<br><b>NOTE:</b> Port F0H is the FLOPPPY STATUS REGISTER.  Results:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Busy (1)</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Index/DRQ (2)</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Track 0/Lost Data (4)</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>CRC Error (8)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Seek Error/Record Not Found (16)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Record Type/Write Fault/Head Loaded (32)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Write Protected (64)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Not Ready (128)</td></tr>
</tbody></table>
									</div></div>
									<div class="assembly-row-combined both"><div>3510</div><div>POP HL</div><div>Clean up the Stack.</div></div>
									<div class="assembly-row-combined both"><div>3511</div><div>AND 1CH</div><div>Mask
 A with 1CH (Binary: 0001 1100).  This keep only bit 3 (Track 0/Lost 
Data), bit 4 (CRC Error) and bit 5 (Seek Error/Record Not Found).  If 
NONE of these are present, then Z will be set.</div></div>
									<div class="assembly-row-combined both"><div>3513</div><div><a href="#4300" class="memory-link">JP Z,4300H</a></div><div>If those 3 errors aren't generated, then JUMP to 4300H.</div></div>
									<div class="assembly-row-combined both"><div>3516</div><div><a href="#34CA" class="memory-link">JR 34CAH</a></div><div>If we are here at least one of those errors were present, so JUMP back to 34CAH to try to read the sector again.</div></div>
								</div>
							</div>

							<br><h2 id="3518">3518H - Really Short Delay keyed to FDC Controller Response Time.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3518</div><div>PUSH BC</div><div>Push BC to the Stack.</div></div>
									<div class="assembly-row-combined both"><div>3519</div><div>POP BC</div><div>Get BC from the Stack.</div></div>
									<div class="assembly-row-combined both"><div>351A</div><div>NOP</div><div>No Operation.</div></div>
									<div class="assembly-row-combined both"><div>351B</div><div>RET</div><div>Return.</div></div>
								</div>
							</div>

							<br><h2 id="351C">351CH - NMI handler.  On entry, A holds Bit 5 of the Non-Maskable Interrupt Latch at port 0E4H.  303DH jumped here.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>351C</div><div><a href="#4049" class="memory-link">JP NZ,4049H</a></div><div>If
 Bit 5 of the Non-Maskable Interrupt Latch was NOT zero (meaning, disk 
interrupt), then jump to 4049H which, in TRSDOS, is a jump to 42BDH 
which, at least in TRSDOS, in a RETurn.</div></div>
									<div class="assembly-row-combined both"><div>351F</div><div>IN A,(E4H)</div><div>Poll Port E4H into A.<br><b>NOTE:</b> Port E4H is the Non-Maskable Interrupt Latch.</div></div>
									<div class="assembly-row-combined both"><div>3521</div><div>BIT 5,A</div><div>Test Bit 5 of Port E4 against A.<br><b>NOTE:</b> Port E4H is the Non-Maskable Interrupt Latch.</div></div>
									<div class="assembly-row-combined both"><div>3523</div><div><a href="#351F" class="memory-link">JR Z,351FH</a></div><div>Loop back 2 instructions until it is set (i.e., not a zero).</div></div>
									<div class="assembly-row-combined both"><div>3525</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0000" class="memory-link">JP 0000H</a></div><div>Jump to 0000H to restart the computer.</div></div>
									<div class="assembly-row-combined both"><div>3528</div><div>FF</div><div>Unused Garbage.  Holdover from v1 ROM.</div></div>
								</div>
							</div>

							<br><h2 id="3529">3529H - Deal with the cursor.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3529</div><div>LD DE,3591H</div><div>Set the return address to 3591H and put that into DE.</div></div>
									<div class="assembly-row-combined both"><div>352C</div><div>PUSH DE</div><div>Push that return address onto the Stack.</div></div>
									<div class="assembly-row-combined both"><div>352D</div><div>IN A,(0ECH)</div><div>Poll Port ECH and put the results into A.<br><b>NOTE:</b> Port ECH is the Miscellaneous Controls port, which covers
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>352F</div><div>LD A,(4022H)</div><div>Check to see if the Cursor is on by loading (4022H) into A.<br><b>NOTE:</b> 4022H holds the Cursor ON/OFF Flag and will be 0 if the cursor is off, or the the underscore character otherwise.</div></div>
									<div class="assembly-row-combined both"><div>3532</div><div>OR A</div><div>Set the flags.</div></div>
									<div class="assembly-row-combined both"><div>3533</div><div><a href="#3557" class="memory-link">JR Z,3557H</a></div><div>If A was zero, then the cursor is off and we JUMP down to 3557H.</div></div>
									<div class="assembly-row-combined both"><div>3535</div><div>LD A,(401CH)</div><div>Check to see if the cursor is to blink by loading (401CH) into A.<br><b>NOTE:</b> 401CH holds the Cursor Blink Switch and will be 0 for Blink, and anything else for No Blink.</div></div>
									<div class="assembly-row-combined both"><div>3538</div><div>OR A</div><div>Test A.</div></div>
									<div class="assembly-row-combined both"><div>3539</div><div><a href="#3557" class="memory-link">JR NZ,3557H</a></div><div>If the system is set for No Blink, then JUMP to 3557H.</div></div>
									<div class="assembly-row-combined both"><div>353B</div><div>LD HL,401AH</div><div>Load HL with 401AH.<br><b>NOTE:</b> 401AH is the memory location that stores the cursor blink count.</div></div>
									<div class="assembly-row-combined both"><div>353E</div><div>DEC (HL)</div><div>Reduce the memory contents of (401AH) by one.<br><b>NOTE:</b> 401AH is the memory location that stores the cursor blink count.</div></div>
									<div class="assembly-row-combined both"><div>353F</div><div><a href="#3557" class="memory-link">JR NZ,3557H</a></div><div>If that reduced count is still not zero, JUMP to 3557H.</div></div>
									<div class="assembly-row-combined both"><div>3541</div><div>LD (HL),07H</div><div>Set the cursor blink count to 7.<br><b>NOTE:</b> 401AH is the memory location that stores the cursor blink count.</div></div>
									<div class="assembly-row-combined both"><div>3543</div><div>INC HL</div><div>Bump HL.  This will increase HL from 401AH to 401BH.<br><b>NOTE:</b> 401BH holds the cursor blink status - 0 = Off, Anything Else = On.</div></div>
									<div class="assembly-row-combined both"><div>3544</div><div>LD A,(HL)</div><div>Poll the cursor blink status memory location and put the results into A.</div></div>
									<div class="assembly-row-combined both"><div>3545</div><div>AND 01H</div><div>Mask A against 0000 0001, to have only Bit 0 active.</div></div>
									<div class="assembly-row-combined both"><div>3547</div><div>XOR 01H</div><div>XOR A with 01H.</div></div>
									<div class="assembly-row-combined both"><div>3549</div><div>LD (HL),A</div><div>Put the toggled cursor blink status into the appropriate memory location.</div></div>
									<div class="assembly-row-combined both"><div>354A</div><div>LD HL,(4020H)</div><div>Poll (4020H) and put the result into HL.<br><b>NOTE:</b> 4020H holds the current cursor position.</div></div>
									<div class="assembly-row-combined both"><div>354D</div><div><a href="#3554" class="memory-link">JR Z,3554H</a></div><div>If the current cursor position is 0, then it is off, so JUMP down 2 instructions to 3554H to make the cursor a blank (space).</div></div>
									<div class="assembly-row-combined both"><div>354F</div><div>LD A,(4023H)</div><div>Load A with the memory contents of (4023H).<br><b>NOTE:</b> 4023H holds the cursor character.</div></div>
									<div class="assembly-row-combined both"><div>3552</div><div><a href="#3556" class="memory-link">JR 3556H</a></div><div>JUMP down to 3556H to skip the next instruction and continue this routine by displaying the character in A.</div></div>
									<div class="assembly-row-combined both" id="3554"><div>3554</div><div>LD A,20H</div><div>Load A with 20H which is the ASCII equivalent of a <span class="code">SPACE</span>.</div></div>
								</div>
							</div>

							<br><h2 id="3556">3556H - Update the heartbeat and deal with the time, including rollover to the next day, month, and year.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3556</div><div>LD (HL),A</div><div>Put the character held in A into the memory location pointed to by (HL).<br><b>NOTE:</b> (HL) will hold the current cursor position.</div></div>
									<div class="assembly-row-combined both"><div>3557</div><div>LD HL,4216H</div><div>LET Register Pair HL = 4216H.<br><b>NOTE:</b> 4216H is the heartbeat counter.</div></div>
									<div class="assembly-row-combined both"><div>355A</div><div>DEC (HL)</div><div>Decrease the number held at (4216H) by 1.</div></div>
									<div class="assembly-row-combined both"><div>355B</div><div>RET NZ</div><div>If the number held at (4216H) is not zero, then RETURN.</div></div>
									<div class="assembly-row-combined both"><div>355C</div><div>LD (HL),1EH</div><div>Put a 1EH (Decimal: 30) into (4216H).<br><b>NOTE:</b> 4216H is the heartbeat counter.</div></div>
									<div class="assembly-row-combined both"><div>355E</div><div>INC HL</div><div>Bump HL by 1.  HL will now point to 4217H, which is the memory location that holds the SECONDS.</div></div>
									<div class="assembly-row-combined both"><div>355F</div><div>LD DE,0266H</div><div>Load DE with 0266H.<br><b>NOTE:</b>
 0266H points to the TIME DATA of the number of seconds in a minute, the
 number of mnutes in an hour, and the number of hours in a day.</div></div>
									<div class="assembly-row-combined both"><div>3562</div><div>LD B,03H</div><div>Load B with a 03H, to set up a loop where we test seconds, minutes, and hours against their maximums.</div></div>
									<div class="assembly-row-combined both"><div>3564</div><div>INC (HL)</div><div>Bump the number currently held in HL to increase the number stored there 1.<br><b>NOTE:</b> If HL is 4217H then it is seconds, 4218H then it is minutes, 4217H then it is hours.</div></div>
									<div class="assembly-row-combined both"><div>3565</div><div>LD A,(DE)</div><div>Poll the memory contents held at (DE) and put the result into A to get the maximum possible units for each time measure.<br><b>NOTE:</b>
 0266H points to the TIME DATA of the number of seconds in a minute, 
0267H points to the number of mnutes in an hour, and 0268H points to the
 number of hours in a day.</div></div>
									<div class="assembly-row-combined both"><div>3566</div><div>SUB (HL)</div><div>Compare the maximum to what we have by subtracting that maximum from the value pointed at in (HL).</div></div>
									<div class="assembly-row-combined both"><div>3567</div><div>RET NZ</div><div>If there is no difference between what we have and the maximum then RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3568</div><div>LD (HL),A</div><div>If
 there is a difference, then put the difference into (HL) because we 
have to bump the next highest thing (seconds to minutes, minutes to 
hours, hours to days).</div></div>
									<div class="assembly-row-combined both"><div>3569</div><div>INC HL</div><div>Bump HL.<br><b>NOTE:</b> If HL is 4217H then it is seconds, 4218H then it is minutes, 4219H then it is hours, and 421AH then it is YEARS.</div></div>
									<div class="assembly-row-combined both"><div>356A</div><div>INC DE</div><div>Bump DE.<br><b>NOTE:</b>
 0266H points to the TIME DATA of the number of seconds in a minute, 
0267H points to the number of mnutes in an hour, and 0268H points to the
 number of hours in a day.</div></div>
									<div class="assembly-row-combined both"><div>356B</div><div><a href="#3564" class="memory-link">DJNZ 3564H</a></div><div>Loop back to 3564H until the loop of 3 has been met, meaning that we have processed seconds, minutes, and hours.</div></div>
									<div class="assembly-row-combined both"><div>356D</div><div>INC HL</div><div>Bump HL one more time, to 421BH.<br><b>NOTE:</b> 421BH holds the current DAY portion of the date.</div></div>
									<div class="assembly-row-combined both"><div>356E</div><div>INC (HL)</div><div>Bump the DAY portion of the date.</div></div>
									<div class="assembly-row-combined both"><div>356F</div><div>INC HL</div><div>Bump HL one more time, to 421CH.<br><b>NOTE:</b> 421BH holds the current MONTH portion of the date.</div></div>
									<div class="assembly-row-combined both"><div>3570</div><div>LD A,(HL)</div><div>Get the month and put it into A.</div></div>
									<div class="assembly-row-combined both"><div>3571</div><div>DEC HL</div><div>Decrease HL back to to 421BH.<br><b>NOTE:</b> 421BH holds the DAY portion of the date.</div></div>
									<div class="assembly-row-combined both"><div>3572</div><div>DEC A</div><div>Decrease A by one (to the previous month).<br><b>NOTE:</b> DE currently points to the memory locations housing the of days in each month.</div></div>
									<div class="assembly-row-combined both"><div>3573</div><div>ADD A,E</div><div>Add E to A.</div></div>
									<div class="assembly-row-combined both"><div>3574</div><div>LD E,A</div><div>Load E with the result.  E = E + A.</div></div>
									<div class="assembly-row-combined both"><div>3575</div><div>LD A,(DE)</div><div>Poll the number of days in a month and put the result into A.</div></div>
									<div class="assembly-row-combined both"><div>3576</div><div>CP (HL)</div><div>Compare A against (HL).<br><b>NOTE:</b> If this is not a loop, the HL holds the day portion of the date.</div></div>
									<div class="assembly-row-combined both"><div>3577</div><div>RET NC</div><div>If
 all of this shows that the current day of the month is less than the 
maximum number of days in a month, then RETURN because we don't need to 
bump anything more.</div></div>
									<div class="assembly-row-combined both"><div>3578</div><div>LD A,(HL)</div><div>Load A with the current day of the month, as HL was pushed back to point to the day of the month at instruction 3571H.</div></div>
									<div class="assembly-row-combined both"><div>3579</div><div>CP 1EH</div><div>Compare A to 1E (Decimal: 30).<br><b>NOTE:</b>
 A CP actually subtracts 1E from A without modifying A, but the flags 
are set accordingly.  Here, if A is &lt; 1E then the CARRY FLAG will be 
set.</div></div>
									<div class="assembly-row-combined both"><div>357B</div><div><a href="#3583" class="memory-link">JR NC,3583H</a></div><div>If the carry flag isn't set then JUMP to 3583H to update the MONTH, but not the YEAR.</div></div>
									<div class="assembly-row-combined both"><div>357D</div><div>DEC HL</div><div>Decrement HL to now point to 421AH.<br><b>NOTE:</b> 421AH points to the current YEAR.</div></div>
									<div class="assembly-row-combined both"><div>357E</div><div>LD A,(HL)</div><div>Load the YEAR into A.</div></div>
									<div class="assembly-row-combined both"><div>357F</div><div>INC HL</div><div>Bump HL to 421BH.<br><b>NOTE:</b> 421BH points to the current DAY.</div></div>
									<div class="assembly-row-combined both"><div>3580</div><div>AND 03H</div><div>Mask A (which is holding the year) with 03H (Binary: 00000011) to test for a leap year.</div></div>
									<div class="assembly-row-combined both"><div>3582</div><div>RET Z</div><div>RETURN if that mask showed that we are in the 4th year of a cycle (because 04 and higher are turned off).</div></div>
									<div class="assembly-row-combined both" id="3583"><div>3583</div><div>LD (HL),01H</div><div>Put a 1 into the memory location pointed to by HL (which is DAY).</div></div>
									<div class="assembly-row-combined both"><div>3585</div><div>INC HL</div><div>Bump HL to 421CH.<br><b>NOTE:</b> 421BH points to the current MONTH.</div></div>
									<div class="assembly-row-combined both"><div>3586</div><div>INC (HL)</div><div>Increase the current MONTH by 1.</div></div>
									<div class="assembly-row-combined both"><div>3587</div><div>LD A,(HL)</div><div>Put the current MONTH into A.</div></div>
									<div class="assembly-row-combined both"><div>3588</div><div>SUB 0DH</div><div>Subract 13 from A.<br><b>NOTE:</b> This will test against a month 13.  If A is &lt; 13, then the CARRY FLAG will be set.</div></div>
									<div class="assembly-row-combined both"><div>358A</div><div>RET C</div><div>If it is NOT month 13 then RETURN to skip the next code which increases the YEAR.</div></div>
									<div class="assembly-row-combined both"><div>358B</div><div>LD (HL),01H</div><div>If we are here, then MONTH = 13, so set MONTH to 1.</div></div>
									<div class="assembly-row-combined both"><div>358D</div><div>DEC HL</div><div>Decrement HL to 421BH.<br><b>NOTE:</b> 421BH points to the current DAY.</div></div>
									<div class="assembly-row-combined both"><div>358E</div><div>DEC HL</div><div>Decrement HL to 421AH.<br><b>NOTE:</b> 421BH points to the current YEAR.</div></div>
									<div class="assembly-row-combined both"><div>358F</div><div>INC (HL)</div><div>Bump the current year.</div></div>
									<div class="assembly-row-combined both"><div>3590</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3591">3591H - Check to see if the clock is on and 
exit back out if it is off OR the heartbeat shows that the clock was 
just updated.  Pass through otherwise.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3591</div><div>LD A,(4210H)</div><div>Test to see if the clock is on by loading A with the memory contents of 4210H.<br><b>NOTE:</b> 4210H is the bit mask for Port ECH.  Port ECH is the Miscellaneous Controls port, which covers
<table class="bit-table-breakdown">
	<tbody><tr class="header"><td colspan="8">Bit Number</td><td class="31c0-first"></td><td>Function</td></tr>
	<tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
	<tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Clock On/Off (1=Clock On)</td></tr>
	<tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Cassette Motor On/Off (1=Motor On)</td></tr>
	<tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Double Size Video On/Off (1=Double Size)</td></tr>
	<tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Special Char Select (1=Kana)</td></tr>
	<tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Model 4 Only (Reserved)</td></tr>
	<tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Model 4 Only (Reserved)</td></tr>
</tbody></table></div></div>

									<div class="assembly-row-combined both"><div>3594</div><div>BIT 0,A</div><div>Test Bit 0 of A to see if the clock is on or off.</div></div>
									<div class="assembly-row-combined both"><div>3596</div><div>RET Z</div><div>If Bit 0 of A is ZERO, then return.</div></div>
									<div class="assembly-row-combined both"><div>3597</div><div>LD A,(4216H)</div><div>If we are here, then the clock is on, so load A with the memory contents of (4216H) to see if the clock was just updated.<br><b>NOTE:</b> 4216H is the heartbeat counter.</div></div>
									<div class="assembly-row-combined both"><div>359A</div><div>CP 1EH</div><div>Compare the heartbeat counter against 1EH.<br><b>NOTE:</b> A CP actually subtracts 1E from A without modifying A, but the flags are set accordingly.</div></div>
									<div class="assembly-row-combined both"><div>359C</div><div>RET NZ</div><div>If the clock was not just updated, then RETURN.</div></div>
									<div class="assembly-row-combined both"><div>359D</div><div>LD HL,3C35H</div><div>If
 the clock was just updated, then we need to display to screen so we set
 HL to the screen location of 3C35H which is the top line of the screen,
 10 characters from the end of first line.</div></div>
								</div>
							</div>

							<br><h2 id="35A0">35A0H - Put the Clock 10 characters from the 
end of the first line.  We enter this routine with HL pointing to the 
screen location 10 characters from the end of the first line.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>35A0</div><div>LD DE,4219H</div><div>Set DE to 4219H.<br><b>NOTE:</b> 4219H is the current HOUR.</div></div>
									<div class="assembly-row-combined both"><div>35A3</div><div>LD C,3AH</div><div>Load C with a <span class="code">:</span>.<br><b>NOTE:</b> This routine is also used to convert the date, and C will be swapped out to a <span class="code">/</span> for that routine.</div></div>
									<div class="assembly-row-combined both"><div>35A5</div><div>LD B,03H</div><div>Load B with a 3.<br><b>NOTE:</b> This is because we need to convert 3 numbers, so we will loop 3 times.</div></div>
									<div class="assembly-row-combined both"><div>35A7</div><div>LD A,(DE)</div><div>Put the memory contents of DE into A.<br><b>NOTE:</b> This will be HOUR (4219H) on the first pass, MINUTE (4218H) on the second pass, and SECOND (4219H) on the third pass.</div></div>
									<div class="assembly-row-combined both"><div>35A8</div><div>DEC DE</div><div>Decrement DE to point to the next unit to be dealt with.</div></div>
									<div class="assembly-row-combined both"><div>35A9</div><div>LD (HL),2FH</div><div>Load the memory location pointed to by (HL) with 2F.<br><b>NOTE:</b> 2F is a <span class="code">/</span> which is also 1 character below a <span class="code">0</span>.</div></div>
									<div class="assembly-row-combined both"><div>35AB</div><div>INC (HL)</div><div>Increase whatever is held in (HL).  On the first iteration, this change the character at the screen location to a <span class="code">0</span>.</div></div>
									<div class="assembly-row-combined both"><div>35AC</div><div>SUB 0AH</div><div>A = A - 10.  If A is &lt; 10, then the CARRY FLAG will be set and if A is &gt; 10, the NOT CARRY FLAG will be set.</div></div>
									<div class="assembly-row-combined both"><div>35AE</div><div><a href="#35AB" class="memory-link">JR NC,35ABH</a></div><div>Loop back 2 instructions if A &gt; 10 [V!!!].</div></div>
									<div class="assembly-row-combined both"><div>35B0</div><div>ADD A,3AH</div><div>If
 we are here, then A was less than 10, so we need to increase A by 3A 
(Binary: 0011 1010) to point to the ASCII number of the remainder.</div></div>
									<div class="assembly-row-combined both"><div>35B2</div><div>INC HL</div><div>Bump HL to point to the next location on the video screen.  On the first iteration, this will be the 2nd digit of the HOUR.</div></div>
									<div class="assembly-row-combined both"><div>35B3</div><div>LD (HL),A</div><div>Put
 the ASCII value of the remainder onto the screen.  On the first 
iteration, this will be the 2nd digit of the HOUR put into 4220H.</div></div>
									<div class="assembly-row-combined both"><div>35B4</div><div>INC HL</div><div>Bump HL to point to the next location on the video screen.  On the first iteration, this will be the 3rd character.</div></div>
									<div class="assembly-row-combined both"><div>35B5</div><div>DEC B</div><div>Decrement B to the next unit.  On the first iteration, this will move from 3 to 2.</div></div>
									<div class="assembly-row-combined both"><div>35B6</div><div>RET Z</div><div>If we have processed all passes in the loop, RETURN.</div></div>
									<div class="assembly-row-combined both"><div>35B7</div><div>LD (HL),C</div><div>If we are here, then the routine has not yet looped 3 times, so put a <span class="code">:</span> onto the screen.</div></div>
									<div class="assembly-row-combined both"><div>35B8</div><div>INC HL</div><div>Bump HL to point to the next location on the video screen.</div></div>
									<div class="assembly-row-combined both"><div>35B9</div><div><a href="#35A7" class="memory-link">JR 35A7H</a></div><div>JUMP back to 35A7 to continue the loop.</div></div>
								</div>
							</div>

							<br><h2 id="35BB">35BBH - Put the DATE 8 characters from the end 
of the first line.  We enter this routine with HL pointing to the screen
 location and we just jump into the prior routine with a different 
pointer to the DATE and a change in the delimeter to a <span class="code">/</span>.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>35BB</div><div>LD DE,421CH</div><div>Load DE with 421CH.<br><b>NOTE:</b> 421CH holds the current MONTH.</div></div>
									<div class="assembly-row-combined both"><div>35BE</div><div>LD C,2FH</div><div>Load C with a <span class="code">/</span>.</div></div>
									<div class="assembly-row-combined both"><div>35C0</div><div><a href="#35A5" class="memory-link">JR 35A5H</a></div><div>Jump into the above routine to convert the Month, Day, and Year.</div></div>
								</div>
							</div>

							<br><h2 id="35C2">35C2H - Maskable Interrupt Handler.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>35C2</div><div>PUSH AF</div><div>Save AF to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>35C3</div><div>IN A,(E0H)</div><div>Poll Port E0H which is the MASKABLE INTERRUPT LATCH and put the results into A.</div></div>
									<div class="assembly-row-combined both"><div>35C5</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 0 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35C6</div><div><a href="#3365" class="memory-link">JP NC,3365H</a></div><div>If Bit 0 is low then JUMP to 3365H (which is a cassette routine with E set to HIGH).</div></div>
									<div class="assembly-row-combined both"><div>35C9</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 0 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35CA</div><div><a href="#3369" class="memory-link">JP NC,3369H</a></div><div>If Bit 1 (which is now in the carry) is low then JUMP to 3369H (which is a cassette routine with E set to LOW).</div></div>
									<div class="assembly-row-combined both"><div>35CD</div><div>PUSH BC</div><div>Save all the registers.</div></div>
									<div class="assembly-row-combined both"><div>35CE</div><div>PUSH DE</div></div>
									<div class="assembly-row-combined both"><div>35CF</div><div>PUSH HL</div></div>
									<div class="assembly-row-combined both"><div>35D0</div><div>PUSH IX</div></div>
									<div class="assembly-row-combined both"><div>35D2</div><div>PUSH IY</div></div>
									<div class="assembly-row-combined both"><div>35D4</div><div>LD HL,35F1H</div><div>Load HL with 35F1H to set the return address.</div></div>
									<div class="assembly-row-combined both"><div>35D7</div><div>PUSH HL</div><div>Push HL to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>35D8</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 2 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35D9</div><div><a href="#4046" class="memory-link">JP NC,4046H</a></div><div>If Bit 2 (which is now in the carry) is low then JUMP to 4046H.<br><b>NOTE:</b>
 4046H is Interrupt Vector 2 and contains a JUMP to 4046H which, in at 
least in TRSDOS, is just a JUMP to 3529H and is used by the clock.</div></div>
									<div class="assembly-row-combined both"><div>35DC</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 3 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35DD</div><div><a href="#403D" class="memory-link">JP NC,403DH</a></div><div>If Bit 3 (which is now in the carry) is low then JUMP to 403DH.<br><b>NOTE:</b>
 403DH is Interrupt Vector 3 and contains a JUMP to 403DH which, in at 
least in TRSDOS, is just a JUMP to 35FAH which is a RETurn.</div></div>
									<div class="assembly-row-combined both"><div>35E0</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 4 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35E1</div><div><a href="#4206" class="memory-link">JP NC,4206H</a></div><div>If Bit 4 (which is now in the carry) is low then JUMP to 4206H.<br><b>NOTE:</b>
 403DH is Interrupt Vector 4 and contains a JUMP to 4206H which, in at 
least in TRSDOS, is just a JUMP to 35FAH which is a RETurn.</div></div>
									<div class="assembly-row-combined both"><div>35E4</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 5 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35E5</div><div><a href="#4209" class="memory-link">JP NC,4209H</a></div><div>If Bit 5 (which is now in the carry) is low then JUMP to 4209H.<br><b>NOTE:</b>
 4209H is Interrupt Vector 5 and contains a JUMP to 4209H which, in at 
least in TRSDOS, is just a JUMP to 35FAH which is a RETurn.</div></div>
									<div class="assembly-row-combined both"><div>35E8</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 6 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35E9</div><div><a href="#4040" class="memory-link">JP NC,4040H</a></div><div>If Bit 6 (which is now in the carry) is low then JUMP to 4040H.<br><b>NOTE:</b>
 4209H is Interrupt Vector 6 and contains a JUMP to 4040H which, in at 
least in TRSDOS, is just a JUMP to 35FAH which is a RETurn.</div></div>
									<div class="assembly-row-combined both"><div>35EC</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 7 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>35ED</div><div><a href="#4043" class="memory-link">JP NC,4043H</a></div><div>If Bit 7 (which is now in the carry) is low then JUMP to 4043H.<br><b>NOTE:</b>
 4043H is Interrupt Vector 7 and contains a JUMP to 4043H which, in at 
least in TRSDOS, is just a JUMP to 35FAH which is a RETurn.</div></div>
									<div class="assembly-row-combined both"><div>35F0</div><div>POP HL</div><div>Restore all registers.</div></div>
									<div class="assembly-row-combined both"><div>35F1</div><div>POP IY</div></div>
									<div class="assembly-row-combined both"><div>35F3</div><div>POP IX</div></div>
									<div class="assembly-row-combined both"><div>35F5</div><div>POP HL</div></div>
									<div class="assembly-row-combined both"><div>35F6</div><div>POP DE</div></div>
									<div class="assembly-row-combined both"><div>35F7</div><div>POP BC</div></div>
									<div class="assembly-row-combined both"><div>35F8</div><div>POP AF</div></div>
									<div class="assembly-row-combined both"><div>35F9</div><div>EI</div><div>Enable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>35FA</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="35FB">35FBH - RS-232 Initialization Routine.  I'm [guessing] that IX is set to 41F5H<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>35FB</div><div>DI</div><div>Disable Interrupts so they don't interrupt this routine.</div></div>
									<div class="assembly-row-combined both"><div>35FC</div><div>IN A,(EAH)</div><div>Poll Port EAH into A.<br><b>NOTE:</b> Port EAH is the RS-232 UART Control Register/Status Register.  Input:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Parity error (1=True)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Framing Error (1=True)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Overrun (1=True)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Data Sent (1=True)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Data Ready (1=True)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>35FE</div><div>CP FFH</div><div>Compare A with FFH to see if the RS-232 exists.</div></div>
									<div class="assembly-row-combined both"><div>3600</div><div><a href="#363A" class="memory-link">JR Z,363AH</a></div><div>If the RS-232 does NOT exist, JUMP down to 363AH.</div></div>
									<div class="assembly-row-combined both"><div>3602</div><div>XOR A</div><div>Flip the RS-232 Port Results, just to get a non-zero result.</div></div>
									<div class="assembly-row-combined both"><div>3603</div><div>OUT (0E8H),A</div><div>Output A to port E8H.<br><b>NOTE:</b> Port E8H is the RS-232 Status Register &amp; Master Reset.  Outputting ANYTHING to Port E8H resets the RS-232.</div></div>
									<div class="assembly-row-combined both"><div>3605</div><div>LD A,(IX+03H)</div><div>Load the BAUD RATE CODE into A.<br><b>NOTE:</b> 41F8H holds the baud rate code.</div></div>
									<div class="assembly-row-combined both"><div>3608</div><div>OUT (0E9H),A</div><div>Output A to Port E9H.<br><b>NOTE:</b> Port E9H is the RS-232 Baud Rate Selects and Sense Switches.  Outputting to Port E9H will set the Baud Rate as follows:<ul><li>Bits 0-3 - Select the Receive Rate</li><li>Bits 4-7 - Select the Transmit Rate</li></ul></div></div>
									<div class="assembly-row-combined both"><div>360A</div><div>LD A,(IX+04H)</div><div>Load the CONFIURATION CODE into A.<br><b>NOTE:</b> 41F9 holds the RS-232 Configuration Code.</div></div>
									<div class="assembly-row-combined both"><div>360D</div><div>OR A</div><div>Set the flags.</div></div>
									<div class="assembly-row-combined both"><div>360E</div><div><a href="#363A" class="memory-link">JR Z,363AH</a></div><div>If the CONFIGURATION CODE in A is 0, then JUMP down to 363AH.</div></div>
									<div class="assembly-row-combined both"><div>3610</div><div>OUT (0EAH),A</div><div>Output the CONFIGURATION CODE to Port EAH.<br><b>NOTE:</b> Port EAH is the RS-232 UART Control Register/Status Register.  For output:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Control Bit</td><td class="31c0-first"></td><td>Control Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="0"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Data Terminal Ready</td></tr>
    <tr data-set-bit="1"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Request to End</td></tr>
    <tr data-set-bit="2"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Break</td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Parity Enable</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Stop Bits</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Select</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Word Length</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Parity (0=Odd, 1=Even)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>3612</div><div>LD IY,41E5H</div><div>Load IY with 41E5H.<br><b>NOTE:</b> 41E5H Is the RS-232 Input DCB.  1=READ ONLY.</div></div>
									<div class="assembly-row-combined both"><div>3616</div><div><a href="#3644" class="memory-link">CALL 3644H</a></div><div>GOSUB to 3644H [to CLEAR OPTIONS].</div></div>
									<div class="assembly-row-combined both"><div>3619</div><div>LD A,(IX+05H)</div><div>Load the WAIT SWITCH into A.<br><b>NOTE:</b> 41FAH holds the RS-232 Wait Switch.</div></div>
									<div class="assembly-row-combined both"><div>361C</div><div>OR A</div><div>Set the flags.</div></div>
									<div class="assembly-row-combined both"><div>361D</div><div><a href="#3623" class="memory-link">JR Z,3623H</a></div><div>If the WAIT SWITCH was ZERO, skip the next instruction and pick up at 3623H.</div></div>
									<div class="assembly-row-combined both"><div>361F</div><div>SET 01H,(IY+04H)</div><div>If we are here, the WAIT SWITCH was NOT zero, so SET BIT 1 of (41E9H) to SET the WAIT FLAG.<br><b>NOTE:</b> 41E9H is the RS-232 Input DCB:<ul><li>Bit 2: Driver On/Off</li><li>Bit 1: Wait/No Wait</li></ul></div></div>
									<div class="assembly-row-combined both"><div>3623</div><div>SET 02H,(IY+04H)</div><div>and SET BIT 2 of (41E9H) to SET the ACTIVE FLAG.<br><b>NOTE:</b> 41E9H is the RS-232 Input DCB:<ul><li>Bit 2: Driver On/Off</li><li>Bit 1: Wait/No Wait</li></ul></div></div>
									<div class="assembly-row-combined both"><div>3627</div><div>LD IY,41EDH</div><div>Load IY with 41EDH.<br><b>NOTE:</b> 41EDH is the RS-232 Output DCB.  Type = 2 = Write Only.</div></div>
									<div class="assembly-row-combined both"><div>362B</div><div>OR A</div><div>Set flags.</div></div>
									<div class="assembly-row-combined both"><div>362C</div><div><a href="#3632" class="memory-link">JR Z,3632H</a></div><div>If the ZERO flag is set, we have NO WAIT, so JUMP to 3632H.</div></div>
									<div class="assembly-row-combined both"><div>362E</div><div>SET 01H,(IY+04H)</div><div>Set Bit 1 of 41F1H to set the WAIT FLAG.<br><b>NOTE:</b> 41F1H is part of the RS-232 Output DCB:<ul><li>Bit 2: Driver ON/OFF</li><li>Bit 1: Wait/No Wait</li></ul></div></div>
									<div class="assembly-row-combined both"><div>3632</div><div>SET 02H,(IY+04H)</div><div>Set Bit 2 of 41F1H to set the ACTIVE FLAG.</div></div>
									<div class="assembly-row-combined both"><div>3636</div><div>IN A,(E8H)</div><div>Poll Port E8H and put the result into A.<br><b>NOTE:</b> Port E8H is the RS-232 Status Register &amp; Master Reset.  Input:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Modem Status Bit</td><td class="31c0-first"></td><td>Modem Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Ring Indicator</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Carrier Detect</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Data Set Ready</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Clear to Send</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>3638</div><div>EI</div><div>Re-Enable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>3639</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="363A">363A - This will zero out a bunch of RS-232 
Related Ports and Memory Addresses.  We wind up here if there is no 
RS-232 or the RS-232 CONFIGURATION CODE is 0.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>363A</div><div>XOR A</div><div>Clear A and all flags.</div></div>
									<div class="assembly-row-combined both"><div>363B</div><div>LD B,04H</div><div>Load B with 4 as a counter.  4 is because there are 4 ports - E8H-EBH:<ul><li>Port E8H:  RS-232 Status Register &amp; Master Reset</li><li>Port E9H:  RS-232 Baud Rate Select and Sense Switches</li><li>Port EAH:  RS-232 UART Control Register and Status Register</li><li>Port EBH:  RS-232 Data Register</li></ul></div></div>
									<div class="assembly-row-combined both"><div>363D</div><div>LD C,0E8H</div><div>Load C with E8H.</div></div>
									<div class="assembly-row-combined both" id="363F"><div>363F</div><div>OUT (C),A</div><div>Send a 0 to the current port.  On the first iteration, this is E8H (the RS-232 Status Register &amp; Master Reset).</div></div>
									<div class="assembly-row-combined both"><div>3641</div><div>INC C</div><div>BUMP C to the next port.</div></div>
									<div class="assembly-row-combined both"><div>3642</div><div><a href="#363F" class="memory-link">DJNZ 363FH</a></div><div>Jump back to 363FH until all 4 ports have been reset.</div></div>
									<div class="assembly-row-combined both" id="3644"><div>3644</div><div>LD HL,41E8H</div><div>Load HL with 41E8H.<br><b>NOTE:</b> 41E8 is the Input Buffer of the RS-232 Input DCB.</div></div>
									<div class="assembly-row-combined both"><div>3647</div><div>LD B,03H</div><div>Load B with 3 as a counter.  3 is for 3 bytes - 41E8H, 41E9H, and 41EAH.</div></div>
									<div class="assembly-row-combined both" id="3649"><div>3649</div><div>LD (HL),00H</div><div>Load (HL) with 00H.</div></div>
									<div class="assembly-row-combined both"><div>364B</div><div>INC HL</div><div>Bump HL.</div></div>
									<div class="assembly-row-combined both"><div>364C</div><div><a href="#3649" class="memory-link">DJNZ 3649H</a></div><div>Loop back to 3649H until 3 bytes have been zeroed.</div></div>
									<div class="assembly-row-combined both"><div>364E</div><div>LD HL,41F0H</div><div>Load HL with 41F0H.<br><b>NOTE:</b> 41F0H is the 1 characer output buffer for the RS-232 Output DCB.</div></div>
									<div class="assembly-row-combined both"><div>3651</div><div>LD B,03H</div><div>Load B with 3 as a counter.  3 is for 3 bytes - 41F0H, 41F1H, and 41F2H.</div></div>
									<div class="assembly-row-combined both" id="3653"><div>3653</div><div>LD (HL),00H</div><div>Load (HL) with 00H.</div></div>
									<div class="assembly-row-combined both"><div>3655</div><div>INC HL</div><div>Bump HL.</div></div>
									<div class="assembly-row-combined both"><div>3656</div><div><a href="#3653" class="memory-link">DJNZ 3653H</a></div><div>Loop back to 3653H until 3 bytes have been zeroed.</div></div>
									<div class="assembly-row-combined both"><div>3658</div><div><a href="#3636" class="memory-link">JR 3636H</a></div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="365A">365AH - RS-232 Input Routine.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>365A</div><div>LD IX,41E5H</div><div>Load IX with 41E5H.<br><b>NOTE:</b> 41E5H is the DCB for RS-232 Input.  41E8H is the 1 Character RS-232 Input.</div></div>
									<div class="assembly-row-combined both"><div>365E</div><div>XOR A</div><div>Clear A and all Flags.</div></div>
									<div class="assembly-row-combined both"><div>365F</div><div>LD (IX+03H),A</div><div>Load (41E8H) with a Zero.<br><b>NOTE:</b> 41E8H is the 1 Character RS-232 Input.</div></div>
									<div class="assembly-row-combined both"><div>3662</div><div>BIT 2,(IX+04H)</div><div>Test Bit 2 of 41E9H to see if the RS-232 is active.<br><b>NOTE:</b> Bit 2 of 41E9 contains the DRIVER ON/OFF.</div></div>
									<div class="assembly-row-combined both"><div>3666</div><div>RET Z</div><div>If the Driver is OFF, RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3667</div><div>IN A,(EAH)</div><div>If the Driver is ON, Poll Port EAH into A.<br><b>NOTE:</b> Port EAH is the RS-232 UART Control Register/Status Register.  Input:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Parity error (1=True)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Framing Error (1=True)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Overrun (1=True)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Data Sent (1=True)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Data Ready (1=True)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>3669</div><div>BIT 7,A</div><div>Test Bit 7 of A.<br><b>NOTE:</b> Bit 7 will be 1 if DATA READY (1=True).</div></div>
									<div class="assembly-row-combined both"><div>366B</div><div><a href="#367A" class="memory-link">JR NZ,367AH</a></div><div>If NOT ZERO, then DATA is READY, so JUMP out of this loop to 367AH.</div></div>
									<div class="assembly-row-combined both"><div>366D</div><div>BIT 1,(IX+04H)</div><div>Test Bit 1 of 41E9H.<br><b>NOTE:</b> Bit 1 of 41E9 contains the WAIT/NO WAIT of the RS-232 Input DCB.</div></div>
									<div class="assembly-row-combined both"><div>3671</div><div>RET Z</div><div>If its NO WAIT then RETURN, otherwise continue (to keep polling).</div></div>
									<div class="assembly-row-combined both"><div>3672</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#028D" class="memory-link">CALL 028DH</a></div><div>GOSUB to 028DH to check for a <kbd>BREAK</kbd> key.</div></div>
									<div class="assembly-row-combined both"><div>3675</div><div><a href="#3667" class="memory-link">JR Z,3667H</a></div><div>JUMP to 3667H to poll again if there was NO <kbd>BREAK</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>3677</div><div><a href="#4203" class="memory-link">JP 4203H</a></div><div>JUMP to 4203H if the <kbd>BREAK</kbd> key was pressed.<br><b>NOTE:</b> 4203H JUMPS to 022EH and is the break vector for tape and RS-232.</div></div>
									<div class="assembly-row-combined both" id="367A"><div>367A</div><div>IN A,(EBH)</div><div>Poll Port EBH to A.<br><b>NOTE:</b> Port EBH is the RS-232C Data Register.  It contains the data received from the RS-232C.</div></div>
									<div class="assembly-row-combined both"><div>367C</div><div>LD (IX+03H),A</div><div>Load (41E8H) with a A (the data from Port EBH).<br><b>NOTE:</b> 41E8H is the 1 Character RS-232 Input.</div></div>
									<div class="assembly-row-combined both"><div>367F</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>

							<br><h2 id="3680">3680H - RS-232 Output Routine.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3680</div><div>LD IX,41EDH</div><div>Note.  41EDH is the RS-232 Output DCB, and 41F1H holds DRIVER ON/OFF in BIT 2, and WAIT/NO WAIT in BIT 1.</div></div>
									<div class="assembly-row-combined both"><div>3684</div><div>BIT 2,(IX+04H)</div><div>Test Bit 2 of 41F1H to see if the RS-232 is active.</div></div>
									<div class="assembly-row-combined both"><div>3688</div><div>RET Z</div><div>If the RS-232 is NOT active, RETURN.</div></div>
									<div class="assembly-row-combined both" id="3689"><div>3689</div><div>IN A,(EAH)</div><div>If the RS-232 IS active, then Poll Port EAH into A.<br><b>NOTE:</b> Port EAH is the RS-232 UART Control Register/Status Register.  Input:
<table class="bit-table-breakdown">
    <tbody><tr class="header"><td colspan="8">Status Bit</td><td class="31c0-first"></td><td>Status Description</td></tr>
    <tr class="header"><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td class="spacer"></td><td></td></tr>
    <tr data-set-bit="3"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Parity error (1=True)</td></tr>
    <tr data-set-bit="4"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Framing Error (1=True)</td></tr>
    <tr data-set-bit="5"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Overrun (1=True)</td></tr>
    <tr data-set-bit="6"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer"></td><td>Data Sent (1=True)</td></tr>
    <tr data-set-bit="7"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="spacer-last"></td><td>Data Ready (1=True)</td></tr>
</tbody></table></div></div>
									<div class="assembly-row-combined both"><div>368B</div><div>BIT 6,A</div><div>Test Bit 6 of Port EAH to see READY TO SEND.</div></div>
									<div class="assembly-row-combined both"><div>368D</div><div><a href="#369C" class="memory-link">JR NZ,369CH</a></div><div>If READY TO SEND then skip forward to 369CH.</div></div>
									<div class="assembly-row-combined both"><div>368F</div><div>BIT 1,(IX+04H)</div><div>Test Bit 1 of 41F1H to see if the RS-232 is active.<br><b>NOTE:</b> 41F1H Hholds DRIVER ON/OFF in BIT 2, and WAIT/NO WAIT in BIT 1.</div></div>
									<div class="assembly-row-combined both"><div>3693</div><div>RET Z</div><div>If RS-232 is NOT active, RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3694</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#028D" class="memory-link">CALL 028DH</a></div><div>GOSUB to 028DH to check for a <kbd>BREAK</kbd> key.</div></div>
									<div class="assembly-row-combined both"><div>3697</div><div><a href="#3689" class="memory-link">JR Z,3689H</a></div><div>JUMP to 3689H to poll again if there was NO <kbd>BREAK</kbd>.</div></div>
									<div class="assembly-row-combined both"><div>3699</div><div><a href="#4203" class="memory-link">JP 4203H</a></div><div>JUMP to 4203H if the <kbd>BREAK</kbd> key was pressed.<br><b>NOTE:</b> 4203H JUMPS to 022EH and is the break vector for tape and RS-232.</div></div>
									<div class="assembly-row-combined both"><div>369C</div><div>LD A,(IX+03H)</div><div>Load A with the memory contents of 41F0H.<br><b>NOTE:</b> 41F0H is RS-232 output buffer byte.</div></div>
									<div class="assembly-row-combined both"><div>369F</div><div>OR A</div><div>Test A and Set Flags.</div></div>
									<div class="assembly-row-combined both"><div>36A0</div><div><a href="#36A3" class="memory-link">JR NZ,36A3H</a></div><div>If not zero, then there is a character in the buffer, so skip the next instruction and leave that byte in A.</div></div>
									<div class="assembly-row-combined both"><div>36A2</div><div>LD A,C</div><div>Load A with C [GET CHAR FROM DISPATCHER].</div></div>
									<div class="assembly-row-combined both"><div>36A3</div><div>OUT (0EBH),A</div><div>Send A out of Port EBH.<br><b>NOTE:</b> Port EBH is the RS-232C Data Register.  It contains the data to be sent to the RS-232C.</div></div>
									<div class="assembly-row-combined both"><div>36A5</div><div>LD (IX+03H),00H</div><div>Load memory contents of the RS-232 output byte (at 41F0H) with a 0.</div></div>
									<div class="assembly-row-combined both"><div>36A9</div><div>RET</div><div>RETURN.</div></div>
								</div>
							</div>



<h2 id="36AAH">36AAH - Jump Vector Table and Data Area<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
<div class="card-item">
    <div class="assembly-table">
<div class="assembly-row-combined"><div>36D6</div><div>LD D,D <span class="opcode2">52</span></div><div><b>[DATA]</b> Byte: 52H (ASCII <kbd>R</kbd>).</div></div>
<div class="assembly-row-combined" id="36D7H"><div>36D7</div><div><a href="#5000H" class="memory-link">JP 5000H <span class="opcode2">C3 00 50</span></a></div><div>JUMP to 5000H in RAM.</div></div>
<div class="assembly-row-combined" id="36DAH"><div>36DA</div><div>RST 00H <span class="opcode2">C7</span></div><div>Restart at address 0000H (system reset).</div></div>
<div class="assembly-row-combined"><div>36DB</div><div>NOP <span class="opcode2">00</span></div><div>No operation (padding byte).</div></div>
<div class="assembly-row-combined"><div>36DC</div><div>NOP <span class="opcode2">00</span></div><div>No operation (padding byte).</div></div>
<div class="assembly-row-combined" id="36DDH"><div>36DD</div><div>XOR A <span class="opcode2">AF</span></div><div>Set Register A to <b>zero</b> and clear all flags.</div></div>
<div class="assembly-row-combined"><div>36DE</div><div>RET <span class="opcode2">C9</span></div><div>Return to caller with A=0.</div></div>
    </div>
</div>




							<br><h2 id="36AA">36AAH - Initial Vectors and DCBs for RAM 4000H-404BH.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<p class="debug-note">This area contains a series of jump 
vectors that redirect execution to various ROM and DOS routines, 
followed by data bytes and additional code.</p>
									<div class="assembly-row-combined" id="36AAH"><div>36AA<br>4000H</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m1-part-2.htm#1C96H" class="memory-link">JP 1C96H <span class="opcode2">C3 96 1C</span></a></div><div>RST 00H - JUMP to SYNCHR routine at 1C96H.</div></div>
									<div class="assembly-row-combined" id="36ADH"><div>36AD<br>4003H</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m1-part-2.htm#1D78H" class="memory-link">JP 1D78H <span class="opcode2">C3 78 1D</span></a></div><div>RST 10H - JUMP to the CHRGTR routine at 1D78H.</div></div>
									<div class="assembly-row-combined" id="36B0H"><div>36B0<br>4006H</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m1-part-2.htm#1C90H" class="memory-link">JP 1C90H <span class="opcode2">C3 90 1C</span></a></div><div>RST 18H - JUMP to the DCOMPR routine at 1C90H.</div></div>
									<div class="assembly-row-combined" id="36B3H"><div>36B3<br>4009H</div><div><a href="#25D9H" class="memory-link">JP 25D9H <span class="opcode2">C3 D9 25</span></a></div><div>RST 20H - JUMP to the GETYPR routine at 25D9H.</div></div>
									<div class="assembly-row-combined" id="36B6H"><div>36B6<br>400CH</div><div>RET <span class="opcode2">C9</span></div><div>RST 28H vector would go here.  For ROM it is simply set as a RET.</div></div>
									<div class="assembly-row-combined"><div>36B7<br>400DH</div><div>NOP <span class="opcode2">00</span></div><div>No operation (padding byte).</div></div>
									<div class="assembly-row-combined"><div>36B8<br>400EH</div><div>NOP <span class="opcode2">00</span></div><div>No operation (padding byte).</div></div>
									<div class="assembly-row-combined" id="36B9H"><div>36B9<br>400FH</div><div>RET <span class="opcode2">C9</span></div><div>RST 30H vector would go here.  For ROM it is simply set as a RET.</div></div>
									<div class="assembly-row-combined"><div>36BA<br>4010H</div><div>NOP <span class="opcode2">00</span></div><div>No operation (padding byte).</div></div>
									<div class="assembly-row-combined"><div>36BB<br>4011H</div><div>NOP <span class="opcode2">00</span></div><div>No operation (padding byte).</div></div>
									<div class="assembly-row-combined" id="36BCH"><div>36BC<br>4012H</div><div><a href="#3018H" class="memory-link">JP 3018H <span class="opcode2">C3 18 30</span></a></div><div>RST 38H - JUMP to routine at 3018H.</div></div>
									<p class="debug-note">This area contains the Default Device Control Block.  First is the KEYBOARD.</p>
									<div class="assembly-row-combined" id="36BFH"><div>36BF<br>4015H</div><div>01H</div><div>Device Recognition Code - Keyboard is 01.</div></div>
									<div class="assembly-row-combined" id="36BFH"><div>36C0-36C1<br>4016H</div><div>nnH nnH</div><div>Keyboard Driver Routine (via a table jump).</div></div>
									<div class="assembly-row-combined"><div>36C2<br>4018H</div><div>00H</div><div>Status of RIGHT SHIFT key.</div></div>
									<div class="assembly-row-combined"><div>36C3<br>4019H</div><div>01H</div><div>Status of CAPS LOCK.</div></div>
									<div class="assembly-row-combined"><div>36C4<br>401AH</div><div>07H</div><div>Interrupt Counter to Flash Cursor. Counts to 7.</div></div>
									<div class="assembly-row-combined"><div>36C5<br>401BH</div><div>00H</div><div>Flag byte for cursor change.</div></div>
									<div class="assembly-row-combined"><div>36C6<br>401CH</div><div>00H</div><div>Cursor Blink Flag. 0=BLINK.</div></div>
									<p class="debug-note">Video Device Control Block.</p>
									<div class="assembly-row-combined"><div>36C7<br>401DH</div><div>07</div><div>Device Recognition Code - Video is 07.</div></div>
									<div class="assembly-row-combined"><div>36C8-36C9<br>401EH</div><div>nnH nnH</div><div>Video Driver Routine (via a table jump).</div></div>
									<div class="assembly-row-combined"><div>36CA-36CB<br>4020H</div><div>nnH nnH</div><div>Cursor Position (3C00H to 3FFFH).</div></div>
									<div class="assembly-row-combined"><div>36CC<br>4022H</div><div>00</div><div>Character "covered" on video by Cursor</div></div>
									<div class="assembly-row-combined"><div>36CD<br>4023H</div><div>B0</div><div>Cursor Character 32-255. Default is 176.</div></div>
									<div class="assembly-row-combined"><div>36CE<br>4024H</div><div>00</div><div>Char set active: 0=regular 1=alternate</div></div>
									<p class="debug-note">Printer Device Control Block.</p>
									<div class="assembly-row-combined" id="36BFH"><div>36CF<br>4025H</div><div>06H</div><div>Device Recognition Code - Printer is 06.</div></div>
									<div class="assembly-row-combined" id="36BFH"><div>36D0-36D1<br>4026H</div><div>nnH nnH</div><div>Printer Driver Routine (via a table jump).</div></div>
									<div class="assembly-row-combined"><div>36D2<br>4028H</div><div>67</div><div>Lines per page.</div></div>
									<div class="assembly-row-combined"><div>36D3<br>4029H</div><div>01H</div><div>Current Line Number.</div></div>
									<div class="assembly-row-combined"><div>36D4<br>402AH</div><div>00H</div><div>Number of chars printed on current line.</div></div>
									<div class="assembly-row-combined"><div>36D5<br>402BH</div><div>FFH</div><div>Maximum line length.</div></div>
									<div class="assembly-row-combined"><div>36D6<br>402CH</div><div>52H</div><div>Default for maximum line length.</div></div>
									<p class="debug-note">Normal Disk Operating System re-entry vector.</p>
									<div class="assembly-row-combined"><div>36D7-36D9<br>402DH-402FH</div><div>JP 5000H</div><div>Make a SYS1/SYS DOS Request.</div></div>
									<p class="debug-note">Abnormal Disk Operating System re-entry vector.</p>
									<div class="assembly-row-combined"><div>36DA<br>4030H</div><div>RST 00H</div><div>DOS Request Code for SYS1/SYS.</div></div>
									<div class="assembly-row-combined"><div>36DB-36DC<br>4031H-4032H</div><div>NOP</div><div>Usually a LD A,A3 followed by a RST 28H.</div></div>
									<p class="debug-note">Disk Operating System Vectoring Routine - Call DOS Device Driver.</p>
									<div class="assembly-row-combined"><div>36DD<br>4033H</div><div>XOR A</div><div>Set A to Zero and Reset all Flags.</div></div>
									<div class="assembly-row-combined"><div>36DE<br>4034H</div><div>RET</div><div>RETurn to caller.</div></div>
									<div class="assembly-row-combined"><div>36DF<br>4035H</div><div>NOP</div><div>No Operation.</div></div>
									<p class="debug-note">Keyboard Bit Image (7 Byte Buffer). Work area for KB input routine.</p>
									<div class="assembly-row-combined"><div>36E0-36E6H<br>4036H-403CH</div><div>AAH AAH AAH AAH AAH AAH AAH</div><div>These
 seven bytes are moved to reserved RAM locations 4036H - 403CH during 
power up. These locations are used by the keyboard scan routine to store
 an "image" of the first seven rows of the keyboard matrix. They are all
 initialized to contain AAH bytes in the Model III (for some unknown 
reason), but in the Model 4 they are correctly initialized with zero 
bytes.</div></div>
									<p class="debug-note">Interrupt Vectors.</p>
									<div class="assembly-row-combined"><div>36E7-36E9H<br>403DH-403FH</div><div>JP 35FAH</div><div>Interrupt Vector 3</div></div>
									<div class="assembly-row-combined"><div>36EA-36ECH<br>4040H-4042H</div><div>JP 35FAH</div><div>Interrupt Vector 6</div></div>
									<div class="assembly-row-combined"><div>36ED-36EFH<br>4043H-4045H</div><div>JP 35FAH</div><div>Interrupt Vector 7</div></div>
									<div class="assembly-row-combined"><div>36F0-36F2H<br>4046H-4048H</div><div>JP 35FAH</div><div>Interrupt Vector 2</div></div>
									<div class="assembly-row-combined"><div>36F3<br>4049H</div><div>RST 0</div><div>RST 0 NMI Vector</div></div>
									<div class="assembly-row-combined"><div>36F4<br>404AH</div><div>NOP</div><div>No Operation</div></div>
								</div>
							</div>

							<br><h2 id="36F5">36F5H - UNUSED.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>36F5-36F8</div><div>&nbsp;</div><div>00 00 00 00</div></div>
								</div>
							</div>

							<br><h2 id="36F9">36F9H - Initial Vectors and DCBs for the SERIAL Interface - 41E5H-4224H.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>36F9-3700<br>41E5-41EC</div><div>01 1E 30 00 00 00 52 49</div><div>Serial
 Input DCB.  Two bytes that are moved to RS-232 Input Device Control 
Block (locations 41EBH &amp; 41ECH) during power up. These bytes 
formerly contained the ASCII characters "RI" (designator for "RS-232 
input"), but now contain the ASCII character codes that will be returned
 when the <kbd>F1</kbd> or <kbd>F2</kbd> keys are pressed. 36FFH contains 60H (a <kbd>SHIFT</kbd> + <kbd>@</kbd> character), which will be loaded into 41EBH as the character returned when the <kbd>F1</kbd>
 key is pressed, while 3700H contains lBH (a shift-up arrow character), 
which will be loaded into 41ECH as the character returned when the <kbd>F2</kbd> key is pressed.</div></div>
									<div class="assembly-row-combined both"><div>3701-3708<br>41ED-41F4</div><div>02 21 30 00 00 00 52 4F</div><div>Serial
 Output DCB.  Two bytes that are moved to RS-232 Output Device Control 
Block (locations 41F3H and 41F4H) during power up. These bytes formerly 
contained the ASCII characters "RO" (designator for "RS-232 Output"), 
but now contain the ASCII character code that will be returned when the <kbd>F3</kbd> key is pressed and the "image" for the eighth keyboard row (the row mapped to 3880H). 3707H contains 08H (a <kbd>SHIFT</kbd> + <kbd>@</kbd>
 character), which will be loaded into 41F3H as the character returned 
when the "F3" key is pressed, while 3708H contains a zero byte, which 
will be loaded into 41F4H to initialize the storage location used to 
store the "image" (current status) of the CAPS, CTRL, and function keys 
(F1, F2, and F3).</div></div>
									<div class="assembly-row-combined both"><div>3709-3710<br>41F5-41FC</div><div>02 1B 30 55 6C FF 52 4E</div><div>Serial
 Init DCB.  Two bytes that are moved to RS-232 Initialization Device 
Control Block (locations 41FBH and 41FCH) during power up. These bytes 
formerly contained the ASCII characters "RN" (designator for "RS-232 
iNitialization"), but now contain two zero (00H) bytes.</div></div>
									<div class="assembly-row-combined both"><div>3711<br>41FD</div><div>00</div><div>Repeating Key LSB of keyboard buffer pointer.</div></div>
									<div class="assembly-row-combined both"><div>3712<br>41FE</div><div>00</div><div>Repeating Key Contents of current keyboard "row".</div></div>
									<div class="assembly-row-combined both"><div>3713-3714<br>41FF-4200</div><div>FF FF</div><div>Max repeat delay count</div></div>
									<div class="assembly-row-combined both"><div>3715-3716<br>4201-4202</div><div>FF FF</div><div>Current repeat delay count</div></div>
									<div class="assembly-row-combined both"><div>3717-3719<br>4203-4205</div><div>JP nnnn</div><div>Vector Break Key   - 3 byte Instruction</div></div>
									<div class="assembly-row-combined both"><div>371A-371C<br>4206-4208</div><div>JP nnnn</div><div>Vector Interrupt 4 - 3 byte instruction</div></div>
									<div class="assembly-row-combined both"><div>371D-371F<br>4209-420B</div><div>JP nnnn</div><div>Vector Interrupt 5 - 3 byte instruction</div></div>
									<div class="assembly-row-combined both"><div>3720-3721<br>420C-420D</div><div>nnH nnH</div><div>2 byte Vector for Tape WRITE 1500/500</div></div>
									<div class="assembly-row-combined both"><div>3722-3723<br>420E-420F</div><div>nnH nnH</div><div>2 byte Vector for Tape READ 1500/500</div></div>
									<div class="assembly-row-combined both"><div>3724<br>4210</div><div>nnH nnH</div><div>Shadow of General Values Port EC</div></div>
									<div class="assembly-row-combined both"><div>3725<br>4211</div><div>03H</div><div>Cass Baud Rate Select (0 = 500 baud, Not 0 = 1500 baud)</div></div>
									<div class="assembly-row-combined both"><div>3726<br>4212</div><div>3CH</div><div>Cass Blinker Counter</div></div>
									<div class="assembly-row-combined both"><div>3727<br>4213</div><div>04H</div><div>Cass Default Interrupt Vector Setting</div></div>
									<div class="assembly-row-combined both"><div>3728<br>4214</div><div>00H</div><div>Video scroll protect: #Lines To Protect (0-7).</div></div>
									<div class="assembly-row-combined both"><div>3729<br>4215</div><div>00H</div><div>Unused</div></div>
									<div class="assembly-row-combined both"><div>372A<br>4216</div><div>nnH</div><div>Clock Data: Heartbeat Counter (defined by Clock Freq)</div></div>
									<div class="assembly-row-combined both"><div>372B-3730<br>4217-421C</div><div>00 00 00 00 00 00</div><div>Clock Data: SS:MM:HH YY/DD/MM</div></div>
									<div class="assembly-row-combined both"><div>3731<br>421D</div><div>02H</div><div>I/O Router DCB: Type = 2 = Write Only</div></div>
									<div class="assembly-row-combined both"><div>3732-3733<br>421E-421F</div><div>nnH nnH</div><div>I/O Router DCB: Driver Address</div></div>
									<div class="assembly-row-combined both"><div>3734-3735<br>4220-4221</div><div>00H 00H</div><div>I/O Router DCB: Destination Device Name.</div></div>
									<div class="assembly-row-combined both"><div>3736-3737<br>4222-4223</div><div>00H 00H</div><div>I/O Router DCB: Source Device Name. 2 Bytes..</div></div>
									<div class="assembly-row-combined both"><div>3738<br>4224</div><div>00H 00H</div><div>Control key flag used by keyboard driver routine.</div></div>
								</div>
							</div>

							<br><h2 id="3739">3739H - I/O Re-Router.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<p>On the Model III, the area of memory from 3739H-37E7H 
contains the I/O re-router routine (3739H-377AH), a patch to the LIST 
command routine (377BH-3798H), the TIME$ function routine (3799H-37AEH),
 a portion of the non-disk bootstrap routine that prompted the user to 
s:et the cassette baud rate (37AFH 37B4H), the $SETCAS routine 
(37B5H-37DBH), another portion of the non-disk bootstrap routine, which 
put the address of the TIME$ routine into the vector at 4177H 
(37DCH-37E4H), and three unused AAH bytes (37E5H-37E7H). In the Model 4,
 this area contains a good portion of the keyboard scan routine 
(3739H-37A3H), a patch to the LIST command routine (37A4H-37ClH), the 
TIME$ function routine (37C2H-37D7H), more of the keyboard scan routine 
(37D8H-37EOH), a short time-delay routine used by the disk bootstrap 
routine (37ElH-37E4H), and three unused zero bytes (37E5H-37E7H).</p>
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3739</div><div>LD A,(IX+03H)</div><div>Load A with the character at (IX+3) which is the first character of the destination.</div></div>
									<div class="assembly-row-combined both"><div>373C</div><div>CP 52H</div><div>Check to see if that characer is a "R".</div></div>
									<div class="assembly-row-combined both"><div>373E</div><div><a href="#3743" class="memory-link">JR NZ,3743H</a></div><div>If it is not an "R" then skip the next instruction and JUMP to 3743H.</div></div>
									<div class="assembly-row-combined both"><div>3740</div><div>LD A,(IX+04H)</div><div>Load A with the character at (IX+4) which is the second character of the destination.</div></div>
									<div class="assembly-row-combined both" id="3743"><div>3743</div><div><a href="#375E" class="memory-link">CALL 375EH</a></div><div>GOSUB to 375EH to get the applicable DCB Address from the DCB Table.</div></div>
									<div class="assembly-row-combined both"><div>3746</div><div>RET NZ</div><div>If the DCB Address was not found, then RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3747</div><div>PUSH HL</div><div>Store HL onto the STACK.</div></div>
									<div class="assembly-row-combined both"><div>3748</div><div>LD A,(IX+05H)</div><div>Load A with the characer at (IX+5) which is the first character of the source.</div></div>
									<div class="assembly-row-combined both"><div>374B</div><div>CP 52H</div><div>Check to see if that characer is a "R".</div></div>
									<div class="assembly-row-combined both"><div>374D</div><div><a href="#3752" class="memory-link">JR NZ,3752H</a></div><div>If it is not an "R" then skip the next instruction and JUMP to 3752H.</div></div>
									<div class="assembly-row-combined both"><div>374F</div><div>LD A,(IX+06H)</div><div>Load A with the character at (IX+6) which is the second character of the source.</div></div>
									<div class="assembly-row-combined both"><div>3752</div><div><a href="#375E" class="memory-link">CALL 375EH</a></div><div>GOSUB to 375EH to get the applicable DCB Address from the DCB Table.</div></div>
									<div class="assembly-row-combined both"><div>3755</div><div>EX DE,HL</div><div>Swap the SOURCE DCB and the DESTINATION DCB.</div></div>
									<div class="assembly-row-combined both"><div>3756</div><div>POP HL</div><div>Restore HL from the Stack.</div></div>
									<div class="assembly-row-combined both"><div>3757</div><div>RET NZ</div><div>If the DCB Address was not found, then RETURN.</div></div>
									<div class="assembly-row-combined both"><div>3758</div><div>LD BC,0003H</div><div>If the DCB Address was found, we need to move 3 bytes, so set up BC with a 3.</div></div>
									<div class="assembly-row-combined both"><div>375B</div><div>LDIR</div><div>Move the 3 bytes from (HL) to (DE).</div></div>
									<div class="assembly-row-combined both"><div>375D</div><div>RET</div><div>Return.</div></div>
								</div>
							</div>

							<br><h2 id="375E">375EH - Look Up DCB Address.  On SUCCESSFUL exit, HL will have the DCB address.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>375E</div><div>LD HL,376CH</div><div>Load HL with 376CH (which is a table of K, D, P, I, and O).</div></div>
									<div class="assembly-row-combined both"><div>3761</div><div>LD BC,000FH</div><div>Load BC with 0FH (Decimal: 15), as the table is 15 bytes long.</div></div>
									<div class="assembly-row-combined both"><div>3764</div><div>CPIR</div><div>Search for the character on the table.<br><b>NOTE:</b> CPIR will check (HL) vs A.  HL is then increased, and BC decreased.  If BC is still not zero, and Z is not set, it repeats.</div></div>
									<div class="assembly-row-combined both"><div>3766</div><div>RET NZ</div><div>If the Z flag is set, the DCB was not found on the table.</div></div>
									<div class="assembly-row-combined both"><div>3767</div><div>LD A,(HL)</div><div>If the Z flag is not set, then we have a match, so load A with the memory contents of (HL).</div></div>
									<div class="assembly-row-combined both"><div>3768</div><div>INC HL</div><div>Bump HL.</div></div>
									<div class="assembly-row-combined both"><div>3769</div><div>LD H,(HL)</div><div>Load H with the memory contents of (HL).</div></div>
									<div class="assembly-row-combined both"><div>376A</div><div>LD L,A</div><div>Load L with A.</div></div>
									<div class="assembly-row-combined both"><div>376B</div><div>RET</div><div>Return.</div></div>
								</div>
							</div>

							<br><h2 id="376C">376CH - DCB Address Table.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>376C</div><div>"K" 4015H</div></div>
									<div class="assembly-row-combined both"><div>376F</div><div>"D" 401DH</div></div>
									<div class="assembly-row-combined both"><div>3772</div><div>"P" 4025H</div></div>
									<div class="assembly-row-combined both"><div>3775</div><div>"I" 41E5H</div></div>
									<div class="assembly-row-combined both"><div>3778</div><div>"O" 41EDH</div></div>
								</div>
							</div>

							<br><h2 id="377B">377BH - This is jumped to by <a href="https://www.trs-80.com/sub-disassem-rom-m3-part-3.htm#2B91" class="memory-link">2B91</a> in the middle of the tokenize routine.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>377B</div><div>CP 22H</div><div>If the character in register A is not an end of the BASIC line character, then test the character against 22H to see if it is a <span class="code">"</span>.</div></div>
									<div class="assembly-row-combined both"><div>377D</div><div><a href="#3789" class="memory-link">JR NZ,3789H</a></div><div>If the character in register A is not a <span class="code">"</span>, then JUMP forward a few instructions to 3789H.</div></div>
									<div class="assembly-row-combined both"><div>377F</div><div>LD A,(409FH)</div><div>Load A with the memory contents of 409FH.<br><b>NOTE:</b> 409FH is the DATA FLAG.</div></div>
									<div class="assembly-row-combined both"><div>3782</div><div>XOR 01H</div><div>XOR A against 1 (Binary: 0000 0001).<br><b>NOTE:</b>
 XOR is an exclusive OR, meaning that if the 2 things are the SAME the 
result is 0, and if the 2 things are DIFFERENT, the result is 1.</div></div>
									<div class="assembly-row-combined both"><div>3784</div><div>LD (409FH),A</div><div>Load memory location 409FH with a the XOR'd results.<br><b>NOTE:</b> 409FH is the DATA FLAG.</div></div>
									<div class="assembly-row-combined both"><div>3787</div><div>LD A,22H</div><div>Load A with 22H, which is a <span class="code">"</span>.</div></div>
									<div class="assembly-row-combined both" id="3789"><div>3789</div><div>CP 3AH</div><div>Compare A against 3AH (which is a <span class="code">:</span>)
 doing A - 3AH.  If A &lt; 3AH, for UNSIGNED items, then the C FLAG is 
set.  If A =&gt; 3AH, for UNSIGNED items, then the C FLAG is reset.  If A
 = 3AH then the Z flag is set.</div></div>
									<div class="assembly-row-combined both"><div>378B</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#06AA" class="memory-link">JP NZ,06AAH</a></div><div>If A is 3AH then JUMP to 06AAH.<br><b>NOTE:</b> 06AAH is in the middle of the KEYBOARD DRIVER ENTRY ROUTINE.</div></div>
									<div class="assembly-row-combined both"><div>378E</div><div>LD A,(409FH)</div><div>Otherwise, Load A with the memory contents of 409FH.<br><b>NOTE:</b> 409FH is the DATA FLAG.</div></div>
									<div class="assembly-row-combined both"><div>3791</div><div>RRA</div><div>Rotate
 the contents of A one bit to the right, with the contents of the carry 
bit being moved to bit 7 and the contents of bit 0 being moved to the 
carry bit.  If Bit 0 is low then NC will be set.</div></div>
									<div class="assembly-row-combined both"><div>3792</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#06A8" class="memory-link">JP C,06A8H</a></div><div>If Bit 7 of the DATA FLAG was set, then JUMP to 06A8H.<br><b>NOTE:</b> 06A8H is in the middle of the KEYBOARD DRIVER ENTRY ROUTINE.</div></div>
									<div class="assembly-row-combined both"><div>3795</div><div>RLA</div><div>Rotate
 A left one bit, with the contents of BIT 7 being put into the CARRY 
FLAG and the CARRY FLAG are put into BIT 0.  This puts the read data 
into the CARRY FLAG.</div></div>
									<div class="assembly-row-combined both"><div>3796</div><div>JP 06A3H</div><div>JUMP to 06A3H.<br><b>NOTE:</b> 06A3H is the REM processor in the middle of the KEYBOARD DRIVER ENTRY ROUTINE.</div></div>

								</div>
							</div>

							<br><h2 id="3799">3799H - BASIC TIMES (DATE$+" "+TIME$)<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>3799</div><div>RST 10H</div><div>Call the EXAMINE NEXT SYMBOL routine at RST 10H.<br><span class="nobottomborder bold">NOTE:</span><ul><li>The
 RST 10H routine loads the next character from the string pointed to by 
the HL register into the A-register and clears the CARRY FLAG if it is 
alphabetic, or sets it if is alphanumeric.</li><li>Blanks and control codes 09H and 0BH are ignored causing the following character to be loaded and tested.</li><li>The
 HL register will be incremented before loading any character therfore 
on the first call the HL register should contain the string address 
minus one.</li><li>The string must be terminated by a byte of zeros.</li></ul></div></div>
									<div class="assembly-row-combined both"><div>379A</div><div>PUSH HL</div><div>Save HL (the current position) to the STACK.</div></div>
									<div class="assembly-row-combined both"><div>379B</div><div>LD A,11H</div><div>Load A with 11H (Decimal: 17).<br><b>NOTE:</b> This is to set up for a 17 Byte String.</div></div>
									<div class="assembly-row-combined both"><div>379D</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-3.htm#2857" class="memory-link">CALL 2857H</a></div><div>GOSUB to 2857H to create the string.</div></div>
									<div class="assembly-row-combined both"><div>37A0</div><div>LD HL,(40D4H)</div><div>Load HL with the memory contents of (40D4H).<br><b>NOTE:</b> 40D4 is the string pointer.</div></div>
									<div class="assembly-row-combined both"><div>37A3</div><div><a href="#35BB" class="memory-link">CALL 35BBH</a></div><div>GOSUB to 35BBH.<br><b>NOTE:</b> 35BBH populates the DATE$ and puts it on the screen.</div></div>
									<div class="assembly-row-combined both"><div>37A6</div><div>LD (HL),20H</div><div>Load the memory location pointed to by HL with a <span class="code">SPACE</span>.</div></div>
									<div class="assembly-row-combined both"><div>37A8</div><div>INC HL</div><div>Increment HL to move 1 character over.</div></div>
									<div class="assembly-row-combined both"><div>37A9</div><div><a href="#35A0" class="memory-link">CALL 35A0H</a></div><div>GOSUB to 35A0H.<br><b>NOTE:</b> 35A0H populates the TIME$ and puts it on the screen.</div></div>
									<div class="assembly-row-combined both"><div>37AC</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-3.htm#2884" class="memory-link">JP 2884H</a></div><div>JUMP to 2884H, which is in the middle of the STRING routine.</div></div>
								</div>
							</div>

							<br><h2 id="37AF">37AFH - This is a jump to NON-Disk BASIC<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37AF</div><div><a href="#37B5" class="memory-link">CALL 37B5H</a></div><div>GOSUB to 37B5H to set the cassette tape speed.</div></div>
									<div class="assembly-row-combined both"><div>37B2</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0075" class="memory-link">JP 0075H</a></div><div>JUMP to 0075H to go to non-disk initialization.</div></div>
								</div>
							</div>

							<br><h2 id="37B5">37B5H - Set the TAPE BAUD RATE ($SETCAS).<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37B5</div><div>EI</div><div>Enable Interrupts.</div></div>
									<div class="assembly-row-combined both"><div>37B6</div><div><a href="#37D7" class="memory-link">CALL 37D7H</a></div><div>GOSUB to 37D7H which loads A with a carrage return, and jumps to 0033H to display it.</div></div>
									<div class="assembly-row-combined both"><div>37B9</div><div>LD HL,37F6H</div><div>Load HL with the address of the "CASS?" message.</div></div>
									<div class="assembly-row-combined both"><div>37BC</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#021B" class="memory-link">CALL 021BH</a></div><div>GOSUB to 021BH.<br><b>NOTE:</b> 021BH will display a message Until 03H or 0DH Reached.</div></div>
									<div class="assembly-row-combined both"><div>37BF</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0049" class="memory-link">CALL 0049H</a></div><div>GOSUB to 0049H.<br><b>NOTE:</b> 0049H is the $KBWAIT routine which scans the keyboard and returns with the key pressed, if any, in register A.</div></div>
									<div class="assembly-row-combined both"><div>37C2</div><div>CP 0DH</div><div>Compare A and 0D (a <span class="code">CARRIAGE RETURN</span>).</div></div>
									<div class="assembly-row-combined both"><div>37C4</div><div><a href="#37D4" class="memory-link">JR Z,37D4H</a></div><div>If the <span class="code">CARRIAGE RETURN</span> is hit, then JUMP to 37D4H to default to HIGH SPEED.</div></div>
									<div class="assembly-row-combined both"><div>37C6</div><div>PUSH AF</div><div>Save AF to the STACK.<br><b>NOTE:</b> A currently holds the character pressed in response to the "CASS?" message.</div></div>
									<div class="assembly-row-combined both"><div>37C7</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0033" class="memory-link">CALL 0033H</a></div><div>GOSUB to 0033H.<br><b>NOTE:</b> 0033H is the character print routine, to put the character held in Register A at the current cursor position.</div></div>
									<div class="assembly-row-combined both"><div>37CA</div><div>POP AF</div><div>Restore AF from the STACK.<br><b>NOTE:</b> A will then hold the character pressed in response to the "CASS?" message.</div></div>
									<div class="assembly-row-combined both"><div>37CB</div><div>CP 48H</div><div>Compare A with 48H (ASCII: <span class="code">H</span>).</div></div>
									<div class="assembly-row-combined both"><div>37CD</div><div><a href="#37D4" class="memory-link">JR Z,37D4H</a></div><div>If A = <span class="code">H</span> then JUMP to 37D4H to select HIGH SPEED.</div></div>
									<div class="assembly-row-combined both"><div>37CF</div><div>CP 4CH</div><div>Compare A with a 4CH (ASCII: <span class="code">L</span>).</div></div>
									<div class="assembly-row-combined both"><div>37D1</div><div><a href="#37B5" class="memory-link">JR NZ,37B5H</a></div><div>If A was NOT a "L" then JUMP back to 37B5H to try again.</div></div>
									<p class="debug-note" id="37D4">37D4 - Set the Selected Cassette Baud Rate as LOW SPEED</p>
									<div class="assembly-row-combined both"><div>37D3</div><div>XOR A</div><div>Set A to 0.<br><b>NOTE:</b> Storing a 0 at 4211H will select low speed.</div></div>
									<p class="debug-note" id="37D4">37D4 - Write the Byte to Select the Selected "CASS?" Cassette Baud Rate</p>
									<div class="assembly-row-combined both"><div>37D4</div><div>LD (4211H),A</div><div>Save A (which is either "H" or 0 at this point) into (4211H).<br><b>NOTE:</b> 4211H holds the CASSETTE BAUD RATE SELECT as:<ul><li>0: 500 Baud</li><li>Anything Else: 1500 baud</li></ul></div></div>
									<div class="assembly-row-combined both"><div>37D7</div><div>LD A,0DH</div><div>A = <span class="code">CARRIAGE RETURN</span></div></div>
									<div class="assembly-row-combined both"><div>37D9</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#0033" class="memory-link">JP 0033H</a></div><div>Display the <span class="code">CARRIAGE RETURN</span> via a JUMP to 0033H.<br><b>NOTE:</b> 0033H is the character print routine, to put the character held in Register A at the current cursor position.</div></div>
								</div>
							</div>

							<br><h2 id="37DC">37DCH - Enable the TIME$ Command<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37DC</div><div>LD HL,3030H</div><div>Load HL with 3030H.<br><b>NOTE:</b> 3030H is the STRING=DATE$+""+TIME$ routine.</div></div>
									<div class="assembly-row-combined both"><div>37DF</div><div>LD (4177H),HL</div><div>Load the memory location held at 4177H with HL.<br><b>NOTE:</b> 4176H is the TIME$ vector as is currently set to be JP <span class="code">?L3 ERROR</span>
 as the M1/M3 ROM considered that to be a DOS command.  It is not a DOS 
command for a Model III so that jump needs to be changed.  In this case,
 it is changed from JP <span class="code">?L3 ERROR</span> to JP 3030H.</div></div>
									<div class="assembly-row-combined both"><div>37E2</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#022E" class="memory-link">JP 022EH</a></div><div>JUMP to 022EH to continue.<br><b>NOTE:</b> 022EH will enable interrupts, show the READY prompt, and RETURN.</div></div>
									<div class="assembly-row-combined both"><div>37E5</div><div>AA</div><div>Unused.</div></div>
									<div class="assembly-row-combined both"><div>37E6</div><div>AA</div><div>Unused.</div></div>
									<div class="assembly-row-combined both"><div>37E7</div><div>AA</div><div>Unused.</div></div>
								</div>
							</div>

							<br><h2 id="37E8">37E8H - Hidden 2 Byte Code - Printer Output.  
While these bytes may show JR NC,381AH, that is not really a valid 
command as there is no executable code at 381AH.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37E8</div><div>N/A</div><div>The
 equivalent of testing port F8H for status.  If you PEEK this location, 
you will get the PRINTER STATUS (63 = Printer ON; 143 = Printer Off) 
rather than what may actually be contained at this ROM location.  Thanks
 to George Philips for this info!</div></div>
									<div class="assembly-row-combined both"><div>37E9</div><div>N/A</div><div>The
 equivalent of sending a byte to port F8H.  If you POKE this location, 
you are sending a byte to the PRINTER.  Thanks to George Philips for 
this info!</div></div>
								</div>
							</div>

							<br><h2 id="37EA">37EA - Computer Version Number<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37EA</div><div>01</div><div>Computer version.</div></div>
									<div class="assembly-row-combined m4v1"><div>37EA</div><div>00</div><div>Unused, but set at 0.</div></div>
								</div>
							</div>

							<br><h2 id="37EB">37EBH - Display the Copyright Message<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37EB</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#021B" class="memory-link">CALL 021BH</a></div><div>GOSUB to 021BH.<br><b>NOTE:</b> 021BH will display the message pointed to by HL.</div></div>
									<div class="assembly-row-combined both"><div>37EE</div><div>LD HL,0202H</div><div>Load HL with 0202H.<br><b>NOTE:</b> 0202H points to the message '(C) "80 Tandy"'.</div></div>
									<div class="assembly-row-combined both"><div>37F1</div><div><a href="https://www.trs-80.com/sub-disassem-rom-m3-part-1.htm#021B" class="memory-link">CALL 021BH</a></div><div>GOSUB to 021BH.<br><b>NOTE:</b> 021BH will display the message pointed to by HL.</div></div>
									<div class="assembly-row-combined both"><div>37F4-37F5</div><div><a href="#37DC" class="memory-link">JR 37DCH</a></div><div>Jump Back to 37DC to patch the TIME$ Function into being live and then going to READY.</div></div>
									<div class="assembly-row-combined m4v1"><div>37F4-37F5</div><div>&nbsp;</div><div>The
 code that used to begin at 37DCH (a portion of the non-disk bootstrap 
routine, which puts the address of the TIME$ routine into the vector at 
4177H) has been moved down to 37F4H-37FCH, so this JR instruction is no 
longer needed. 37FDH-37FFH now appears to contain unused code in the 
Model 4 (two PUSH HL instructions followed by RST 38H).</div></div>
								</div>
							</div>

							<br><h2 id="37F6">37F6H - "CASS?" Message Storage Area.<button class="clipboard-copy-button" title="Copy link to this section">üìã</button></h2>
							<div class="card-item">
								<div class="assembly-table">
									<div class="assembly-row-combined both"><div>37F6</div><div>0E "CASS?" 03</div><div>CURSOR ON + "CASS?" Message Storage Area + END OF TEXT.</div></div>
									<div class="assembly-row-combined both"><div>37FE</div><div>AA AA</div><div>Unused.</div></div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>
		</div>
	</div>
	<!-- Fancybox JavaScript -->
	<script src="Model%20III%20ROM%20Explained%20-%20Part%204_files/fancybox.umd.js"></script>
	<!-- Initialize Fancybox -->
	<script>
		Fancybox.bind("[data-fancybox]", {
			Toolbar: {
				display: {
					left: ["infobar"],
					middle: [],
					right: ["slideshow", "thumbs", "close"],
				},
			},
			Thumbs: {
				autoStart: false,
			},
		});
	</script>
	<!-- Last Modified Date -->
	<script>
		document.write("<p style='text-align:right; padding: 10px 20px; font-style: italic; font-size: 0.85em; color: #666;'>Last edited: " + document.lastModified + "</p>");
	</script><p style="text-align:right; padding: 10px 20px; font-style: italic; font-size: 0.85em; color: #666;">Last edited: 12/23/2025 15:06:46</p>

<div id="mobile-overlay" class="mobile-menu-overlay"></div></body></html>